local b=getrawmetatable(game)local c=b.__newindex;local d=game.Players.LocalPlayer;local e,f={"BodyPosition","BodyVelocity","BodyGyro"},{"HumanoidRootPart","UpperTorso"}setreadonly(b,false)local g;g=hookfunc(Instance.new,newcclosure(function(b,c,...)if c and table.find(e,b)and table.find(f,tostring(c))and c.Parent==d.Character then return g(b,d.Character.LowerTorso,...)end;return g(b,c,...)end))b.__newindex=newcclosure(function(b,g,h)if d.Character and table.find(e,b.ClassName)and g=="Parent"and(table.find(f,tostring(h))and h.Parent==d.Character)then return c(b,g,d.Character.LowerTorso)end;return c(b,g,h)end)setreadonly(b,true)repeat wait()a=pcall(function()game:WaitForChild("Players").LocalPlayer:WaitForChild("PlayerScripts").ChildAdded:Connect(function(b)if b.Name=="PlayerScriptsLoader"then b.Disabled=true end end)end)if a==true then break end until true==false;game:WaitForChild("Players").LocalPlayer:WaitForChild("PlayerScripts").ChildAdded:Connect(function(b)if b.Name=="PlayerScriptsLoader"then b.Disabled=true end end)function _CameraUI()local b=game:GetService("Players")local c=game:GetService("TweenService")local d=b.LocalPlayer;if not d then b:GetPropertyChangedSignal("LocalPlayer"):Wait()d=b.LocalPlayer end;local function b(b,c)local d=b:FindFirstChildOfClass(c)while not d or d.ClassName~=c do d=b.ChildAdded:Wait()end;return d end;local b=b(d,"PlayerGui")local d=UDim2.new(0,326,0,58)local e=UDim2.new(0,80,0,58)local f=Color3.fromRGB(32,32,32)local g=0.4;local h=Color3.fromRGB(200,200,200)local i=0;local function j(b)return function(c)local b=Instance.new(b)local d=c.Parent;c.Parent=nil;for c,d in pairs(c)do if type(c)=="string"then b[c]=d else d.Parent=b end end;b.Parent=d;return b end end;local k=false;local l;local m;local n;local o;local p;local function q()assert(not k)l=j("ScreenGui"){Name="RbxCameraUI",AutoLocalize=false,Enabled=true,DisplayOrder=-1,IgnoreGuiInset=false,ResetOnSpawn=false,ZIndexBehavior=Enum.ZIndexBehavior.Sibling,j("ImageLabel"){Name="Toast",Visible=false,AnchorPoint=Vector2.new(0.5,0),BackgroundTransparency=1,BorderSizePixel=0,Position=UDim2.new(0.5,0,0,8),Size=e,Image="rbxasset://textures/ui/Camera/CameraToast9Slice.png",ImageColor3=f,ImageRectSize=Vector2.new(6,6),ImageTransparency=1,ScaleType=Enum.ScaleType.Slice,SliceCenter=Rect.new(3,3,3,3),ClipsDescendants=true,j("Frame"){Name="IconBuffer",BackgroundTransparency=1,BorderSizePixel=0,Position=UDim2.new(0,0,0,0),Size=UDim2.new(0,80,1,0),j("ImageLabel"){Name="Icon",AnchorPoint=Vector2.new(0.5,0.5),BackgroundTransparency=1,Position=UDim2.new(0.5,0,0.5,0),Size=UDim2.new(0,48,0,48),ZIndex=2,Image="rbxasset://textures/ui/Camera/CameraToastIcon.png",ImageColor3=h,ImageTransparency=1}},j("Frame"){Name="TextBuffer",BackgroundTransparency=1,BorderSizePixel=0,Position=UDim2.new(0,80,0,0),Size=UDim2.new(1,-80,1,0),ClipsDescendants=true,j("TextLabel"){Name="Upper",AnchorPoint=Vector2.new(0,1),BackgroundTransparency=1,Position=UDim2.new(0,0,0.5,0),Size=UDim2.new(1,0,0,19),Font=Enum.Font.GothamSemibold,Text="Camera control enabled",TextColor3=h,TextTransparency=1,TextSize=19,TextXAlignment=Enum.TextXAlignment.Left,TextYAlignment=Enum.TextYAlignment.Center},j("TextLabel"){Name="Lower",AnchorPoint=Vector2.new(0,0),BackgroundTransparency=1,Position=UDim2.new(0,0,0.5,3),Size=UDim2.new(1,0,0,15),Font=Enum.Font.Gotham,Text="Right mouse button to toggle",TextColor3=h,TextTransparency=1,TextSize=15,TextXAlignment=Enum.TextXAlignment.Left,TextYAlignment=Enum.TextYAlignment.Center}}},Parent=b}m=l.Toast;n=m.IconBuffer.Icon;o=m.TextBuffer.Upper;p=m.TextBuffer.Lower;k=true end;local b={}do function b.setCameraModeToastEnabled(c)if not c and not k then return end;if not k then q()end;m.Visible=c;if not c then b.setCameraModeToastOpen(false)end end;local f=TweenInfo.new(0.25,Enum.EasingStyle.Quad,Enum.EasingDirection.Out)function b.setCameraModeToastOpen(b)assert(k)c:Create(m,f,{Size=b and d or e,ImageTransparency=b and g or 1}):Play()c:Create(n,f,{ImageTransparency=b and i or 1}):Play()c:Create(o,f,{TextTransparency=b and i or 1}):Play()c:Create(p,f,{TextTransparency=b and i or 1}):Play()end end;return b end;function _CameraToggleStateController()local b=game:GetService("Players")local c=game:GetService("UserInputService")local d=UserSettings():GetService("UserGameSettings")local e=b.LocalPlayer;if not e then b:GetPropertyChangedSignal("LocalPlayer"):Wait()e=b.LocalPlayer end;local b=e:GetMouse()local e=_CameraInput()local f=_CameraUI()local g=false;local h=tick()local i="rbxasset://textures/Cursors/CrossMouseIcon.png"local j=false;local k=false;local l=false;f.setCameraModeToastEnabled(false)return function(m)local n=e.getTogglePan()local o=3;if m and n~=g then j=true end;if g~=n or tick()-h>o then local b=n and tick()-h<o;f.setCameraModeToastOpen(b)if n then j=false end;h=tick()g=n end;if m~=l then if m then k=e.getTogglePan()e.setTogglePan(true)elseif not j then e.setTogglePan(k)end end;if m then if e.getTogglePan()then b.Icon=i;c.MouseBehavior=Enum.MouseBehavior.LockCenter else b.Icon=""c.MouseBehavior=Enum.MouseBehavior.Default end elseif e.getTogglePan()then b.Icon=i;c.MouseBehavior=Enum.MouseBehavior.LockCenter;d.RotationType=Enum.RotationType.MovementRelative elseif e.getHoldPan()then b.Icon=""c.MouseBehavior=Enum.MouseBehavior.LockCurrentPosition;d.RotationType=Enum.RotationType.MovementRelative else b.Icon=""c.MouseBehavior=Enum.MouseBehavior.Default;d.RotationType=Enum.RotationType.MovementRelative end;l=m end end;function _CameraInput()local b=game:GetService("UserInputService")local c=0.3;local d,e;do local c=Instance.new("BindableEvent")local f=Instance.new("BindableEvent")d=c.Event;e=f.Event;b.InputBegan:Connect(function(b,d)if not d and b.UserInputType==Enum.UserInputType.MouseButton2 then c:Fire()end end)b.InputEnded:Connect(function(b,c)if b.UserInputType==Enum.UserInputType.MouseButton2 then f:Fire()end end)end;local f=false;local g=false;local h=0;local i={}function i.getHoldPan()return f end;function i.getTogglePan()return g end;function i.getPanning()return g or f end;function i.setTogglePan(b)g=b end;local j=false;local k;local l;function i.enableCameraToggleInput()if j then return end;j=true;f=false;g=false;if k then k:Disconnect()end;if l then l:Disconnect()end;k=d:Connect(function()f=true;h=tick()end)l=e:Connect(function()f=false;if tick()-h<c and(g or b:GetMouseDelta().Magnitude<2)then g=not g end end)end;function i.disableCameraToggleInput()if not j then return end;j=false;if k then k:Disconnect()k=nil end;if l then l:Disconnect()l=nil end end;return i end;function _BaseCamera()local b=Vector3.new(0,0,1)local c=Vector3.new(1,0,1)local d=0.2;local e=12.5;local f=25;local g=1.0;local h=Enum.ContextActionPriority.Default.Value;local i=math.rad(-80)local j=math.rad(80)local k=math.rad(30)local l=math.rad(-15)local m=2.1;local n=0.5;local o=math.rad(15)local p=Vector2.new(math.rad(15),0)local q=Vector2.new(math.rad(45),0)local r=0.1;local s=0.4;local t=Vector2.new(0,0)local u=Vector3.new(0,0,0)local v=Vector2.new(0.00945*math.pi,0.003375*math.pi)local w=Vector2.new(0.002*math.pi,0.0015*math.pi)local x=Vector3.new(0,5,0)local y=Vector3.new(0,4,0)local z=Vector3.new(0,1.5,0)local A=Vector3.new(0,1.5,0)local B=Vector3.new(0,2,0)local C=Vector3.new(2,2,1)local D=0;local E=10;local F=20;local G=20;local H=0.5;local I=math.abs;local J=math.sign;local J;do local b,c=pcall(function()return UserSettings():IsUserFeatureEnabled("UserCameraToggle")end)J=b and c end;local K;do local b,c=pcall(function()return UserSettings():IsUserFeatureEnabled("UserDontAdjustSensitvityForPortrait")end)K=b and c end;local L;do local b,c=pcall(function()return UserSettings():IsUserFeatureEnabled("UserFixZoomInZoomOutDiscrepancy")end)L=b and c end;local M=_CameraUtils()local N=_ZoomController()local O=_CameraToggleStateController()local P=_CameraInput()local Q=_CameraUI()local R=game:GetService("Players")local S=game:GetService("UserInputService")local T=game:GetService("StarterGui")local U=game:GetService("GuiService")local V=game:GetService("ContextActionService")local W=game:GetService("VRService")local X=UserSettings():GetService("UserGameSettings")local R=R.LocalPlayer;local Y={}Y.__index=Y;function Y.new()local b=setmetatable({},Y)b.FIRST_PERSON_DISTANCE_THRESHOLD=g;b.cameraType=nil;b.cameraMovementMode=nil;b.lastCameraTransform=nil;b.rotateInput=t;b.userPanningCamera=false;b.lastUserPanCamera=tick()b.humanoidRootPart=nil;b.humanoidCache={}b.lastSubject=nil;b.lastSubjectPosition=Vector3.new(0,5,0)b.defaultSubjectDistance=math.clamp(e,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)b.currentSubjectDistance=math.clamp(e,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)b.inFirstPerson=false;b.inMouseLockedMode=false;b.portraitMode=false;b.isSmallTouchScreen=false;b.resetCameraAngle=true;b.enabled=false;b.inputBeganConn=nil;b.inputChangedConn=nil;b.inputEndedConn=nil;b.startPos=nil;b.lastPos=nil;b.panBeginLook=nil;b.panEnabled=true;b.keyPanEnabled=true;b.distanceChangeEnabled=true;b.PlayerGui=nil;b.cameraChangedConn=nil;b.viewportSizeChangedConn=nil;b.boundContextActions={}b.shouldUseVRRotation=false;b.VRRotationIntensityAvailable=false;b.lastVRRotationIntensityCheckTime=0;b.lastVRRotationTime=0;b.vrRotateKeyCooldown={}b.cameraTranslationConstraints=Vector3.new(1,1,1)b.humanoidJumpOrigin=nil;b.trackingHumanoid=nil;b.cameraFrozen=false;b.subjectStateChangedConn=nil;b.activeGamepad=nil;b.gamepadPanningCamera=false;b.lastThumbstickRotate=nil;b.numOfSeconds=0.7;b.currentSpeed=0;b.maxSpeed=6;b.vrMaxSpeed=4;b.lastThumbstickPos=Vector2.new(0,0)b.ySensitivity=0.65;b.lastVelocity=nil;b.gamepadConnectedConn=nil;b.gamepadDisconnectedConn=nil;b.currentZoomSpeed=1.0;b.L3ButtonDown=false;b.dpadLeftDown=false;b.dpadRightDown=false;b.isDynamicThumbstickEnabled=false;b.fingerTouches={}b.dynamicTouchInput=nil;b.numUnsunkTouches=0;b.inputStartPositions={}b.inputStartTimes={}b.startingDiff=nil;b.pinchBeginZoom=nil;b.userPanningTheCamera=false;b.touchActivateConn=nil;b.mouseLockOffset=u;if R.Character then b:OnCharacterAdded(R.Character)end;R.CharacterAdded:Connect(function(c)b:OnCharacterAdded(c)end)if b.cameraChangedConn then b.cameraChangedConn:Disconnect()end;b.cameraChangedConn=workspace:GetPropertyChangedSignal("CurrentCamera"):Connect(function()b:OnCurrentCameraChanged()end)b:OnCurrentCameraChanged()if b.playerCameraModeChangeConn then b.playerCameraModeChangeConn:Disconnect()end;b.playerCameraModeChangeConn=R:GetPropertyChangedSignal("CameraMode"):Connect(function()b:OnPlayerCameraPropertyChange()end)if b.minDistanceChangeConn then b.minDistanceChangeConn:Disconnect()end;b.minDistanceChangeConn=R:GetPropertyChangedSignal("CameraMinZoomDistance"):Connect(function()b:OnPlayerCameraPropertyChange()end)if b.maxDistanceChangeConn then b.maxDistanceChangeConn:Disconnect()end;b.maxDistanceChangeConn=R:GetPropertyChangedSignal("CameraMaxZoomDistance"):Connect(function()b:OnPlayerCameraPropertyChange()end)if b.playerDevTouchMoveModeChangeConn then b.playerDevTouchMoveModeChangeConn:Disconnect()end;b.playerDevTouchMoveModeChangeConn=R:GetPropertyChangedSignal("DevTouchMovementMode"):Connect(function()b:OnDevTouchMovementModeChanged()end)b:OnDevTouchMovementModeChanged()if b.gameSettingsTouchMoveMoveChangeConn then b.gameSettingsTouchMoveMoveChangeConn:Disconnect()end;b.gameSettingsTouchMoveMoveChangeConn=X:GetPropertyChangedSignal("TouchMovementMode"):Connect(function()b:OnGameSettingsTouchMovementModeChanged()end)b:OnGameSettingsTouchMovementModeChanged()X:SetCameraYInvertVisible()X:SetGamepadCameraSensitivityVisible()b.hasGameLoaded=game:IsLoaded()if not b.hasGameLoaded then b.gameLoadedConn=game.Loaded:Connect(function()b.hasGameLoaded=true;b.gameLoadedConn:Disconnect()b.gameLoadedConn=nil end)end;b:OnPlayerCameraPropertyChange()return b end;function Y:GetModuleName()return"BaseCamera"end;function Y:OnCharacterAdded(b)self.resetCameraAngle=self.resetCameraAngle or self:GetEnabled()self.humanoidRootPart=nil;if S.TouchEnabled then self.PlayerGui=R:WaitForChild("PlayerGui")for b,b in ipairs(b:GetChildren())do if b:IsA("Tool")then self.isAToolEquipped=true end end;b.ChildAdded:Connect(function(b)if b:IsA("Tool")then self.isAToolEquipped=true end end)b.ChildRemoved:Connect(function(b)if b:IsA("Tool")then self.isAToolEquipped=false end end)end end;function Y:GetHumanoidRootPart()if not self.humanoidRootPart then if R.Character then local b=R.Character:FindFirstChildOfClass("Humanoid")if b then self.humanoidRootPart=b.RootPart end end end;return self.humanoidRootPart end;function Y:GetBodyPartToFollow(b,c)if b:GetState()==Enum.HumanoidStateType.Dead then local c=b.Parent;if c and c:IsA("Model")then return c:FindFirstChild("Head")or b.RootPart end end;return b.RootPart end;function Y:GetSubjectPosition()local b=self.lastSubjectPosition;local c=game.Workspace.CurrentCamera;local c=c and c.CameraSubject;if c then if c:IsA("Humanoid")then local c=c;local d=c:GetState()==Enum.HumanoidStateType.Dead;if W.VREnabled and d and c==self.lastSubject then b=self.lastSubjectPosition else local e=c.RootPart;if d then if c.Parent and c.Parent:IsA("Model")then e=c.Parent:FindFirstChild("Head")or e end end;if e and e:IsA("BasePart")then local f;if c.RigType==Enum.HumanoidRigType.R15 then if c.AutomaticScalingEnabled then f=A;if e==c.RootPart then local b=(c.RootPart.Size.Y/2)-(C.Y/2)f=f+Vector3.new(0,b,0)end else f=B end else f=z end;if d then f=u end;b=e.CFrame.p+e.CFrame:vectorToWorldSpace(f+c.CameraOffset)end end elseif c:IsA("VehicleSeat")then local d=x;if W.VREnabled then d=y end;b=c.CFrame.p+c.CFrame:vectorToWorldSpace(d)elseif c:IsA("SkateboardPlatform")then b=c.CFrame.p+x elseif c:IsA("BasePart")then b=c.CFrame.p elseif c:IsA("Model")then if c.PrimaryPart then b=c:GetPrimaryPartCFrame().p else b=c:GetModelCFrame().p end end else return end;self.lastSubject=c;self.lastSubjectPosition=b;return b end;function Y:UpdateDefaultSubjectDistance()if self.portraitMode then self.defaultSubjectDistance=math.clamp(f,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)else self.defaultSubjectDistance=math.clamp(e,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)end end;function Y:OnViewportSizeChanged()local b=game.Workspace.CurrentCamera;local b=b.ViewportSize;self.portraitMode=b.X<b.Y;self.isSmallTouchScreen=S.TouchEnabled and(b.Y<500 or b.X<700)self:UpdateDefaultSubjectDistance()end;function Y:OnCurrentCameraChanged()if S.TouchEnabled then if self.viewportSizeChangedConn then self.viewportSizeChangedConn:Disconnect()self.viewportSizeChangedConn=nil end;local b=game.Workspace.CurrentCamera;if b then self:OnViewportSizeChanged()self.viewportSizeChangedConn=b:GetPropertyChangedSignal("ViewportSize"):Connect(function()self:OnViewportSizeChanged()end)end end;if self.cameraSubjectChangedConn then self.cameraSubjectChangedConn:Disconnect()self.cameraSubjectChangedConn=nil end;local b=game.Workspace.CurrentCamera;if b then self.cameraSubjectChangedConn=b:GetPropertyChangedSignal("CameraSubject"):Connect(function()self:OnNewCameraSubject()end)self:OnNewCameraSubject()end end;function Y:OnDynamicThumbstickEnabled()if S.TouchEnabled then self.isDynamicThumbstickEnabled=true end end;function Y:OnDynamicThumbstickDisabled()self.isDynamicThumbstickEnabled=false end;function Y:OnGameSettingsTouchMovementModeChanged()if R.DevTouchMovementMode==Enum.DevTouchMovementMode.UserChoice then if(X.TouchMovementMode==Enum.TouchMovementMode.DynamicThumbstick or X.TouchMovementMode==Enum.TouchMovementMode.Default)then self:OnDynamicThumbstickEnabled()else self:OnDynamicThumbstickDisabled()end end end;function Y:OnDevTouchMovementModeChanged()if R.DevTouchMovementMode.Name=="DynamicThumbstick"then self:OnDynamicThumbstickEnabled()else self:OnGameSettingsTouchMovementModeChanged()end end;function Y:OnPlayerCameraPropertyChange()self:SetCameraToSubjectDistance(self.currentSubjectDistance)end;function Y:GetCameraHeight()if W.VREnabled and not self.inFirstPerson then return math.sin(o)*self.currentSubjectDistance end;return 0 end;function Y:InputTranslationToCameraAngleChange(b,c)if not K then local d=game.Workspace.CurrentCamera;if d and d.ViewportSize.X>0 and d.ViewportSize.Y>0 and(d.ViewportSize.Y>d.ViewportSize.X)then return b*Vector2.new(c.Y,c.X)end end;return b*c end;function Y:Enable(b)if self.enabled~=b then self.enabled=b;if self.enabled then self:ConnectInputEvents()self:BindContextActions()if R.CameraMode==Enum.CameraMode.LockFirstPerson then self.currentSubjectDistance=0.5;if not self.inFirstPerson then self:EnterFirstPerson()end end else self:DisconnectInputEvents()self:UnbindContextActions()self:Cleanup()end end end;function Y:GetEnabled()return self.enabled end;function Y:OnInputBegan(b,c)if b.UserInputType==Enum.UserInputType.Touch then self:OnTouchBegan(b,c)elseif b.UserInputType==Enum.UserInputType.MouseButton2 then self:OnMouse2Down(b,c)elseif b.UserInputType==Enum.UserInputType.MouseButton3 then self:OnMouse3Down(b,c)end end;function Y:OnInputChanged(b,c)if b.UserInputType==Enum.UserInputType.Touch then self:OnTouchChanged(b,c)elseif b.UserInputType==Enum.UserInputType.MouseMovement then self:OnMouseMoved(b,c)end end;function Y:OnInputEnded(b,c)if b.UserInputType==Enum.UserInputType.Touch then self:OnTouchEnded(b,c)elseif b.UserInputType==Enum.UserInputType.MouseButton2 then self:OnMouse2Up(b,c)elseif b.UserInputType==Enum.UserInputType.MouseButton3 then self:OnMouse3Up(b,c)end end;function Y:OnPointerAction(b,c,d,e)if e then return end;if c.Magnitude>0 then local b=Vector2.new(1,X:GetCameraYInvertValue())local b=self:InputTranslationToCameraAngleChange(G*c,w)*b;self.rotateInput=self.rotateInput+b end;local c=self.currentSubjectDistance;local b=-(b+d)if I(b)>0 then local d;if self.inFirstPerson and b>0 then d=g else if L then if(b>0)then d=c+b*(1+c*H)else d=(c+b)/(1-b*H)end else d=c+b*(1+c*H)end end;self:SetCameraToSubjectDistance(d)end end;function Y:ConnectInputEvents()self.pointerActionConn=S.PointerAction:Connect(function(b,c,d,e)self:OnPointerAction(b,c,d,e)end)self.inputBeganConn=S.InputBegan:Connect(function(b,c)self:OnInputBegan(b,c)end)self.inputChangedConn=S.InputChanged:Connect(function(b,c)self:OnInputChanged(b,c)end)self.inputEndedConn=S.InputEnded:Connect(function(b,c)self:OnInputEnded(b,c)end)self.menuOpenedConn=U.MenuOpened:connect(function()self:ResetInputStates()end)self.gamepadConnectedConn=S.GamepadDisconnected:connect(function(b)if self.activeGamepad~=b then return end;self.activeGamepad=nil;self:AssignActivateGamepad()end)self.gamepadDisconnectedConn=S.GamepadConnected:connect(function(b)if self.activeGamepad==nil then self:AssignActivateGamepad()end end)self:AssignActivateGamepad()if not J then self:UpdateMouseBehavior()end end;function Y:BindContextActions()self:BindGamepadInputActions()self:BindKeyboardInputActions()end;function Y:AssignActivateGamepad()local b=S:GetConnectedGamepads()if#b>0 then for c=1,#b do if self.activeGamepad==nil then self.activeGamepad=b[c]elseif b[c].Value<self.activeGamepad.Value then self.activeGamepad=b[c]end end end;if self.activeGamepad==nil then self.activeGamepad=Enum.UserInputType.Gamepad1 end end;function Y:DisconnectInputEvents()if self.inputBeganConn then self.inputBeganConn:Disconnect()self.inputBeganConn=nil end;if self.inputChangedConn then self.inputChangedConn:Disconnect()self.inputChangedConn=nil end;if self.inputEndedConn then self.inputEndedConn:Disconnect()self.inputEndedConn=nil end end;function Y:UnbindContextActions()for b=1,#self.boundContextActions do V:UnbindAction(self.boundContextActions[b])end;self.boundContextActions={}end;function Y:Cleanup()if self.pointerActionConn then self.pointerActionConn:Disconnect()self.pointerActionConn=nil end;if self.menuOpenedConn then self.menuOpenedConn:Disconnect()self.menuOpenedConn=nil end;if self.mouseLockToggleConn then self.mouseLockToggleConn:Disconnect()self.mouseLockToggleConn=nil end;if self.gamepadConnectedConn then self.gamepadConnectedConn:Disconnect()self.gamepadConnectedConn=nil end;if self.gamepadDisconnectedConn then self.gamepadDisconnectedConn:Disconnect()self.gamepadDisconnectedConn=nil end;if self.subjectStateChangedConn then self.subjectStateChangedConn:Disconnect()self.subjectStateChangedConn=nil end;if self.viewportSizeChangedConn then self.viewportSizeChangedConn:Disconnect()self.viewportSizeChangedConn=nil end;if self.touchActivateConn then self.touchActivateConn:Disconnect()self.touchActivateConn=nil end;self.turningLeft=false;self.turningRight=false;self.lastCameraTransform=nil;self.lastSubjectCFrame=nil;self.userPanningTheCamera=false;self.rotateInput=Vector2.new()self.gamepadPanningCamera=Vector2.new(0,0)self.startPos=nil;self.lastPos=nil;self.panBeginLook=nil;self.isRightMouseDown=false;self.isMiddleMouseDown=false;self.fingerTouches={}self.dynamicTouchInput=nil;self.numUnsunkTouches=0;self.startingDiff=nil;self.pinchBeginZoom=nil;if S.MouseBehavior~=Enum.MouseBehavior.LockCenter then S.MouseBehavior=Enum.MouseBehavior.Default end end;function Y:ResetInputStates()self.isRightMouseDown=false;self.isMiddleMouseDown=false;self:OnMousePanButtonReleased()if S.TouchEnabled then for b in pairs(self.fingerTouches)do self.fingerTouches[b]=nil end;self.dynamicTouchInput=nil;self.panBeginLook=nil;self.startPos=nil;self.lastPos=nil;self.userPanningTheCamera=false;self.startingDiff=nil;self.pinchBeginZoom=nil;self.numUnsunkTouches=0 end end;function Y:GetGamepadPan(b,b,c)if c.UserInputType==self.activeGamepad and c.KeyCode==Enum.KeyCode.Thumbstick2 then if b==Enum.UserInputState.Cancel then self.gamepadPanningCamera=t;return end;local b=Vector2.new(c.Position.X,-c.Position.Y)if b.magnitude>d then self.gamepadPanningCamera=Vector2.new(c.Position.X,-c.Position.Y)else self.gamepadPanningCamera=t end;return Enum.ContextActionResult.Sink end;return Enum.ContextActionResult.Pass end;function Y:DoKeyboardPanTurn(b,b,c)if not self.hasGameLoaded and W.VREnabled then return Enum.ContextActionResult.Pass end;if b==Enum.UserInputState.Cancel then self.turningLeft=false;self.turningRight=false;return Enum.ContextActionResult.Sink end;if self.panBeginLook==nil and self.keyPanEnabled then if c.KeyCode==Enum.KeyCode.Left then self.turningLeft=b==Enum.UserInputState.Begin elseif c.KeyCode==Enum.KeyCode.Right then self.turningRight=b==Enum.UserInputState.Begin end;return Enum.ContextActionResult.Sink end;return Enum.ContextActionResult.Pass end;function Y:DoPanRotateCamera(b)local b=M.RotateVectorByAngleAndRound(self:GetCameraLookVector()*Vector3.new(1,0,1),b,math.pi*0.25)if b~=0 then self.rotateInput=self.rotateInput+Vector2.new(b,0)self.lastUserPanCamera=tick()self.lastCameraTransform=nil end end;function Y:DoGamepadZoom(b,b,c)if c.UserInputType==self.activeGamepad then if c.KeyCode==Enum.KeyCode.ButtonR3 then if b==Enum.UserInputState.Begin then if self.distanceChangeEnabled then local b=self:GetCameraToSubjectDistance()if b>(E+F)/2 then self:SetCameraToSubjectDistance(E)elseif b>(D+E)/2 then self:SetCameraToSubjectDistance(D)else self:SetCameraToSubjectDistance(F)end end end elseif c.KeyCode==Enum.KeyCode.DPadLeft then self.dpadLeftDown=(b==Enum.UserInputState.Begin)elseif c.KeyCode==Enum.KeyCode.DPadRight then self.dpadRightDown=(b==Enum.UserInputState.Begin)end;if self.dpadLeftDown then self.currentZoomSpeed=1.04 elseif self.dpadRightDown then self.currentZoomSpeed=0.96 else self.currentZoomSpeed=1.00 end;return Enum.ContextActionResult.Sink end;return Enum.ContextActionResult.Pass end;function Y:DoKeyboardZoom(b,b,c)if not self.hasGameLoaded and W.VREnabled then return Enum.ContextActionResult.Pass end;if b~=Enum.UserInputState.Begin then return Enum.ContextActionResult.Pass end;if self.distanceChangeEnabled and R.CameraMode~=Enum.CameraMode.LockFirstPerson then if c.KeyCode==Enum.KeyCode.I then self:SetCameraToSubjectDistance(self.currentSubjectDistance-5)elseif c.KeyCode==Enum.KeyCode.O then self:SetCameraToSubjectDistance(self.currentSubjectDistance+5)end;return Enum.ContextActionResult.Sink end;return Enum.ContextActionResult.Pass end;function Y:BindAction(b,c,d,...)table.insert(self.boundContextActions,b)V:BindActionAtPriority(b,c,d,h,...)end;function Y:BindGamepadInputActions()self:BindAction("BaseCameraGamepadPan",function(b,c,d)return self:GetGamepadPan(b,c,d)end,false,Enum.KeyCode.Thumbstick2)self:BindAction("BaseCameraGamepadZoom",function(b,c,d)return self:DoGamepadZoom(b,c,d)end,false,Enum.KeyCode.DPadLeft,Enum.KeyCode.DPadRight,Enum.KeyCode.ButtonR3)end;function Y:BindKeyboardInputActions()self:BindAction("BaseCameraKeyboardPanArrowKeys",function(b,c,d)return self:DoKeyboardPanTurn(b,c,d)end,false,Enum.KeyCode.Left,Enum.KeyCode.Right)self:BindAction("BaseCameraKeyboardZoom",function(b,c,d)return self:DoKeyboardZoom(b,c,d)end,false,Enum.KeyCode.I,Enum.KeyCode.O)end;local function d(b)local c=R:FindFirstChildOfClass("PlayerGui")local c=c and c:FindFirstChild("TouchGui")local c=c and c:FindFirstChild("TouchControlFrame")local c=c and c:FindFirstChild("DynamicThumbstickFrame")if not c then return false end;local d=c.AbsolutePosition;local c=d+c.AbsoluteSize;if b.Position.X>=d.X and b.Position.Y>=d.Y then if b.Position.X<=c.X and b.Position.Y<=c.Y then return true end end;return false end;function Y:AdjustTouchSensitivity(b,c)local d=game.Workspace.CurrentCamera and game.Workspace.CurrentCamera.CFrame;if not d then return c end;local d=d:ToEulerAnglesYXZ()local e=m;if d>k and b.Y<0 then local b=(d-k)/(j-k)b=1-(1-b)^3;e=m-b*(m-n)elseif d<l and b.Y>0 then local b=(d-l)/(i-l)b=1-(1-b)^3;e=m-b*(m-n)end;return Vector2.new(c.X,c.Y*e)end;function Y:OnTouchBegan(b,c)local e=self.isDynamicThumbstickEnabled and not c;if e then if self.dynamicTouchInput==nil and d(b)then self.dynamicTouchInput=b;return end;self.fingerTouches[b]=c;self.inputStartPositions[b]=b.Position;self.inputStartTimes[b]=tick()self.numUnsunkTouches=self.numUnsunkTouches+1 end end;function Y:OnTouchChanged(b,c)if self.fingerTouches[b]==nil then if self.isDynamicThumbstickEnabled then return end;self.fingerTouches[b]=c;if not c then self.numUnsunkTouches=self.numUnsunkTouches+1 end end;if self.numUnsunkTouches==1 then if self.fingerTouches[b]==false then self.panBeginLook=self.panBeginLook or self:GetCameraLookVector()self.startPos=self.startPos or b.Position;self.lastPos=self.lastPos or self.startPos;self.userPanningTheCamera=true;local c=b.Position-self.lastPos;c=Vector2.new(c.X,c.Y*X:GetCameraYInvertValue())if self.panEnabled then local b=v;self:AdjustTouchSensitivity(c,v)local b=self:InputTranslationToCameraAngleChange(c,b)self.rotateInput=self.rotateInput+b end;self.lastPos=b.Position end else self.panBeginLook=nil;self.startPos=nil;self.lastPos=nil;self.userPanningTheCamera=false end;if self.numUnsunkTouches==2 then local b={}for c,d in pairs(self.fingerTouches)do if not d then table.insert(b,c)end end;if#b==2 then local b=(b[1].Position-b[2].Position).magnitude;if self.startingDiff and self.pinchBeginZoom then local b=b/math.max(0.01,self.startingDiff)local b=math.clamp(b,0.1,10)if self.distanceChangeEnabled then self:SetCameraToSubjectDistance(self.pinchBeginZoom/b)end else self.startingDiff=b;self.pinchBeginZoom=self:GetCameraToSubjectDistance()end end else self.startingDiff=nil;self.pinchBeginZoom=nil end end;function Y:OnTouchEnded(b,c)if b==self.dynamicTouchInput then self.dynamicTouchInput=nil;return end;if self.fingerTouches[b]==false then if self.numUnsunkTouches==1 then self.panBeginLook=nil;self.startPos=nil;self.lastPos=nil;self.userPanningTheCamera=false elseif self.numUnsunkTouches==2 then self.startingDiff=nil;self.pinchBeginZoom=nil end end;if self.fingerTouches[b]~=nil and self.fingerTouches[b]==false then self.numUnsunkTouches=self.numUnsunkTouches-1 end;self.fingerTouches[b]=nil;self.inputStartPositions[b]=nil;self.inputStartTimes[b]=nil end;function Y:OnMouse2Down(b,c)if c then return end;self.isRightMouseDown=true;self:OnMousePanButtonPressed(b,c)end;function Y:OnMouse2Up(b,c)self.isRightMouseDown=false;self:OnMousePanButtonReleased(b,c)end;function Y:OnMouse3Down(b,c)if c then return end;self.isMiddleMouseDown=true;self:OnMousePanButtonPressed(b,c)end;function Y:OnMouse3Up(b,c)self.isMiddleMouseDown=false;self:OnMousePanButtonReleased(b,c)end;function Y:OnMouseMoved(b,c)if not self.hasGameLoaded and W.VREnabled then return end;local c=b.Delta;c=Vector2.new(c.X,c.Y*X:GetCameraYInvertValue())local d=J and P.getPanning()local e=self.startPos and self.lastPos and self.panBeginLook;local d=e or self.inFirstPerson or self.inMouseLockedMode or d;if self.panEnabled and d then local b=self:InputTranslationToCameraAngleChange(c,w)self.rotateInput=self.rotateInput+b end;if self.startPos and self.lastPos and self.panBeginLook then self.lastPos=self.lastPos+b.Delta end end;function Y:OnMousePanButtonPressed(b,c)if c then return end;if not J then self:UpdateMouseBehavior()end;self.panBeginLook=self.panBeginLook or self:GetCameraLookVector()self.startPos=self.startPos or b.Position;self.lastPos=self.lastPos or self.startPos;self.userPanningTheCamera=true end;function Y:OnMousePanButtonReleased(b,b)if not J then self:UpdateMouseBehavior()end;if not(self.isRightMouseDown or self.isMiddleMouseDown)then self.panBeginLook=nil;self.startPos=nil;self.lastPos=nil;self.userPanningTheCamera=false end end;function Y:UpdateMouseBehavior()if J and self.isCameraToggle then Q.setCameraModeToastEnabled(true)P.enableCameraToggleInput()O(self.inFirstPerson)else if J then Q.setCameraModeToastEnabled(false)P.disableCameraToggleInput()end;if self.inFirstPerson or self.inMouseLockedMode then S.MouseBehavior=Enum.MouseBehavior.LockCenter else X.RotationType=Enum.RotationType.MovementRelative;if self.isRightMouseDown or self.isMiddleMouseDown then S.MouseBehavior=Enum.MouseBehavior.LockCurrentPosition else S.MouseBehavior=Enum.MouseBehavior.Default end end end end;function Y:UpdateForDistancePropertyChange()self:SetCameraToSubjectDistance(self.currentSubjectDistance)end;function Y:SetCameraToSubjectDistance(b)local c=self.currentSubjectDistance;if R.CameraMode==Enum.CameraMode.LockFirstPerson then self.currentSubjectDistance=0.5;if not self.inFirstPerson then self:EnterFirstPerson()end else local b=math.clamp(b,R.CameraMinZoomDistance,R.CameraMaxZoomDistance)if b<g then self.currentSubjectDistance=0.5;if not self.inFirstPerson then self:EnterFirstPerson()end else self.currentSubjectDistance=b;if self.inFirstPerson then self:LeaveFirstPerson()end end end;N.SetZoomParameters(self.currentSubjectDistance,math.sign(b-c))return self.currentSubjectDistance end;function Y:SetCameraType(b)self.cameraType=b end;function Y:GetCameraType()return self.cameraType end;function Y:SetCameraMovementMode(b)self.cameraMovementMode=b end;function Y:GetCameraMovementMode()return self.cameraMovementMode end;function Y:SetIsMouseLocked(b)self.inMouseLockedMode=b;if not J then self:UpdateMouseBehavior()end end;function Y:GetIsMouseLocked()return self.inMouseLockedMode end;function Y:SetMouseLockOffset(b)self.mouseLockOffset=b end;function Y:GetMouseLockOffset()return self.mouseLockOffset end;function Y:InFirstPerson()return self.inFirstPerson end;function Y:EnterFirstPerson()end;function Y:LeaveFirstPerson()end;function Y:GetCameraToSubjectDistance()return self.currentSubjectDistance end;function Y:GetMeasuredDistanceToFocus()local b=game.Workspace.CurrentCamera;if b then return(b.CoordinateFrame.p-b.Focus.p).magnitude end;return nil end;function Y:GetCameraLookVector()return game.Workspace.CurrentCamera and game.Workspace.CurrentCamera.CFrame.lookVector or b end;function Y:CalculateNewLookCFrame(b)local b=b or self:GetCameraLookVector()local c=math.asin(b.y)local c=math.clamp(self.rotateInput.y,-j+c,-i+c)local c=Vector2.new(self.rotateInput.x,c)local b=CFrame.new(u,b)local b=CFrame.Angles(0,-c.x,0)*b*CFrame.Angles(-c.y,0,0)return b end;function Y:CalculateNewLookVector(b)local b=self:CalculateNewLookCFrame(b)return b.lookVector end;function Y:CalculateNewLookVectorVR()local b=self:GetSubjectPosition()local b=(b-game.Workspace.CurrentCamera.CFrame.p)local b=(b*c).unit;local d=Vector2.new(self.rotateInput.x,0)local b=CFrame.new(u,b)local b=(CFrame.Angles(0,-d.x,0)*b*CFrame.Angles(-d.y,0,0)).lookVector;return(b*c).unit end;function Y:GetHumanoid()local b=R and R.Character;if b then local c=self.humanoidCache[R]if c and c.Parent==b then return c else self.humanoidCache[R]=nil;local b=b:FindFirstChildOfClass("Humanoid")if b then self.humanoidCache[R]=b end;return b end end;return nil end;function Y:GetHumanoidPartToFollow(b,c)if c==Enum.HumanoidStateType.Dead then local c=b.Parent;if c then return c:FindFirstChild("Head")or b.Torso else return b.Torso end else return b.Torso end end;function Y:UpdateGamepad()local b=self.gamepadPanningCamera;if b and(self.hasGameLoaded or not W.VREnabled)then b=M.GamepadLinearToCurve(b)local c=tick()if b.X~=0 or b.Y~=0 then self.userPanningTheCamera=true elseif b==t then self.lastThumbstickRotate=nil;if self.lastThumbstickPos==t then self.currentSpeed=0 end end;local d=0;if self.lastThumbstickRotate then if W.VREnabled then self.currentSpeed=self.vrMaxSpeed else local d=(c-self.lastThumbstickRotate)*10;self.currentSpeed=self.currentSpeed+(self.maxSpeed*((d*d)/self.numOfSeconds))if self.currentSpeed>self.maxSpeed then self.currentSpeed=self.maxSpeed end;if self.lastVelocity then local b=(b-self.lastThumbstickPos)/(c-self.lastThumbstickRotate)local b=(b-self.lastVelocity).magnitude;if b>12 then self.currentSpeed=self.currentSpeed*(20/b)if self.currentSpeed>self.maxSpeed then self.currentSpeed=self.maxSpeed end end end end;d=X.GamepadCameraSensitivity*self.currentSpeed;self.lastVelocity=(b-self.lastThumbstickPos)/(c-self.lastThumbstickRotate)end;self.lastThumbstickPos=b;self.lastThumbstickRotate=c;return Vector2.new(b.X*d,b.Y*d*self.ySensitivity*X:GetCameraYInvertValue())end;return t end;function Y:ApplyVRTransform()if not W.VREnabled then return end;local b=self.humanoidRootPart and self.humanoidRootPart:FindFirstChild("RootJoint")if not b then return end;local c=game.Workspace.CurrentCamera.CameraSubject;local c=c and c:IsA("VehicleSeat")if self.inFirstPerson and not c then local c=W:GetUserCFrame(Enum.UserCFrame.Head)local d=c-c.p;b.C0=CFrame.new(d:vectorToObjectSpace(c.p))*CFrame.new(0,0,0,-1,0,0,0,0,1,0,1,0)else b.C0=CFrame.new(0,0,0,-1,0,0,0,0,1,0,1,0)end end;function Y:IsInFirstPerson()return self.inFirstPerson end;function Y:ShouldUseVRRotation()if not W.VREnabled then return false end;if not self.VRRotationIntensityAvailable and tick()-self.lastVRRotationIntensityCheckTime<1 then return false end;local b,c=pcall(function()return T:GetCore("VRRotationIntensity")end)self.VRRotationIntensityAvailable=b and c~=nil;self.lastVRRotationIntensityCheckTime=tick()self.shouldUseVRRotation=b and c~=nil and c~="Smooth"return self.shouldUseVRRotation end;function Y:GetVRRotationInput()local b=t;local c,d=pcall(function()return T:GetCore("VRRotationIntensity")end)if not c then return end;local c=self.GamepadPanningCamera or t;local e=(tick()-self.lastVRRotationTime)>=self:GetRepeatDelayValue(d)if math.abs(c.x)>=self:GetActivateValue()then if(e or not self.vrRotateKeyCooldown[Enum.KeyCode.Thumbstick2])then local e=1;if c.x<0 then e=-1 end;b=b+self:GetRotateAmountValue(d)*e;self.vrRotateKeyCooldown[Enum.KeyCode.Thumbstick2]=true end elseif math.abs(c.x)<self:GetActivateValue()-0.1 then self.vrRotateKeyCooldown[Enum.KeyCode.Thumbstick2]=nil end;if self.turningLeft then if e or not self.vrRotateKeyCooldown[Enum.KeyCode.Left]then b=b-self:GetRotateAmountValue(d)self.vrRotateKeyCooldown[Enum.KeyCode.Left]=true end else self.vrRotateKeyCooldown[Enum.KeyCode.Left]=nil end;if self.turningRight then if(e or not self.vrRotateKeyCooldown[Enum.KeyCode.Right])then b=b+self:GetRotateAmountValue(d)self.vrRotateKeyCooldown[Enum.KeyCode.Right]=true end else self.vrRotateKeyCooldown[Enum.KeyCode.Right]=nil end;if b~=t then self.lastVRRotationTime=tick()end;return b end;function Y:CancelCameraFreeze(b)if not b then self.cameraTranslationConstraints=Vector3.new(self.cameraTranslationConstraints.x,1,self.cameraTranslationConstraints.z)end;if self.cameraFrozen then self.trackingHumanoid=nil;self.cameraFrozen=false end end;function Y:StartCameraFreeze(b,c)if not self.cameraFrozen then self.humanoidJumpOrigin=b;self.trackingHumanoid=c;self.cameraTranslationConstraints=Vector3.new(self.cameraTranslationConstraints.x,0,self.cameraTranslationConstraints.z)self.cameraFrozen=true end end;function Y:OnNewCameraSubject()if self.subjectStateChangedConn then self.subjectStateChangedConn:Disconnect()self.subjectStateChangedConn=nil end;local b=workspace.CurrentCamera and workspace.CurrentCamera.CameraSubject;if self.trackingHumanoid~=b then self:CancelCameraFreeze()end;if b and b:IsA("Humanoid")then self.subjectStateChangedConn=b.StateChanged:Connect(function(c,c)if W.VREnabled and c==Enum.HumanoidStateType.Jumping and not self.inFirstPerson then self:StartCameraFreeze(self:GetSubjectPosition(),b)elseif c~=Enum.HumanoidStateType.Jumping and c~=Enum.HumanoidStateType.Freefall then self:CancelCameraFreeze(true)end end)end end;function Y:GetVRFocus(b,c)local d=self.LastCameraFocus or b;if not self.cameraFrozen then self.cameraTranslationConstraints=Vector3.new(self.cameraTranslationConstraints.x,math.min(1,self.cameraTranslationConstraints.y+0.42*c),self.cameraTranslationConstraints.z)end;local e;if self.cameraFrozen and self.humanoidJumpOrigin and self.humanoidJumpOrigin.y>d.y then e=CFrame.new(Vector3.new(b.x,math.min(self.humanoidJumpOrigin.y,d.y+5*c),b.z))else e=CFrame.new(Vector3.new(b.x,d.y,b.z):lerp(b,self.cameraTranslationConstraints.y))end;if self.cameraFrozen then if self.inFirstPerson then self:CancelCameraFreeze()end;if self.humanoidJumpOrigin and b.y<(self.humanoidJumpOrigin.y-0.5)then self:CancelCameraFreeze()end end;return e end;function Y:GetRotateAmountValue(b)b=b or T:GetCore("VRRotationIntensity")if b then if b=="Low"then return p elseif b=="High"then return q end end;return t end;function Y:GetRepeatDelayValue(b)b=b or T:GetCore("VRRotationIntensity")if b then if b=="Low"then return r elseif b=="High"then return s end end;return 0 end;function Y:Update(b)error("BaseCamera:Update() This is a virtual function that should never be getting called.",2)end;Y.UpCFrame=CFrame.new()function Y:UpdateUpCFrame(b)self.UpCFrame=b end;local b=Vector3.new(0,0,0)function Y:CalculateNewLookCFrame(c)local c=c or self:GetCameraLookVector()c=self.UpCFrame:VectorToObjectSpace(c)local d=math.asin(c.y)local d=math.clamp(self.rotateInput.y,-j+d,-i+d)local d=Vector2.new(self.rotateInput.x,d)local b=CFrame.new(b,c)local b=CFrame.Angles(0,-d.x,0)*b*CFrame.Angles(-d.y,0,0)return b end;return Y end;function _BaseOcclusion()local b={}b.__index=b;setmetatable(b,{__call=function(c,...)return b.new(...)end})function b.new()local b=setmetatable({},b)return b end;function b:CharacterAdded(b,b)end;function b:CharacterRemoving(b,b)end;function b:OnCameraSubjectChanged(b)end;function b:GetOcclusionMode()warn("BaseOcclusion GetOcclusionMode must be overridden by derived classes")return nil end;function b:Enable(b)warn("BaseOcclusion Enable must be overridden by derived classes")end;function b:Update(b,b,c)warn("BaseOcclusion Update must be overridden by derived classes")return b,c end;return b end;function _Popper()local b=game:GetService("Players")local c=game.Workspace.CurrentCamera;local d=math.min;local e=math.tan;local f=math.rad;local g=math.huge;local h=Ray.new;local function i(b)return 1-(1-b.Transparency)*(1-b.LocalTransparencyModifier)end;local function j(b,c)for c=#b,c+1,-1 do b[c]=nil end end;local k,l,m;do local function b()local b=f(c.FieldOfView)local c=c.ViewportSize;local c=c.X/c.Y;m=2*e(b/2)l=c*m end;c:GetPropertyChangedSignal("FieldOfView"):Connect(b)c:GetPropertyChangedSignal("ViewportSize"):Connect(b)b()k=c.NearPlaneZ;c:GetPropertyChangedSignal("NearPlaneZ"):Connect(function()k=c.NearPlaneZ end)end;local e={}do local c={}local function d()local b=1;e={}for c,c in pairs(c)do e[b]=c;b=b+1 end end;local function e(b)local function e(e)c[b]=e;d()end;local function f()c[b]=nil;d()end;b.CharacterAdded:Connect(e)b.CharacterRemoving:Connect(f)if b.Character then e(b.Character)end end;local function f(b)c[b]=nil;d()end;b.PlayerAdded:Connect(e)b.PlayerRemoving:Connect(f)for b,b in ipairs(b:GetPlayers())do e(b)end;d()end;local b;local f;c:GetPropertyChangedSignal("CameraSubject"):Connect(function()local b=c.CameraSubject;if b:IsA("Humanoid")then f=b.RootPart elseif b:IsA("BasePart")then f=b else f=nil end end)local function n(c)return i(c)<0.25 and c.CanCollide and b~=(c:GetRootPart()or c)and not c:IsA("TrussPart")end;local i={Vector2.new(0.4,0.0),Vector2.new(-0.4,0.0),Vector2.new(0.0,-0.4),Vector2.new(0.0,0.4),Vector2.new(0.0,0.2)}local function o(b,c)local d=#e;repeat local b,c=workspace:FindPartOnRayWithIgnoreList(h(b,c),e,false,true)if b then if b.CanCollide then j(e,d)return c,true end;e[#e+1]=b end until not b;j(e,d)return b+c,false end;local function p(b,c,d,f)debug.profilebegin("queryPoint")local i=#e;d=d+k;local l=b+c*d;local m=g;local o=g;local p=b;repeat local i,j=workspace:FindPartOnRayWithIgnoreList(h(p,l-p),e,false,true)if i then if n(i)then local c={i}local e=workspace:FindPartOnRayWithWhitelist(h(l,j-l),c,true)local b=(j-b).Magnitude;if e then local e=false;if f then e=workspace:FindPartOnRayWithWhitelist(h(f,l-f),c,true)or workspace:FindPartOnRayWithWhitelist(h(l,f-l),c,true)end;if e then o=b elseif d<m then m=b end else o=b end end;e[#e+1]=i;p=j-c*1e-3 end until o<g or not i;j(e,i)debug.profileend()return m-k,o-k end;local function e(b,d)debug.profilebegin("queryViewport")local e=b.p;local f=b.rightVector;local h=b.upVector;local b=-b.lookVector;local i=c.ViewportSize;local j=g;local g=g;for n=0,1 do local f=f*((n-0.5)*l)for l=0,1 do local h=h*((l-0.5)*m)local e=e+k*(f+h)local c=c:ViewportPointToRay(i.x*n,i.y*l).Origin;local b,c=p(e,b,d,c)if c<j then j=c end;if b<g then g=b end end end;debug.profileend()return g,j end;local function c(b,c,e)debug.profilebegin("testPromotion")local f=b.p;local h=b.rightVector;local j=b.upVector;local b=-b.lookVector;do debug.profilebegin("extrapolate")local b=0.0625;local g=1.25;local f=(o(f,e.posVelocity*g)-f).Magnitude;local h=e.posVelocity.magnitude;for b=0,d(g,e.rotVelocity.magnitude+f/h),b do local b=e.extrapolate(b)if p(b.p,-b.lookVector,c)>=c then return false end end;debug.profileend()end;do debug.profilebegin("testOffsets")for d,d in ipairs(i)do local d=d;local d=o(f,h*d.x+j*d.y)if p(d,(f+b*c-d).Unit,c)==g then return false end end;debug.profileend()end;debug.profileend()return true end;local function d(d,g,h)debug.profilebegin("popper")b=f and f:GetRootPart()or f;local f=g;local e,i=e(d,g)if i<f then f=i end;if e<f and c(d,g,h)then f=e end;b=nil;debug.profileend()return f end;return d end;function _ZoomController()local b=4.5;local c=12.5;local d=0.0375;local e=0.5;local f=1;local g=_Popper()local h=math.clamp;local i=math.exp;local j=math.min;local k=math.max;local l=math.pi;local m,n;do local b=game:GetService("Players").LocalPlayer;local function c()m=b.CameraMinZoomDistance;n=b.CameraMaxZoomDistance end;c()b:GetPropertyChangedSignal("CameraMinZoomDistance"):Connect(c)b:GetPropertyChangedSignal("CameraMaxZoomDistance"):Connect(c)end;local o={}do o.__index=o;function o.new(b,c,d,e)c=h(c,d,e)return setmetatable({freq=b,x=c,v=0,minValue=d,maxValue=e,goal=c},o)end;function o:Step(b)local c=self.freq*2*l;local d=self.x;local e=self.v;local f=self.minValue;local g=self.maxValue;local h=self.goal;local d=h-d;local j=c*b;local i=i(-j)local b=h+(e*b-d*(j+1))*i;local c=((d*c-e)*j+e)*i;if b<f then b=f;c=0 elseif b>g then b=g;c=0 end;self.x=b;self.v=c;return b end end;local b=o.new(b,c,e,n)local function c(b,c,e,g)b=h(b+c*(1+b*d),e,g)if b<f then b=c<=0 and e or f end;return b end;local d=0;local h={}do function h.Update(h,i,l)local o=math.huge;if b.goal>f then local b=k(b.x,c(b.goal,d,m,n))o=g(i*CFrame.new(0,0,e),b-e,l)+e end;b.minValue=e;b.maxValue=j(n,o)return b:Step(h)end;function h.SetZoomParameters(c,e)b.goal=c;d=e end end;return h end;function _MouseLockController()local b="rbxasset://textures/MouseLockedCursor.png"local c="MouseLockSwitchAction"local d=Enum.ContextActionPriority.Default.Value;local e=game:GetService("Players")local f=game:GetService("ContextActionService")local g=UserSettings()local g=g.GameSettings;local h=e.LocalPlayer:GetMouse()local i={}i.__index=i;function i.new()local b=setmetatable({},i)b.isMouseLocked=false;b.savedMouseCursor=nil;b.boundKeys={Enum.KeyCode.LeftShift,Enum.KeyCode.RightShift}b.mouseLockToggledEvent=Instance.new("BindableEvent")local c=script:FindFirstChild("BoundKeys")if(not c)or(not c:IsA("StringValue"))then if c then c:Destroy()end;c=Instance.new("StringValue")c.Name="BoundKeys"c.Value="LeftShift,RightShift"c.Parent=script end;if c then c.Changed:Connect(function(c)b:OnBoundKeysObjectChanged(c)end)b:OnBoundKeysObjectChanged(c.Value)end;g.Changed:Connect(function(c)if c=="ControlMode"or c=="ComputerMovementMode"then b:UpdateMouseLockAvailability()end end)e.LocalPlayer:GetPropertyChangedSignal("DevEnableMouseLock"):Connect(function()b:UpdateMouseLockAvailability()end)e.LocalPlayer:GetPropertyChangedSignal("DevComputerMovementMode"):Connect(function()b:UpdateMouseLockAvailability()end)b:UpdateMouseLockAvailability()return b end;function i:GetIsMouseLocked()return self.isMouseLocked end;function i:GetBindableToggleEvent()return self.mouseLockToggledEvent.Event end;function i:GetMouseLockOffset()local b=script:FindFirstChild("CameraOffset")if b and b:IsA("Vector3Value")then return b.Value else if b then b:Destroy()end;b=Instance.new("Vector3Value")b.Name="CameraOffset"b.Value=Vector3.new(1.75,0,0)b.Parent=script end;if b and b.Value then return b.Value end;return Vector3.new(1.75,0,0)end;function i:UpdateMouseLockAvailability()local b=e.LocalPlayer.DevEnableMouseLock;local c=e.LocalPlayer.DevComputerMovementMode==Enum.DevComputerMovementMode.Scriptable;local d=g.ControlMode==Enum.ControlMode.MouseLockSwitch;local e=g.ComputerMovementMode==Enum.ComputerMovementMode.ClickToMove;local b=b and d and not e and not c;if b~=self.enabled then self:EnableMouseLock(b)end end;function i:OnBoundKeysObjectChanged(b)self.boundKeys={}for b in string.gmatch(b,"[^%s,]+")do for c,c in pairs(Enum.KeyCode:GetEnumItems())do if b==c.Name then self.boundKeys[#self.boundKeys+1]=c;break end end end;self:UnbindContextActions()self:BindContextActions()end;function i:OnMouseLockToggled()self.isMouseLocked=not self.isMouseLocked;if self.isMouseLocked then local c=script:FindFirstChild("CursorImage")if c and c:IsA("StringValue")and c.Value then self.savedMouseCursor=h.Icon;h.Icon=c.Value else if c then c:Destroy()end;c=Instance.new("StringValue")c.Name="CursorImage"c.Value=b;c.Parent=script;self.savedMouseCursor=h.Icon;h.Icon=b end else if self.savedMouseCursor then h.Icon=self.savedMouseCursor;self.savedMouseCursor=nil end end;self.mouseLockToggledEvent:Fire()end;function i:DoMouseLockSwitch(b,b,c)if b==Enum.UserInputState.Begin then self:OnMouseLockToggled()return Enum.ContextActionResult.Sink end;return Enum.ContextActionResult.Pass end;function i:BindContextActions()f:BindActionAtPriority(c,function(b,c,d)return self:DoMouseLockSwitch(b,c,d)end,false,d,unpack(self.boundKeys))end;function i:UnbindContextActions()f:UnbindAction(c)end;function i:IsMouseLocked()return self.enabled and self.isMouseLocked end;function i:EnableMouseLock(b)if b~=self.enabled then self.enabled=b;if self.enabled then self:BindContextActions()else if h.Icon~=""then h.Icon=""end;self:UnbindContextActions()if self.isMouseLocked then self.mouseLockToggledEvent:Fire()end;self.isMouseLocked=false end end end;return i end;function _TransparencyController()local b=2.8;local c=_CameraUtils()local d={}d.__index=d;function d.new()local b=setmetatable({},d)b.lastUpdate=tick()b.transparencyDirty=false;b.enabled=false;b.lastTransparency=nil;b.descendantAddedConn,b.descendantRemovingConn=nil,nil;b.toolDescendantAddedConns={}b.toolDescendantRemovingConns={}b.cachedParts={}return b end;function d:HasToolAncestor(b)if b.Parent==nil then return false end;return b.Parent:IsA('Tool')or self:HasToolAncestor(b.Parent)end;function d:IsValidPartToModify(b)if b:IsA('BasePart')or b:IsA('Decal')then return not self:HasToolAncestor(b)end;return false end;function d:CachePartsRecursive(b)if b then if self:IsValidPartToModify(b)then self.cachedParts[b]=true;self.transparencyDirty=true end;for b,b in pairs(b:GetChildren())do self:CachePartsRecursive(b)end end end;function d:TeardownTransparency()for b,c in pairs(self.cachedParts)do b.LocalTransparencyModifier=0 end;self.cachedParts={}self.transparencyDirty=true;self.lastTransparency=nil;if self.descendantAddedConn then self.descendantAddedConn:disconnect()self.descendantAddedConn=nil end;if self.descendantRemovingConn then self.descendantRemovingConn:disconnect()self.descendantRemovingConn=nil end;for b,c in pairs(self.toolDescendantAddedConns)do c:Disconnect()self.toolDescendantAddedConns[b]=nil end;for b,c in pairs(self.toolDescendantRemovingConns)do c:Disconnect()self.toolDescendantRemovingConns[b]=nil end end;function d:SetupTransparency(b)self:TeardownTransparency()if self.descendantAddedConn then self.descendantAddedConn:disconnect()end;self.descendantAddedConn=b.DescendantAdded:Connect(function(c)if self:IsValidPartToModify(c)then self.cachedParts[c]=true;self.transparencyDirty=true elseif c:IsA('Tool')then if self.toolDescendantAddedConns[c]then self.toolDescendantAddedConns[c]:Disconnect()end;self.toolDescendantAddedConns[c]=c.DescendantAdded:Connect(function(b)self.cachedParts[b]=nil;if b:IsA('BasePart')or b:IsA('Decal')then b.LocalTransparencyModifier=0 end end)if self.toolDescendantRemovingConns[c]then self.toolDescendantRemovingConns[c]:disconnect()end;self.toolDescendantRemovingConns[c]=c.DescendantRemoving:Connect(function(c)wait()if b and c and c:IsDescendantOf(b)then if self:IsValidPartToModify(c)then self.cachedParts[c]=true;self.transparencyDirty=true end end end)end end)if self.descendantRemovingConn then self.descendantRemovingConn:disconnect()end;self.descendantRemovingConn=b.DescendantRemoving:connect(function(b)if self.cachedParts[b]then self.cachedParts[b]=nil;b.LocalTransparencyModifier=0 end end)self:CachePartsRecursive(b)end;function d:Enable(b)if self.enabled~=b then self.enabled=b;self:Update()end end;function d:SetSubject(b)local c=nil;if b and b:IsA("Humanoid")then c=b.Parent end;if b and b:IsA("VehicleSeat")and b.Occupant then c=b.Occupant.Parent end;if c then self:SetupTransparency(c)else self:TeardownTransparency()end end;function d:Update()local d=false;local e=tick()local f=workspace.CurrentCamera;if f then local g=0;if not self.enabled then d=true else local f=(f.Focus.p-f.CoordinateFrame.p).magnitude;g=(f<2)and(1.0-(f-0.5)/1.5)or 0;if g<0.5 then g=0 end;if self.lastTransparency then local c=g-self.lastTransparency;if not d and g<1 and self.lastTransparency<0.95 then local b=b*(e-self.lastUpdate)c=math.clamp(c,-b,b)end;g=self.lastTransparency+c else self.transparencyDirty=true end;g=math.clamp(c.Round(g,2),0,1)end;if self.transparencyDirty or self.lastTransparency~=g then for b,c in pairs(self.cachedParts)do b.LocalTransparencyModifier=g end;self.transparencyDirty=false;self.lastTransparency=g end end;self.lastUpdate=e end;return d end;function _Poppercam()local b=_ZoomController()local c={}do c.__index=c;local b=CFrame.new()local function d(b)local b,c=b:toAxisAngle()return b*c end;local function e(c)local d=c.magnitude;if d>1e-5 then return CFrame.fromAxisAngle(c,d)end;return b end;local function b(b)local b,b,b,b,c,d,e,f,g,h,i,j=b:components()return CFrame.new(0,0,0,b,c,d,e,f,g,h,i,j)end;function c.new()return setmetatable({lastCFrame=nil},c)end;function c:Step(c,f)local g=self.lastCFrame or f;self.lastCFrame=f;local h=f.p;local f=b(f)local i=g.p;local b=b(g)local g=(h-i)/c;local b=d(f*b:inverse())/c;local function c(c)local d=g*c+h;local b=e(b*c)*f;return b+d end;return{extrapolate=c,posVelocity=g,rotVelocity=b}end;function c:Reset()self.lastCFrame=nil end end;local d=_BaseOcclusion()local e=setmetatable({},d)e.__index=e;function e.new()local b=setmetatable(d.new(),e)b.focusExtrapolator=c.new()return b end;function e:GetOcclusionMode()return Enum.DevCameraOcclusionMode.Zoom end;function e:Enable(b)self.focusExtrapolator:Reset()end;function e:Update(c,d,e,f)local d=CFrame.new(e.p,d.p)*CFrame.new(0,0,0,-1,0,0,0,1,0,0,0,-1)local f=self.focusExtrapolator:Step(c,d)local b=b.Update(c,d,f)return d*CFrame.new(0,0,b),e end;function e:CharacterAdded(b,b)end;function e:CharacterRemoving(b,b)end;function e:OnCameraSubjectChanged(b)end;local b=_ZoomController()function e:Update(c,d,e,f)local d=e*(d-d.p)local f=self.focusExtrapolator:Step(c,d)local b=b.Update(c,d,f)return d*CFrame.new(0,0,b),e end;return e end;function _Invisicam()local b=game:GetService("Players")local c=Vector3.new(0,0,0)local d=true;local e=0.75;local f=0.5;local g={LIMBS=2,MOVEMENT=3,CORNERS=4,CIRCLE1=5,CIRCLE2=6,LIMBMOVE=7,SMART_CIRCLE=8,CHAR_OUTLINE=9}local h={['Head']=true,['Left Arm']=true,['Right Arm']=true,['Left Leg']=true,['Right Leg']=true,['LeftLowerArm']=true,['RightLowerArm']=true,['LeftUpperLeg']=true,['RightUpperLeg']=true}local i={Vector3.new(1,1,-1),Vector3.new(1,-1,-1),Vector3.new(-1,-1,-1),Vector3.new(-1,1,-1)}local j=10;local k=3;local l=24;local m=2.0*math.pi/l;local n=24;local function o(b,...)local c={}local d=''for b,b in pairs({...})do c[b]=true;d=d..(d==''and''or' or ')..b end;local b=type(b)assert(c[b],d.." type expected, got: "..b)end;local function p(b,c,d,e,f,g,h,i,j)return(b*(f*j-g*i)-c*(e*j-g*h)+d*(e*i-f*h))end;local function q(b,d,e,f)local g=d:Cross(f)local h=e.x-b.x;local i=e.y-b.y;local j=e.z-b.z;local k=p(d.x,-f.x,g.x,d.y,-f.y,g.y,d.z,-f.z,g.z)if(k==0)then return c end;local l=p(h,-f.x,g.x,i,-f.y,g.y,j,-f.z,g.z)/k;local g=p(d.x,h,g.x,d.y,i,g.y,d.z,j,g.z)/k;local b=b+l*d;local d=e+g*f;local e=b+0.5*(d-b)if(d-b).Magnitude<0.25 then return e else return c end end;local p=_BaseOcclusion()local r=setmetatable({},p)r.__index=r;function r.new()local b=setmetatable(p.new(),r)b.char=nil;b.humanoidRootPart=nil;b.torsoPart=nil;b.headPart=nil;b.childAddedConn=nil;b.childRemovedConn=nil;b.behaviors={}b.behaviors[g.LIMBS]=b.LimbBehavior;b.behaviors[g.MOVEMENT]=b.MoveBehavior;b.behaviors[g.CORNERS]=b.CornerBehavior;b.behaviors[g.CIRCLE1]=b.CircleBehavior;b.behaviors[g.CIRCLE2]=b.CircleBehavior;b.behaviors[g.LIMBMOVE]=b.LimbMoveBehavior;b.behaviors[g.SMART_CIRCLE]=b.SmartCircleBehavior;b.behaviors[g.CHAR_OUTLINE]=b.CharacterOutlineBehavior;b.mode=g.SMART_CIRCLE;b.behaviorFunction=b.SmartCircleBehavior;b.savedHits={}b.trackedLimbs={}b.camera=game.Workspace.CurrentCamera;b.enabled=false;return b end;function r:Enable(b)self.enabled=b;if not b then self:Cleanup()end end;function r:GetOcclusionMode()return Enum.DevCameraOcclusionMode.Invisicam end;function r:LimbBehavior(b)for c,d in pairs(self.trackedLimbs)do b[#b+1]=c.Position end end;function r:MoveBehavior(b)for c=1,k do local d,e=self.humanoidRootPart.Position,self.humanoidRootPart.Velocity;local e=Vector3.new(e.X,0,e.Z).Magnitude/2;local c=(c-1)*self.humanoidRootPart.CFrame.lookVector*e;b[#b+1]=d+c end end;function r:CornerBehavior(b)local c=self.humanoidRootPart.CFrame;local d=c.p;local c=c-d;local e=self.char:GetExtentsSize()/2;b[#b+1]=d;for f=1,#i do b[#b+1]=d+(c*(e*i[f]))end end;function r:CircleBehavior(b)local c;if self.mode==g.CIRCLE1 then c=self.humanoidRootPart.CFrame else local b=self.camera.CoordinateFrame;c=b-b.p+self.humanoidRootPart.Position end;b[#b+1]=c.p;for d=0,j-1 do local d=(2*math.pi/j)*d;local d=3*Vector3.new(math.cos(d),math.sin(d),0)b[#b+1]=c*d end end;function r:LimbMoveBehavior(b)self:LimbBehavior(b)self:MoveBehavior(b)end;function r:CharacterOutlineBehavior(b)local d=self.torsoPart.CFrame.upVector.unit;local e=self.torsoPart.CFrame.rightVector.unit;b[#b+1]=self.torsoPart.CFrame.p;b[#b+1]=self.torsoPart.CFrame.p+d;b[#b+1]=self.torsoPart.CFrame.p-d;b[#b+1]=self.torsoPart.CFrame.p+e;b[#b+1]=self.torsoPart.CFrame.p-e;if self.headPart then b[#b+1]=self.headPart.CFrame.p end;local c=CFrame.new(c,Vector3.new(self.camera.CoordinateFrame.lookVector.X,0,self.camera.CoordinateFrame.lookVector.Z))local d=(self.torsoPart and self.torsoPart.Position or self.humanoidRootPart.Position)local e={self.torsoPart}if self.headPart then e[#e+1]=self.headPart end;for f=1,n do local f=(2*math.pi*f/n)local c=c*(3*Vector3.new(math.cos(f),math.sin(f),0))c=Vector3.new(c.X,math.max(c.Y,-2.25),c.Z)local c=Ray.new(d+c,-3*c)local c,e=game.Workspace:FindPartOnRayWithWhitelist(c,e,false,false)if c then b[#b+1]=e+0.2*(d-e).unit end end end;function r:SmartCircleBehavior(b)local c=self.torsoPart.CFrame.upVector.unit;local d=self.torsoPart.CFrame.rightVector.unit;b[#b+1]=self.torsoPart.CFrame.p;b[#b+1]=self.torsoPart.CFrame.p+c;b[#b+1]=self.torsoPart.CFrame.p-c;b[#b+1]=self.torsoPart.CFrame.p+d;b[#b+1]=self.torsoPart.CFrame.p-d;if self.headPart then b[#b+1]=self.headPart.CFrame.p end;local c=self.camera.CFrame-self.camera.CFrame.p;local d=Vector3.new(0,0.5,0)+(self.torsoPart and self.torsoPart.Position or self.humanoidRootPart.Position)local e=2.5;for f=1,l do local f=m*f-0.5*math.pi;local e=e*Vector3.new(math.cos(f),math.sin(f),0)local c=d+c*e;local e=c-self.camera.CFrame.p;local f=Ray.new(d,c-d)local f,g,h=game.Workspace:FindPartOnRayWithIgnoreList(f,{self.char},false,false)local i=c;if f then local b=g+0.1*h.unit;local f=b-d;local g=(f:Cross(e)).unit;local g=(g:Cross(h)).unit;local h=(b-self.camera.CFrame.p).unit;if(f.unit:Dot(-g)<f.unit:Dot(h))then i=q(b,g,c,e)if i.Magnitude>0 then local b=Ray.new(b,i-b)local b,c,d=game.Workspace:FindPartOnRayWithIgnoreList(b,{self.char},false,false)if b then local b=c+0.1*d.unit;i=b end else i=b end else i=b end;local b=Ray.new(d,(i-d))local b,c,e=game.Workspace:FindPartOnRayWithIgnoreList(b,{self.char},false,false)if b then local b=c-0.1*(i-d).unit;i=b end end;b[#b+1]=i end end;function r:CheckTorsoReference()if self.char then self.torsoPart=self.char:FindFirstChild("Torso")if not self.torsoPart then self.torsoPart=self.char:FindFirstChild("UpperTorso")if not self.torsoPart then self.torsoPart=self.char:FindFirstChild("HumanoidRootPart")end end;self.headPart=self.char:FindFirstChild("Head")end end;function r:CharacterAdded(c,d)if d~=b.LocalPlayer then return end;if self.childAddedConn then self.childAddedConn:Disconnect()self.childAddedConn=nil end;if self.childRemovedConn then self.childRemovedConn:Disconnect()self.childRemovedConn=nil end;self.char=c;self.trackedLimbs={}local function b(b)if b:IsA("BasePart")then if h[b.Name]then self.trackedLimbs[b]=true end;if b.Name=="Torso"or b.Name=="UpperTorso"then self.torsoPart=b end;if b.Name=="Head"then self.headPart=b end end end;local function d(b)self.trackedLimbs[b]=nil;self:CheckTorsoReference()end;self.childAddedConn=c.ChildAdded:Connect(b)self.childRemovedConn=c.ChildRemoved:Connect(d)for c,c in pairs(self.char:GetChildren())do b(c)end end;function r:SetMode(b)o(b,'number')for c,c in pairs(g)do if c==b then self.mode=b;self.behaviorFunction=self.behaviors[self.mode]return end end;error("Invalid mode number")end;function r:GetObscuredParts()return self.savedHits end;function r:Cleanup()for b,c in pairs(self.savedHits)do b.LocalTransparencyModifier=c end end;function r:Update(b,b,c)if not self.enabled or not self.char then return b,c end;self.camera=game.Workspace.CurrentCamera;if not self.humanoidRootPart then local d=self.char:FindFirstChildOfClass("Humanoid")if d and d.RootPart then self.humanoidRootPart=d.RootPart else self.humanoidRootPart=self.char:FindFirstChild("HumanoidRootPart")if not self.humanoidRootPart then return b,c end end;local b;b=self.humanoidRootPart.AncestryChanged:Connect(function(c,d)if c==self.humanoidRootPart and not d then self.humanoidRootPart=nil;if b and b.Connected then b:Disconnect()b=nil end end end)end;if not self.torsoPart then self:CheckTorsoReference()if not self.torsoPart then return b,c end end;local g={}self.behaviorFunction(self,g)local h={}local i={self.char}local function j(b)h[b]=true;if not self.savedHits[b]then self.savedHits[b]=b.LocalTransparencyModifier end end;local k;local l=0;local m={}local n=e;local o=e;if d then local b=self.headPart and self.headPart.CFrame.p or g[1]local c=self.torsoPart and self.torsoPart.CFrame.p or g[2]k=self.camera:GetPartsObscuringTarget({b,c},i)for b=1,#k do local b=k[b]l=l+1;m[b]=true;for b,b in pairs(b:GetChildren())do if b:IsA('Decal')or b:IsA('Texture')then l=l+1;break end end end;if(l>0)then n=math.pow(((0.5*e)+(0.5*e/l)),1/l)o=math.pow(((0.5*f)+(0.5*f/l)),1/l)end end;k=self.camera:GetPartsObscuringTarget(g,i)local d={}for b=1,#k do local b=k[b]d[b]=m[b]and n or o;if b.Transparency<d[b]then j(b)end;for c,c in pairs(b:GetChildren())do if c:IsA('Decal')or c:IsA('Texture')then if(c.Transparency<d[b])then d[c]=d[b]j(c)end end end end;for b,c in pairs(self.savedHits)do if h[b]then b.LocalTransparencyModifier=(b.Transparency<1)and((d[b]-b.Transparency)/(1.0-b.Transparency))or 0 else b.LocalTransparencyModifier=c;self.savedHits[b]=nil end end;return b,c end;return r end;function _LegacyCamera()local b=Vector2.new(0,0)local c=_CameraUtils()local d=game:GetService('Players')local e=_BaseCamera()local f=setmetatable({},e)f.__index=f;function f.new()local b=setmetatable(e.new(),f)b.cameraType=Enum.CameraType.Fixed;b.lastUpdate=tick()b.lastDistanceToSubject=nil;return b end;function f:GetModuleName()return"LegacyCamera"end;function f:SetCameraToSubjectDistance(b)return e.SetCameraToSubjectDistance(self,b)end;function f:Update(e)if not self.cameraType then return end;local e=tick()local f=(e-self.lastUpdate)local g=workspace.CurrentCamera;local h=g.CFrame;local i=g.Focus;local d=d.LocalPlayer;if self.lastUpdate==nil or f>1 then self.lastDistanceToSubject=nil end;local f=self:GetSubjectPosition()if self.cameraType==Enum.CameraType.Fixed then if self.lastUpdate then local b=math.min(0.1,e-self.lastUpdate)local c=self:UpdateGamepad()self.rotateInput=self.rotateInput+(c*b)end;if f and d and g then local c=self:GetCameraToSubjectDistance()local d=self:CalculateNewLookVector()self.rotateInput=b;i=g.Focus;h=CFrame.new(g.CFrame.p,g.CFrame.p+(c*d))end elseif self.cameraType==Enum.CameraType.Attach then if f and g then local d=self:GetCameraToSubjectDistance()local g=self:GetHumanoid()if self.lastUpdate and g and g.RootPart then local b=math.min(0.1,e-self.lastUpdate)local d=self:UpdateGamepad()self.rotateInput=self.rotateInput+(d*b)local b=g.RootPart.CFrame.lookVector;local b=c.GetAngleBetweenXZVectors(b,self:GetCameraLookVector())if c.IsFinite(b)then self.rotateInput=Vector2.new(b,self.rotateInput.Y)end end;local c=self:CalculateNewLookVector()self.rotateInput=b;i=CFrame.new(f)h=CFrame.new(f-(d*c),f)end elseif self.cameraType==Enum.CameraType.Watch then if f and d and g then local c=nil;local d=self:GetHumanoid()if d and d.RootPart then local b=f-g.CFrame.p;c=b.unit;if self.lastDistanceToSubject and self.lastDistanceToSubject==self:GetCameraToSubjectDistance()then local b=b.magnitude;self:SetCameraToSubjectDistance(b)end end;local d=self:GetCameraToSubjectDistance()local c=self:CalculateNewLookVector(c)self.rotateInput=b;i=CFrame.new(f)h=CFrame.new(f-(d*c),f)self.lastDistanceToSubject=d end else return g.CFrame,g.Focus end;self.lastUpdate=e;return h,i end;return f end;function _OrbitalCamera()local b=Vector3.new(0,0,1)local c=Vector3.new(1,0,1)local d=Vector3.new(0,0,0)local e=Vector2.new(0,0)local f=2*math.pi;local g=0.2;local h=-80;local i=80;local j={}j["InitialDistance"]=25;j["MinDistance"]=10;j["MaxDistance"]=100;j["InitialElevation"]=35;j["MinElevation"]=35;j["MaxElevation"]=35;j["ReferenceAzimuth"]=-45;j["CWAzimuthTravel"]=90;j["CCWAzimuthTravel"]=90;j["UseAzimuthLimits"]=false;local j=_CameraUtils()local k=game:GetService('Players')local l=game:GetService("VRService")local m=_BaseCamera()local n=setmetatable({},m)n.__index=n;function n.new()local b=setmetatable(m.new(),n)b.lastUpdate=tick()b.changedSignalConnections={}b.refAzimuthRad=nil;b.curAzimuthRad=nil;b.minAzimuthAbsoluteRad=nil;b.maxAzimuthAbsoluteRad=nil;b.useAzimuthLimits=nil;b.curElevationRad=nil;b.minElevationRad=nil;b.maxElevationRad=nil;b.curDistance=nil;b.minDistance=nil;b.maxDistance=nil;b.r3ButtonDown=false;b.l3ButtonDown=false;b.gamepadDollySpeedMultiplier=1;b.lastUserPanCamera=tick()b.externalProperties={}b.externalProperties["InitialDistance"]=25;b.externalProperties["MinDistance"]=10;b.externalProperties["MaxDistance"]=100;b.externalProperties["InitialElevation"]=35;b.externalProperties["MinElevation"]=35;b.externalProperties["MaxElevation"]=35;b.externalProperties["ReferenceAzimuth"]=-45;b.externalProperties["CWAzimuthTravel"]=90;b.externalProperties["CCWAzimuthTravel"]=90;b.externalProperties["UseAzimuthLimits"]=false;b:LoadNumberValueParameters()return b end;function n:LoadOrCreateNumberValueParameter(b,c,d)local e=script:FindFirstChild(b)if e and e:isA(c)then self.externalProperties[b]=e.Value elseif self.externalProperties[b]~=nil then e=Instance.new(c)e.Name=b;e.Parent=script;e.Value=self.externalProperties[b]else print("externalProperties table has no entry for ",b)return end;if d then if self.changedSignalConnections[b]then self.changedSignalConnections[b]:Disconnect()end;self.changedSignalConnections[b]=e.Changed:Connect(function(c)self.externalProperties[b]=c;d(self)end)end end;function n:SetAndBoundsCheckAzimuthValues()self.minAzimuthAbsoluteRad=math.rad(self.externalProperties["ReferenceAzimuth"])-math.abs(math.rad(self.externalProperties["CWAzimuthTravel"]))self.maxAzimuthAbsoluteRad=math.rad(self.externalProperties["ReferenceAzimuth"])+math.abs(math.rad(self.externalProperties["CCWAzimuthTravel"]))self.useAzimuthLimits=self.externalProperties["UseAzimuthLimits"]if self.useAzimuthLimits then self.curAzimuthRad=math.max(self.curAzimuthRad,self.minAzimuthAbsoluteRad)self.curAzimuthRad=math.min(self.curAzimuthRad,self.maxAzimuthAbsoluteRad)end end;function n:SetAndBoundsCheckElevationValues()local b=math.max(self.externalProperties["MinElevation"],h)local c=math.min(self.externalProperties["MaxElevation"],i)self.minElevationRad=math.rad(math.min(b,c))self.maxElevationRad=math.rad(math.max(b,c))self.curElevationRad=math.max(self.curElevationRad,self.minElevationRad)self.curElevationRad=math.min(self.curElevationRad,self.maxElevationRad)end;function n:SetAndBoundsCheckDistanceValues()self.minDistance=self.externalProperties["MinDistance"]self.maxDistance=self.externalProperties["MaxDistance"]self.curDistance=math.max(self.curDistance,self.minDistance)self.curDistance=math.min(self.curDistance,self.maxDistance)end;function n:LoadNumberValueParameters()self:LoadOrCreateNumberValueParameter("InitialElevation","NumberValue",nil)self:LoadOrCreateNumberValueParameter("InitialDistance","NumberValue",nil)self:LoadOrCreateNumberValueParameter("ReferenceAzimuth","NumberValue",self.SetAndBoundsCheckAzimuthValue)self:LoadOrCreateNumberValueParameter("CWAzimuthTravel","NumberValue",self.SetAndBoundsCheckAzimuthValues)self:LoadOrCreateNumberValueParameter("CCWAzimuthTravel","NumberValue",self.SetAndBoundsCheckAzimuthValues)self:LoadOrCreateNumberValueParameter("MinElevation","NumberValue",self.SetAndBoundsCheckElevationValues)self:LoadOrCreateNumberValueParameter("MaxElevation","NumberValue",self.SetAndBoundsCheckElevationValues)self:LoadOrCreateNumberValueParameter("MinDistance","NumberValue",self.SetAndBoundsCheckDistanceValues)self:LoadOrCreateNumberValueParameter("MaxDistance","NumberValue",self.SetAndBoundsCheckDistanceValues)self:LoadOrCreateNumberValueParameter("UseAzimuthLimits","BoolValue",self.SetAndBoundsCheckAzimuthValues)self.curAzimuthRad=math.rad(self.externalProperties["ReferenceAzimuth"])self.curElevationRad=math.rad(self.externalProperties["InitialElevation"])self.curDistance=self.externalProperties["InitialDistance"]self:SetAndBoundsCheckAzimuthValues()self:SetAndBoundsCheckElevationValues()self:SetAndBoundsCheckDistanceValues()end;function n:GetModuleName()return"OrbitalCamera"end;function n:SetInitialOrientation(b)if not b or not b.RootPart then warn("OrbitalCamera could not set initial orientation due to missing humanoid")return end;local b=(b.RootPart.CFrame.lookVector-Vector3.new(0,0.23,0)).unit;local c=j.GetAngleBetweenXZVectors(b,self:GetCameraLookVector())local b=math.asin(self:GetCameraLookVector().y)-math.asin(b.y)if not j.IsFinite(c)then c=0 end;if not j.IsFinite(b)then b=0 end;self.rotateInput=Vector2.new(c,b)end;function n:GetCameraToSubjectDistance()return self.curDistance end;function n:SetCameraToSubjectDistance(b)print("OrbitalCamera SetCameraToSubjectDistance ",b)local c=k.LocalPlayer;if c then self.currentSubjectDistance=math.clamp(b,self.minDistance,self.maxDistance)self.currentSubjectDistance=math.max(self.currentSubjectDistance,self.FIRST_PERSON_DISTANCE_THRESHOLD)end;self.inFirstPerson=false;self:UpdateMouseBehavior()return self.currentSubjectDistance end;function n:CalculateNewLookVector(b,c)local b=b or self:GetCameraLookVector()local e=math.asin(b.y)local e=math.clamp(c.y,e-math.rad(i),e-math.rad(h))local c=Vector2.new(c.x,e)local b=CFrame.new(d,b)local b=(CFrame.Angles(0,-c.x,0)*b*CFrame.Angles(-c.y,0,0)).lookVector;return b end;function n:GetGamepadPan(b,b,c)if c.UserInputType==self.activeGamepad and c.KeyCode==Enum.KeyCode.Thumbstick2 then if self.r3ButtonDown or self.l3ButtonDown then if(c.Position.Y>g)then self.gamepadDollySpeedMultiplier=0.96 elseif(c.Position.Y<-g)then self.gamepadDollySpeedMultiplier=1.04 else self.gamepadDollySpeedMultiplier=1.00 end else if b==Enum.UserInputState.Cancel then self.gamepadPanningCamera=e;return end;local b=Vector2.new(c.Position.X,-c.Position.Y)if b.magnitude>g then self.gamepadPanningCamera=Vector2.new(c.Position.X,-c.Position.Y)else self.gamepadPanningCamera=e end end;return Enum.ContextActionResult.Sink end;return Enum.ContextActionResult.Pass end;function n:DoGamepadZoom(b,b,c)if c.UserInputType==self.activeGamepad and(c.KeyCode==Enum.KeyCode.ButtonR3 or c.KeyCode==Enum.KeyCode.ButtonL3)then if(b==Enum.UserInputState.Begin)then self.r3ButtonDown=c.KeyCode==Enum.KeyCode.ButtonR3;self.l3ButtonDown=c.KeyCode==Enum.KeyCode.ButtonL3 elseif(b==Enum.UserInputState.End)then if(c.KeyCode==Enum.KeyCode.ButtonR3)then self.r3ButtonDown=false elseif(c.KeyCode==Enum.KeyCode.ButtonL3)then self.l3ButtonDown=false end;if(not self.r3ButtonDown)and(not self.l3ButtonDown)then self.gamepadDollySpeedMultiplier=1.00 end end;return Enum.ContextActionResult.Sink end;return Enum.ContextActionResult.Pass end;function n:BindGamepadInputActions()self:BindAction("OrbitalCamGamepadPan",function(b,c,d)return self:GetGamepadPan(b,c,d)end,false,Enum.KeyCode.Thumbstick2)self:BindAction("OrbitalCamGamepadZoom",function(b,c,d)return self:DoGamepadZoom(b,c,d)end,false,Enum.KeyCode.ButtonR3,Enum.KeyCode.ButtonL3)end;function n:Update(d)local d=tick()local g=(d-self.lastUpdate)local h=(self.UserPanningTheCamera==true)local i=workspace.CurrentCamera;local j=i.CFrame;local m=i.Focus;local k=k.LocalPlayer;local n=i and i.CameraSubject;local o=n and n:IsA('VehicleSeat')local p=n and n:IsA('SkateboardPlatform')if self.lastUpdate==nil or g>1 then self.lastCameraTransform=nil end;if self.lastUpdate then local b=self:UpdateGamepad()if self:ShouldUseVRRotation()then self.RotateInput=self.RotateInput+self:GetVRRotationInput()else local c=math.min(0.1,g)if b~=e then h=true;self.rotateInput=self.rotateInput+(b*c)end;local b=0;if not(o or p)then b=b+(self.TurningLeft and-120 or 0)b=b+(self.TurningRight and 120 or 0)end;if b~=0 then self.rotateInput=self.rotateInput+Vector2.new(math.rad(b*c),0)h=true end end end;if h then self.lastUserPanCamera=tick()end;local h=self:GetSubjectPosition()if h and k and i then if self.gamepadDollySpeedMultiplier~=1 then self:SetCameraToSubjectDistance(self.currentSubjectDistance*self.gamepadDollySpeedMultiplier)end;local d=l.VREnabled;m=d and self:GetVRFocus(h,g)or CFrame.new(h)local g=m.p;if d and not self:IsInFirstPerson()then local b=self:GetCameraHeight()local d=(h-i.CFrame.p)local f=d.magnitude;if f>self.currentSubjectDistance or self.rotateInput.x~=0 then local f=math.min(f,self.currentSubjectDistance)d=self:CalculateNewLookVector(d.unit*c,Vector2.new(self.rotateInput.x,0))*f;local c=g-d;local f=i.CFrame.lookVector;if self.rotateInput.x~=0 then f=d end;local d=Vector3.new(c.x+f.x,c.y,c.z+f.z)self.RotateInput=e;j=CFrame.new(c,d)+Vector3.new(0,b,0)end else self.curAzimuthRad=self.curAzimuthRad-self.rotateInput.x;if self.useAzimuthLimits then self.curAzimuthRad=math.clamp(self.curAzimuthRad,self.minAzimuthAbsoluteRad,self.maxAzimuthAbsoluteRad)else self.curAzimuthRad=(self.curAzimuthRad~=0)and(math.sign(self.curAzimuthRad)*(math.abs(self.curAzimuthRad)%f))or 0 end;self.curElevationRad=math.clamp(self.curElevationRad+self.rotateInput.y,self.minElevationRad,self.maxElevationRad)local b=self.currentSubjectDistance*(CFrame.fromEulerAnglesYXZ(-self.curElevationRad,self.curAzimuthRad,0)*b)local b=h+b;j=CFrame.new(b,h)self.rotateInput=e end;self.lastCameraTransform=j;self.lastCameraFocus=m;if(o or p)and n:IsA('BasePart')then self.lastSubjectCFrame=n.CFrame else self.lastSubjectCFrame=nil end end;self.lastUpdate=d;return j,m end;return n end;function _ClassicCamera()local b=Vector2.new(0,0)local c=math.rad(220)local d=math.rad(0)local e=math.rad(250)local f=2.0;local g=CFrame.fromOrientation(math.rad(-15),0,0)local h;do local b,c=pcall(function()return UserSettings():IsUserFeatureEnabled("UserCameraToggle")end)h=b and c end;local i=game:GetService('Players')local j=game:GetService("VRService")local k=_CameraInput()local l=_CameraUtils()local m=_BaseCamera()local n=setmetatable({},m)n.__index=n;function n.new()local b=setmetatable(m.new(),n)b.isFollowCamera=false;b.isCameraToggle=false;b.lastUpdate=tick()b.cameraToggleSpring=l.Spring.new(5,0)return b end;function n:GetCameraToggleOffset(b)assert(h)if self.isCameraToggle then local c=self.currentSubjectDistance;if k.getTogglePan()then self.cameraToggleSpring.goal=math.clamp(l.map(c,0.5,self.FIRST_PERSON_DISTANCE_THRESHOLD,0,1),0,1)else self.cameraToggleSpring.goal=0 end;local c=math.clamp(l.map(c,0.5,64,0,1),0,1)+1;return Vector3.new(0,self.cameraToggleSpring:step(b)*c,0)end;return Vector3.new()end;function n:SetCameraMovementMode(b)m.SetCameraMovementMode(self,b)self.isFollowCamera=b==Enum.ComputerCameraMovementMode.Follow;self.isCameraToggle=b==Enum.ComputerCameraMovementMode.CameraToggle end;function n:Update()local k=tick()local m=k-self.lastUpdate;local n=workspace.CurrentCamera;local o=n.CFrame;local p=n.Focus;local q=nil;if self.resetCameraAngle then local b=self:GetHumanoidRootPart()if b then q=(b.CFrame*g).lookVector else q=g.lookVector end;self.resetCameraAngle=false end;local g=i.LocalPlayer;local i=self:GetHumanoid()local r=n.CameraSubject;local s=r and r:IsA('VehicleSeat')local t=r and r:IsA('SkateboardPlatform')local u=i and i:GetState()==Enum.HumanoidStateType.Climbing;if self.lastUpdate==nil or m>1 then self.lastCameraTransform=nil end;if self.lastUpdate then local c=self:UpdateGamepad()if self:ShouldUseVRRotation()then self.rotateInput=self.rotateInput+self:GetVRRotationInput()else local d=math.min(0.1,m)if c~=b then self.rotateInput=self.rotateInput+(c*d)end;local b=0;if not(s or t)then b=b+(self.turningLeft and-120 or 0)b=b+(self.turningRight and 120 or 0)end;if b~=0 then self.rotateInput=self.rotateInput+Vector2.new(math.rad(b*d),0)end end end;local v=self:GetCameraHeight()if self.userPanningTheCamera then d=0;self.lastUserPanCamera=tick()end;local f=k-self.lastUserPanCamera<f;local w=self:GetSubjectPosition()if w and g and n then local g=self:GetCameraToSubjectDistance()if g<0.5 then g=0.5 end;if self:GetIsMouseLocked()and not self:IsInFirstPerson()then local b=self:CalculateNewLookCFrame(q)local c=self:GetMouseLockOffset()local b=c.X*b.rightVector+c.Y*b.upVector+c.Z*b.lookVector;if l.IsFiniteVector3(b)then w=w+b end else if not self.userPanningTheCamera and self.lastCameraTransform then local b=self:IsInFirstPerson()if(s or t or(self.isFollowCamera and u))and self.lastUpdate and i and i.Torso then if b then if self.lastSubjectCFrame and(s or t)and r:IsA('BasePart')then local b=-l.GetAngleBetweenXZVectors(self.lastSubjectCFrame.lookVector,r.CFrame.lookVector)if l.IsFinite(b)then self.rotateInput=self.rotateInput+Vector2.new(b,0)end;d=0 end elseif not f then local b=i.Torso.CFrame.lookVector;if t then b=r.CFrame.lookVector end;d=math.clamp(d+c*m,0,e)local c=math.clamp(d*m,0,1)if self:IsInFirstPerson()and not(self.isFollowCamera and self.isClimbing)then c=1 end;local b=l.GetAngleBetweenXZVectors(b,self:GetCameraLookVector())if l.IsFinite(b)and math.abs(b)>0.0001 then self.rotateInput=self.rotateInput+Vector2.new(b*c,0)end end elseif self.isFollowCamera and(not(b or f)and not j.VREnabled)then local b=-(self.lastCameraTransform.p-w)local b=l.GetAngleBetweenXZVectors(b,self:GetCameraLookVector())local c=0.4;if l.IsFinite(b)and math.abs(b)>0.0001 and math.abs(b)>c*m then self.rotateInput=self.rotateInput+Vector2.new(b,0)end end end end;if not self.isFollowCamera then local c=j.VREnabled;if c then p=self:GetVRFocus(w,m)else p=CFrame.new(w)end;local d=p.p;if c and not self:IsInFirstPerson()then local c=(w-n.CFrame.p)local e=c.magnitude;if e>g or self.rotateInput.x~=0 then local e=math.min(e,g)c=self:CalculateNewLookVectorVR()*e;local d=d-c;local e=n.CFrame.lookVector;if self.rotateInput.x~=0 then e=c end;local c=Vector3.new(d.x+e.x,d.y,d.z+e.z)self.rotateInput=b;o=CFrame.new(d,c)+Vector3.new(0,v,0)end else local c=self:CalculateNewLookVector(q)self.rotateInput=b;o=CFrame.new(d-(g*c),d)end else local c=self:CalculateNewLookVector(q)self.rotateInput=b;if j.VREnabled then p=self:GetVRFocus(w,m)else p=CFrame.new(w)end;o=CFrame.new(p.p-(g*c),p.p)+Vector3.new(0,v,0)end;if h then local b=self:GetCameraToggleOffset(m)p=p+b;o=o+b end;self.lastCameraTransform=o;self.lastCameraFocus=p;if(s or t)and r:IsA('BasePart')then self.lastSubjectCFrame=r.CFrame else self.lastSubjectCFrame=nil end end;self.lastUpdate=k;return o,p end;function n:EnterFirstPerson()self.inFirstPerson=true;self:UpdateMouseBehavior()end;function n:LeaveFirstPerson()self.inFirstPerson=false;self:UpdateMouseBehavior()end;return n end;function _CameraUtils()local b={}local c;do local b,d=pcall(function()return UserSettings():IsUserFeatureEnabled("UserCameraToggle")end)c=b and d end;local function d(b)return math.floor(b+0.5)end;local e={}do e.__index=e;function e.new(b,c)return setmetatable({freq=b,goal=c,pos=c,vel=0},e)end;function e:step(b)local c=self.freq*2*math.pi;local d=self.goal;local e=self.pos;local f=self.vel;local e=e-d;local g=math.exp(-c*b)local d=(e*(1+c*b)+f*b)*g+d;local b=(f*(1-c*b)-e*(c*c*b))*g;self.pos=d;self.vel=b;return d end end;b.Spring=e;function b.map(b,c,d,e,f)return(b-c)*(f-e)/(d-c)+e end;function b.Round(b,c)local c=10^c;return math.floor(b*c+0.5)/c end;function b.IsFinite(b)return b==b and b~=math.huge and b~=-math.huge end;function b.IsFiniteVector3(c)return b.IsFinite(c.X)and b.IsFinite(c.Y)and b.IsFinite(c.Z)end;function b.GetAngleBetweenXZVectors(b,c)return math.atan2(c.X*b.Z-c.Z*b.X,c.X*b.X+c.Z*b.Z)end;function b.RotateVectorByAngleAndRound(b,c,e)if b.Magnitude>0 then b=b.unit;local f=math.atan2(b.z,b.x)local b=d((math.atan2(b.z,b.x)+c)/e)*e;return b-f end;return 0 end;local d=0.35;local e=0.8;local function f(b)b=math.clamp(b,-1,1)if b>=0 then return(d*b)/(d-b+1)end;return-((e*-b)/(e+b+1))end;local d=0.1;local function e(b)return(1+d)*(2*math.abs(b)-1)-d end;local function d(b)return b/2+0.5 end;function b.GamepadLinearToCurve(b)local function c(b)local c=1;if b<0 then c=-1 end;local b=d(f(e(math.abs(b))))b=b*c;return math.clamp(b,-1,1)end;return Vector2.new(c(b.x),c(b.y))end;function b.ConvertCameraModeEnumToStandard(b)if b==Enum.TouchCameraMovementMode.Default then return Enum.ComputerCameraMovementMode.Follow end;if b==Enum.ComputerCameraMovementMode.Default then return Enum.ComputerCameraMovementMode.Classic end;if b==Enum.TouchCameraMovementMode.Classic or b==Enum.DevTouchCameraMovementMode.Classic or b==Enum.DevComputerCameraMovementMode.Classic or b==Enum.ComputerCameraMovementMode.Classic then return Enum.ComputerCameraMovementMode.Classic end;if b==Enum.TouchCameraMovementMode.Follow or b==Enum.DevTouchCameraMovementMode.Follow or b==Enum.DevComputerCameraMovementMode.Follow or b==Enum.ComputerCameraMovementMode.Follow then return Enum.ComputerCameraMovementMode.Follow end;if b==Enum.TouchCameraMovementMode.Orbital or b==Enum.DevTouchCameraMovementMode.Orbital or b==Enum.DevComputerCameraMovementMode.Orbital or b==Enum.ComputerCameraMovementMode.Orbital then return Enum.ComputerCameraMovementMode.Orbital end;if c then if b==Enum.ComputerCameraMovementMode.CameraToggle or b==Enum.DevComputerCameraMovementMode.CameraToggle then return Enum.ComputerCameraMovementMode.CameraToggle end end;if b==Enum.DevTouchCameraMovementMode.UserChoice or b==Enum.DevComputerCameraMovementMode.UserChoice then return Enum.DevComputerCameraMovementMode.UserChoice end;return Enum.ComputerCameraMovementMode.Classic end;return b end;function _CameraModule()local b={}b.__index=b;local c;do local b,d=pcall(function()return UserSettings():IsUserFeatureEnabled("UserCameraToggle")end)c=b and d end;local d;do local b,c=pcall(function()return UserSettings():IsUserFeatureEnabled("UserRemoveTheCameraApi")end)d=b and c end;local d={"CameraMinZoomDistance","CameraMaxZoomDistance","CameraMode","DevCameraOcclusionMode","DevComputerCameraMode","DevTouchCameraMode","DevComputerMovementMode","DevTouchMovementMode","DevEnableMouseLock"}local e={"ComputerCameraMovementMode","ComputerMovementMode","ControlMode","GamepadCameraSensitivity","MouseSensitivity","RotationType","TouchCameraMovementMode","TouchMovementMode"}local f=game:GetService("Players")local g=game:GetService("RunService")local h=game:GetService("UserInputService")local i=UserSettings():GetService("UserGameSettings")local j=_CameraUtils()local k=_ClassicCamera()local l=_OrbitalCamera()local m=_LegacyCamera()local n=_Invisicam()local o=_Poppercam()local p=_TransparencyController()local q=_MouseLockController()local r={}local s={}do local b=f.LocalPlayer:WaitForChild("PlayerScripts")b:RegisterTouchCameraMovementMode(Enum.TouchCameraMovementMode.Default)b:RegisterTouchCameraMovementMode(Enum.TouchCameraMovementMode.Follow)b:RegisterTouchCameraMovementMode(Enum.TouchCameraMovementMode.Classic)b:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.Default)b:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.Follow)b:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.Classic)if c then b:RegisterComputerCameraMovementMode(Enum.ComputerCameraMovementMode.CameraToggle)end end;b.FFlagUserCameraToggle=c;function b.new()local b=setmetatable({},b)b.activeCameraController=nil;b.activeOcclusionModule=nil;b.activeTransparencyController=nil;b.activeMouseLockController=nil;b.currentComputerCameraMovementMode=nil;b.cameraSubjectChangedConn=nil;b.cameraTypeChangedConn=nil;for c,c in pairs(f:GetPlayers())do b:OnPlayerAdded(c)end;f.PlayerAdded:Connect(function(c)b:OnPlayerAdded(c)end)b.activeTransparencyController=p.new()b.activeTransparencyController:Enable(true)if not h.TouchEnabled then b.activeMouseLockController=q.new()local c=b.activeMouseLockController:GetBindableToggleEvent()if c then c:Connect(function()b:OnMouseLockToggled()end)end end;b:ActivateCameraController(b:GetCameraControlChoice())b:ActivateOcclusionModule(f.LocalPlayer.DevCameraOcclusionMode)b:OnCurrentCameraChanged()g:BindToRenderStep("cameraRenderUpdate",Enum.RenderPriority.Camera.Value,function(c)b:Update(c)end)for c,c in pairs(d)do f.LocalPlayer:GetPropertyChangedSignal(c):Connect(function()b:OnLocalPlayerCameraPropertyChanged(c)end)end;for c,c in pairs(e)do i:GetPropertyChangedSignal(c):Connect(function()b:OnUserGameSettingsPropertyChanged(c)end)end;game.Workspace:GetPropertyChangedSignal("CurrentCamera"):Connect(function()b:OnCurrentCameraChanged()end)b.lastInputType=h:GetLastInputType()h.LastInputTypeChanged:Connect(function(c)b.lastInputType=c end)return b end;function b:GetCameraMovementModeFromSettings()local b=f.LocalPlayer.CameraMode;if b==Enum.CameraMode.LockFirstPerson then return j.ConvertCameraModeEnumToStandard(Enum.ComputerCameraMovementMode.Classic)end;local b,c;if h.TouchEnabled then b=j.ConvertCameraModeEnumToStandard(f.LocalPlayer.DevTouchCameraMode)c=j.ConvertCameraModeEnumToStandard(i.TouchCameraMovementMode)else b=j.ConvertCameraModeEnumToStandard(f.LocalPlayer.DevComputerCameraMode)c=j.ConvertCameraModeEnumToStandard(i.ComputerCameraMovementMode)end;if b==Enum.DevComputerCameraMovementMode.UserChoice then return c end;return b end;function b:ActivateOcclusionModule(b)local c;if b==Enum.DevCameraOcclusionMode.Zoom then c=o elseif b==Enum.DevCameraOcclusionMode.Invisicam then c=n else warn("CameraScript ActivateOcclusionModule called with unsupported mode")return end;if self.activeOcclusionModule and self.activeOcclusionModule:GetOcclusionMode()==b then if not self.activeOcclusionModule:GetEnabled()then self.activeOcclusionModule:Enable(true)end;return end;local d=self.activeOcclusionModule;self.activeOcclusionModule=s[c]if not self.activeOcclusionModule then self.activeOcclusionModule=c.new()if self.activeOcclusionModule then s[c]=self.activeOcclusionModule end end;if self.activeOcclusionModule then local c=self.activeOcclusionModule:GetOcclusionMode()if c~=b then warn("CameraScript ActivateOcclusionModule mismatch: ",self.activeOcclusionModule:GetOcclusionMode(),"~=",b)end;if d then if d~=self.activeOcclusionModule then d:Enable(false)else warn("CameraScript ActivateOcclusionModule failure to detect already running correct module")end end;if b==Enum.DevCameraOcclusionMode.Invisicam then if f.LocalPlayer.Character then self.activeOcclusionModule:CharacterAdded(f.LocalPlayer.Character,f.LocalPlayer)end else for b,b in pairs(f:GetPlayers())do if b and b.Character then self.activeOcclusionModule:CharacterAdded(b.Character,b)end end;self.activeOcclusionModule:OnCameraSubjectChanged(game.Workspace.CurrentCamera.CameraSubject)end;self.activeOcclusionModule:Enable(true)end end;function b:ActivateCameraController(b,d)local e=nil;if d~=nil then if d==Enum.CameraType.Scriptable then if self.activeCameraController then self.activeCameraController:Enable(false)self.activeCameraController=nil;return end elseif d==Enum.CameraType.Custom then b=self:GetCameraMovementModeFromSettings()elseif d==Enum.CameraType.Track then b=Enum.ComputerCameraMovementMode.Classic elseif d==Enum.CameraType.Follow then b=Enum.ComputerCameraMovementMode.Follow elseif d==Enum.CameraType.Orbital then b=Enum.ComputerCameraMovementMode.Orbital elseif d==Enum.CameraType.Attach or d==Enum.CameraType.Watch or d==Enum.CameraType.Fixed then e=m else warn("CameraScript encountered an unhandled Camera.CameraType value: ",d)end end;if not e then if b==Enum.ComputerCameraMovementMode.Classic or b==Enum.ComputerCameraMovementMode.Follow or b==Enum.ComputerCameraMovementMode.Default or(c and b==Enum.ComputerCameraMovementMode.CameraToggle)then e=k elseif b==Enum.ComputerCameraMovementMode.Orbital then e=l else warn("ActivateCameraController did not select a module.")return end end;local c;if not r[e]then c=e.new()r[e]=c else c=r[e]end;if self.activeCameraController then if self.activeCameraController~=c then self.activeCameraController:Enable(false)self.activeCameraController=c;self.activeCameraController:Enable(true)elseif not self.activeCameraController:GetEnabled()then self.activeCameraController:Enable(true)end elseif c~=nil then self.activeCameraController=c;self.activeCameraController:Enable(true)end;if self.activeCameraController then if b~=nil then self.activeCameraController:SetCameraMovementMode(b)elseif d~=nil then self.activeCameraController:SetCameraType(d)end end end;function b:OnCameraSubjectChanged()if self.activeTransparencyController then self.activeTransparencyController:SetSubject(game.Workspace.CurrentCamera.CameraSubject)end;if self.activeOcclusionModule then self.activeOcclusionModule:OnCameraSubjectChanged(game.Workspace.CurrentCamera.CameraSubject)end end;function b:OnCameraTypeChanged(b)if b==Enum.CameraType.Scriptable then if h.MouseBehavior==Enum.MouseBehavior.LockCenter then h.MouseBehavior=Enum.MouseBehavior.Default end end;self:ActivateCameraController(nil,b)end;function b:OnCurrentCameraChanged()local b=game.Workspace.CurrentCamera;if not b then return end;if self.cameraSubjectChangedConn then self.cameraSubjectChangedConn:Disconnect()end;if self.cameraTypeChangedConn then self.cameraTypeChangedConn:Disconnect()end;self.cameraSubjectChangedConn=b:GetPropertyChangedSignal("CameraSubject"):Connect(function()self:OnCameraSubjectChanged(b.CameraSubject)end)self.cameraTypeChangedConn=b:GetPropertyChangedSignal("CameraType"):Connect(function()self:OnCameraTypeChanged(b.CameraType)end)self:OnCameraSubjectChanged(b.CameraSubject)self:OnCameraTypeChanged(b.CameraType)end;function b:OnLocalPlayerCameraPropertyChanged(b)if b=="CameraMode"then if f.LocalPlayer.CameraMode==Enum.CameraMode.LockFirstPerson then if not self.activeCameraController or self.activeCameraController:GetModuleName()~="ClassicCamera"then self:ActivateCameraController(j.ConvertCameraModeEnumToStandard(Enum.DevComputerCameraMovementMode.Classic))end;if self.activeCameraController then self.activeCameraController:UpdateForDistancePropertyChange()end elseif f.LocalPlayer.CameraMode==Enum.CameraMode.Classic then local b=self:GetCameraMovementModeFromSettings()self:ActivateCameraController(j.ConvertCameraModeEnumToStandard(b))else warn("Unhandled value for property player.CameraMode: ",f.LocalPlayer.CameraMode)end elseif b=="DevComputerCameraMode"or b=="DevTouchCameraMode"then local b=self:GetCameraMovementModeFromSettings()self:ActivateCameraController(j.ConvertCameraModeEnumToStandard(b))elseif b=="DevCameraOcclusionMode"then self:ActivateOcclusionModule(f.LocalPlayer.DevCameraOcclusionMode)elseif b=="CameraMinZoomDistance"or b=="CameraMaxZoomDistance"then if self.activeCameraController then self.activeCameraController:UpdateForDistancePropertyChange()end elseif b=="DevTouchMovementMode"then elseif b=="DevComputerMovementMode"then elseif b=="DevEnableMouseLock"then end end;function b:OnUserGameSettingsPropertyChanged(b)if b=="ComputerCameraMovementMode"then local b=self:GetCameraMovementModeFromSettings()self:ActivateCameraController(j.ConvertCameraModeEnumToStandard(b))end end;function b:Update(b)if self.activeCameraController then if c then self.activeCameraController:UpdateMouseBehavior()end;local c,d=self.activeCameraController:Update(b)self.activeCameraController:ApplyVRTransform()if self.activeOcclusionModule then c,d=self.activeOcclusionModule:Update(b,c,d)end;game.Workspace.CurrentCamera.CFrame=c;game.Workspace.CurrentCamera.Focus=d;if self.activeTransparencyController then self.activeTransparencyController:Update()end end end;function b:GetCameraControlChoice()local b=f.LocalPlayer;if b then if self.lastInputType==Enum.UserInputType.Touch or h.TouchEnabled then if b.DevTouchCameraMode==Enum.DevTouchCameraMovementMode.UserChoice then return j.ConvertCameraModeEnumToStandard(i.TouchCameraMovementMode)else return j.ConvertCameraModeEnumToStandard(b.DevTouchCameraMode)end else if b.DevComputerCameraMode==Enum.DevComputerCameraMovementMode.UserChoice then local b=j.ConvertCameraModeEnumToStandard(i.ComputerCameraMovementMode)return j.ConvertCameraModeEnumToStandard(b)else return j.ConvertCameraModeEnumToStandard(b.DevComputerCameraMode)end end end end;function b:OnCharacterAdded(b,c)if self.activeOcclusionModule then self.activeOcclusionModule:CharacterAdded(b,c)end end;function b:OnCharacterRemoving(b,c)if self.activeOcclusionModule then self.activeOcclusionModule:CharacterRemoving(b,c)end end;function b:OnPlayerAdded(b)b.CharacterAdded:Connect(function(c)self:OnCharacterAdded(c,b)end)b.CharacterRemoving:Connect(function(c)self:OnCharacterRemoving(c,b)end)end;function b:OnMouseLockToggled()if self.activeMouseLockController then local b=self.activeMouseLockController:GetIsMouseLocked()local c=self.activeMouseLockController:GetMouseLockOffset()if self.activeCameraController then self.activeCameraController:SetIsMouseLocked(b)self.activeCameraController:SetMouseLockOffset(c)end end end;local c=b;local d=CFrame.new()local e=d;c.UpVector=Vector3.new(0,1,0)c.TransitionRate=0.15;c.UpCFrame=d;function c:GetUpVector(b)return b end;local function f(b,c,d)local b,c=b:Dot(c),b:Cross(c)if(b<-0.99999)then return CFrame.fromAxisAngle(d,math.pi)end;return CFrame.new(0,0,0,c.x,c.y,c.z,1+b)end;function c:CalculateUpCFrame()local b=self.UpVector;local c=self:GetUpVector(b)local g=game.Workspace.CurrentCamera.CFrame.RightVector;local c=f(b,c,g)local c=d:Lerp(c,self.TransitionRate)self.UpVector=c*b;self.UpCFrame=c*self.UpCFrame;e=self.UpCFrame end;function c:Update(b)if self.activeCameraController then if c.FFlagUserCameraToggle then self.activeCameraController:UpdateMouseBehavior()end;local c,d=self.activeCameraController:Update(b)self.activeCameraController:ApplyVRTransform()self:CalculateUpCFrame()self.activeCameraController:UpdateUpCFrame(self.UpCFrame)local e=Vector3.new(0,0,0)if(self.activeMouseLockController and self.activeMouseLockController:GetIsMouseLocked())then e=self.activeMouseLockController:GetMouseLockOffset()end;local f=d:ToObjectSpace(c)local f=self.UpCFrame*f;d=d-c:VectorToWorldSpace(e)+f:VectorToWorldSpace(e)c=d*f;if(self.activeCameraController.lastCameraTransform)then self.activeCameraController.lastCameraTransform=c;self.activeCameraController.lastCameraFocus=d end;if self.activeOcclusionModule then c,d=self.activeOcclusionModule:Update(b,c,d)end;game.Workspace.CurrentCamera.CFrame=c;game.Workspace.CurrentCamera.Focus=d;if self.activeTransparencyController then self.activeTransparencyController:Update()end end end;function c:IsFirstPerson()if self.activeCameraController then return self.activeCameraController:InFirstPerson()end;return false end;function c:IsMouseLocked()if self.activeCameraController then return self.activeCameraController:GetIsMouseLocked()end;return false end;function c:IsToggleMode()if self.activeCameraController then return self.activeCameraController.isCameraToggle end;return false end;function c:IsCamRelative()return self:IsMouseLocked()or self:IsFirstPerson()end;local c=_CameraUtils()function c.GetAngleBetweenXZVectors(b,c)local d=e;b=d:VectorToObjectSpace(b)c=d:VectorToObjectSpace(c)return math.atan2(c.X*b.Z-c.Z*b.X,c.X*b.X+c.Z*b.Z)end;local b=b.new()local c={}return b end;function _ClickToMoveDisplay()local b={}local c="rbxassetid://2874840706"local d="rbxasset://textures/ui/traildot.png"local e="rbxasset://textures/ui/waypoint.png"local f=false;local g=2;local h=3;local i=UDim2.new(0,1.68*25,0,2*25)local j=Vector2.new(0,0.5)local k=Vector2.new(0,1)local l=Vector2.new(0,0.5)local m=Vector2.new(0.1,0.5)local n=Vector2.new(-0.1,0.5)local o=0.125;local p=4;local q=5;local r="ClickToMoveDisplay"local s=Vector2.new(1.5,1.5)local t=1;local u=10;local v=2.5;local w=100;local x=game:GetService("Players")local y=game:GetService("TweenService")local z=game:GetService("RunService")local A=game:GetService("Workspace")local x=x.LocalPlayer;local function B()local b=Instance.new("Part")b.Size=Vector3.new(1,1,1)b.Anchored=true;b.CanCollide=false;b.Name="TrailDot"b.Transparency=1;local c=Instance.new("ImageHandleAdornment")c.Name="TrailDotImage"c.Size=s;c.SizeRelativeOffset=Vector3.new(0,0,-0.1)c.AlwaysOnTop=f;c.Image=d;c.Adornee=b;c.Parent=b;local c=Instance.new("Part")c.Size=Vector3.new(2,2,2)c.Anchored=true;c.CanCollide=false;c.Name="EndWaypoint"c.Transparency=1;local g=Instance.new("ImageHandleAdornment")g.Name="TrailDotImage"g.Size=s;g.SizeRelativeOffset=Vector3.new(0,0,-0.1)g.AlwaysOnTop=f;g.Image=d;g.Adornee=c;g.Parent=c;local g=Instance.new("BillboardGui")g.Name="EndWaypointBillboard"g.Size=i;g.LightInfluence=0;g.SizeOffset=j;g.AlwaysOnTop=true;g.Adornee=c;g.Parent=c;local h=Instance.new("ImageLabel")h.Image=e;h.BackgroundTransparency=1;h.Size=UDim2.new(1,0,1,0)h.Parent=g;local g=Instance.new("Part")g.Size=Vector3.new(2,2,2)g.Anchored=true;g.CanCollide=false;g.Name="FailureWaypoint"g.Transparency=1;local h=Instance.new("ImageHandleAdornment")h.Name="TrailDotImage"h.Size=s;h.SizeRelativeOffset=Vector3.new(0,0,-0.1)h.AlwaysOnTop=f;h.Image=d;h.Adornee=g;h.Parent=g;local d=Instance.new("BillboardGui")d.Name="FailureWaypointBillboard"d.Size=i;d.LightInfluence=0;d.SizeOffset=l;d.AlwaysOnTop=true;d.Adornee=g;d.Parent=g;local f=Instance.new("Frame")f.BackgroundTransparency=1;f.Size=UDim2.new(0,0,0,0)f.Position=UDim2.new(0.5,0,1,0)f.Parent=d;local d=Instance.new("ImageLabel")d.Image=e;d.BackgroundTransparency=1;d.Position=UDim2.new(0,-i.X.Offset/2,0,-i.Y.Offset)d.Size=i;d.Parent=f;return b,c,g end;local i,j,C=B()local function D()local b=A.CurrentCamera;local c=b:FindFirstChild(r)if not c then c=Instance.new("Model")c.Name=r;c.Parent=b end;return c end;local function r(b,c)local c=Ray.new(c+Vector3.new(0,2.5,0),Vector3.new(0,-10,0))local c,d,e=A:FindPartOnRayWithIgnoreList(c,{A.CurrentCamera,x.Character})if c then b.CFrame=CFrame.new(d,d+e)b.Parent=D()end end;local E={}E.__index=E;function E:Destroy()self.DisplayModel:Destroy()end;function E:NewDisplayModel(b)local c=i:Clone()r(c,b)return c end;function E.new(b,c)local d=setmetatable({},E)d.DisplayModel=d:NewDisplayModel(b)d.ClosestWayPoint=c;return d end;local F={}F.__index=F;function F:Destroy()self.Destroyed=true;self.Tween:Cancel()self.DisplayModel:Destroy()end;function F:NewDisplayModel(b)local c=j:Clone()r(c,b)return c end;function F:CreateTween()local b=TweenInfo.new(0.5,Enum.EasingStyle.Sine,Enum.EasingDirection.Out,-1,true)local b=y:Create(self.DisplayModel.EndWaypointBillboard,b,{SizeOffset=k})b:Play()return b end;function F:TweenInFrom(b)local c=self.DisplayModel.Position;local b=b-c;self.DisplayModel.EndWaypointBillboard.StudsOffset=Vector3.new(0,b.Y,0)local b=TweenInfo.new(1,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)local b=y:Create(self.DisplayModel.EndWaypointBillboard,b,{StudsOffset=Vector3.new(0,0,0)})b:Play()return b end;function F.new(b,c,d)local e=setmetatable({},F)e.DisplayModel=e:NewDisplayModel(b)e.Destroyed=false;if d and(d-b).magnitude>q then e.Tween=e:TweenInFrom(d)coroutine.wrap(function()e.Tween.Completed:Wait()if not e.Destroyed then e.Tween=e:CreateTween()end end)()else e.Tween=e:CreateTween()end;e.ClosestWayPoint=c;return e end;local k={}k.__index=k;function k:Hide()self.DisplayModel.Parent=nil end;function k:Destroy()self.DisplayModel:Destroy()end;function k:NewDisplayModel(b)local c=C:Clone()r(c,b)local b=Ray.new(b+Vector3.new(0,2.5,0),Vector3.new(0,-10,0))local b,d,e=A:FindPartOnRayWithIgnoreList(b,{A.CurrentCamera,x.Character})if b then c.CFrame=CFrame.new(d,d+e)c.Parent=D()end;return c end;function k:RunFailureTween()wait(o)local b=TweenInfo.new(o/2,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)local c=y:Create(self.DisplayModel.FailureWaypointBillboard,b,{SizeOffset=m})c:Play()local d=y:Create(self.DisplayModel.FailureWaypointBillboard.Frame,b,{Rotation=10})d:Play()c.Completed:wait()b=TweenInfo.new(o,Enum.EasingStyle.Sine,Enum.EasingDirection.Out,p-1,true)local c=y:Create(self.DisplayModel.FailureWaypointBillboard,b,{SizeOffset=n})c:Play()b=TweenInfo.new(o,Enum.EasingStyle.Sine,Enum.EasingDirection.Out,p-1,true)local d=y:Create(self.DisplayModel.FailureWaypointBillboard.Frame.ImageLabel,b,{ImageColor3=Color3.new(0.75,0.75,0.75)})d:Play()local d=y:Create(self.DisplayModel.FailureWaypointBillboard.Frame,b,{Rotation=-10})d:Play()c.Completed:wait()b=TweenInfo.new(o/2,Enum.EasingStyle.Sine,Enum.EasingDirection.Out)local c=y:Create(self.DisplayModel.FailureWaypointBillboard,b,{SizeOffset=l})c:Play()local b=y:Create(self.DisplayModel.FailureWaypointBillboard.Frame,b,{Rotation=0})b:Play()c.Completed:wait()wait(o)end;function k.new(b)local c=setmetatable({},k)c.DisplayModel=c:NewDisplayModel(b)return c end;local l=Instance.new("Animation")l.AnimationId=c;local c=nil;local m=nil;local function n(b)if b==c then return m end;m=b:LoadAnimation(l)m.Priority=Enum.AnimationPriority.Action;m.Looped=false;return m end;local function c()local b=x.Character;if b then return b:FindFirstChildOfClass("Humanoid")end end;local function l(b,c)local d={}local e=1;for c=1,#b-1 do local f=(b[c].Position-b[#b].Position).magnitude<h;local f=c%g==0 and not f;if f then local b=E.new(b[c].Position,c)d[e]=b;e=e+1 end end;local b=F.new(b[#b].Position,#b,c)table.insert(d,b)local b={}e=1;for c=#d,1,-1 do b[e]=d[c]e=e+1 end;return b end;local function g(b,c)local d=w-u;local b=math.clamp(b-u,0,d)/d;local b=t+(v-t)*b;return c*b end;local h=0;function b.CreatePathDisplay(b,c)h=h+1;local c=l(b,c)local function d(b)for d=#c,1,-1 do local e=c[d]if e.ClosestWayPoint<=b then e:Destroy()c[d]=nil else break end end end;local e="ClickToMoveResizeTrail"..h;local function f()if#c==0 then z:UnbindFromRenderStep(e)return end;local b=A.CurrentCamera.CFrame.p;for d=1,#c do local e=c[d].DisplayModel:FindFirstChild("TrailDotImage")if e then local b=(c[d].DisplayModel.Position-b).magnitude;e.Size=g(b,s)end end end;z:BindToRenderStep(e,Enum.RenderPriority.Camera.Value-1,f)local function c()d(#b)end;return c,d end;local g=nil;function b.DisplayFailureWaypoint(b)if g then g:Hide()end;local b=k.new(b)g=b;coroutine.wrap(function()b:RunFailureTween()b:Destroy()b=nil end)()end;function b.CreateEndWaypoint(b)return F.new(b)end;function b.PlayFailureAnimation()local b=c()if b then local b=n(b)b:Play()end end;function b.CancelFailureAnimation()if m~=nil and m.IsPlaying then m:Stop()end end;function b.SetWaypointTexture(b)d=b;i,j,C=B()end;function b.GetWaypointTexture()return d end;function b.SetWaypointRadius(b)s=Vector2.new(b,b)i,j,C=B()end;function b.GetWaypointRadius()return s.X end;function b.SetEndWaypointTexture(b)e=b;i,j,C=B()end;function b.GetEndWaypointTexture()return e end;function b.SetWaypointsAlwaysOnTop(b)f=b;i,j,C=B()end;function b.GetWaypointsAlwaysOnTop()return f end;return b end;function _BaseCharacterController()local b=Vector3.new(0,0,0)local c={}c.__index=c;function c.new()local c=setmetatable({},c)c.enabled=false;c.moveVector=b;c.moveVectorIsCameraRelative=true;c.isJumping=false;return c end;function c:OnRenderStepped(b)end;function c:GetMoveVector()return self.moveVector end;function c:IsMoveVectorCameraRelative()return self.moveVectorIsCameraRelative end;function c:GetIsJumping()return self.isJumping end;function c:Enable(b)error("BaseCharacterController:Enable must be overridden in derived classes and should not be called.")return false end;return c end;function _VehicleController()local b=game:GetService("ContextActionService")local c=true;local d=false;local e=Vector3.new(0,0,0)local f=35;local g={}g.__index=g;function g.new(b)local c=setmetatable({},g)c.CONTROL_ACTION_PRIORITY=b;c.enabled=false;c.vehicleSeat=nil;c.throttle=0;c.steer=0;c.acceleration=0;c.decceleration=0;c.turningRight=0;c.turningLeft=0;c.vehicleMoveVector=e;c.autoPilot={}c.autoPilot.MaxSpeed=0;c.autoPilot.MaxSteeringAngle=0;return c end;function g:BindContextActions()if c then b:BindActionAtPriority("throttleAccel",(function(b,c,d)self:OnThrottleAccel(b,c,d)return Enum.ContextActionResult.Pass end),false,self.CONTROL_ACTION_PRIORITY,Enum.KeyCode.ButtonR2)b:BindActionAtPriority("throttleDeccel",(function(b,c,d)self:OnThrottleDeccel(b,c,d)return Enum.ContextActionResult.Pass end),false,self.CONTROL_ACTION_PRIORITY,Enum.KeyCode.ButtonL2)end;b:BindActionAtPriority("arrowSteerRight",(function(b,c,d)self:OnSteerRight(b,c,d)return Enum.ContextActionResult.Pass end),false,self.CONTROL_ACTION_PRIORITY,Enum.KeyCode.Right)b:BindActionAtPriority("arrowSteerLeft",(function(b,c,d)self:OnSteerLeft(b,c,d)return Enum.ContextActionResult.Pass end),false,self.CONTROL_ACTION_PRIORITY,Enum.KeyCode.Left)end;function g:Enable(d,f)if d==self.enabled and f==self.vehicleSeat then return end;self.enabled=d;self.vehicleMoveVector=e;if d then if f then self.vehicleSeat=f;self:SetupAutoPilot()self:BindContextActions()end else if c then b:UnbindAction("throttleAccel")b:UnbindAction("throttleDeccel")end;b:UnbindAction("arrowSteerRight")b:UnbindAction("arrowSteerLeft")self.vehicleSeat=nil end end;function g:OnThrottleAccel(b,b,c)if b==Enum.UserInputState.End or b==Enum.UserInputState.Cancel then self.acceleration=0 else self.acceleration=-1 end;self.throttle=self.acceleration+self.decceleration end;function g:OnThrottleDeccel(b,b,c)if b==Enum.UserInputState.End or b==Enum.UserInputState.Cancel then self.decceleration=0 else self.decceleration=1 end;self.throttle=self.acceleration+self.decceleration end;function g:OnSteerRight(b,b,c)if b==Enum.UserInputState.End or b==Enum.UserInputState.Cancel then self.turningRight=0 else self.turningRight=1 end;self.steer=self.turningRight+self.turningLeft end;function g:OnSteerLeft(b,b,c)if b==Enum.UserInputState.End or b==Enum.UserInputState.Cancel then self.turningLeft=0 else self.turningLeft=-1 end;self.steer=self.turningRight+self.turningLeft end;function g:Update(b,f,g)if self.vehicleSeat then if f then b=b+Vector3.new(self.steer,0,self.throttle)if g and d and c then self.vehicleSeat.ThrottleFloat=-self.throttle else self.vehicleSeat.ThrottleFloat=-b.Z end;self.vehicleSeat.SteerFloat=b.X;return b,true else local b=self.vehicleSeat.Occupant.RootPart.CFrame:VectorToObjectSpace(b)self.vehicleSeat.ThrottleFloat=self:ComputeThrottle(b)self.vehicleSeat.SteerFloat=self:ComputeSteer(b)return e,true end end;return b,false end;function g:ComputeThrottle(b)if b~=e then local b=-b.Z;return b else return 0.0 end end;function g:ComputeSteer(b)if b~=e then local b=-math.atan2(-b.x,-b.z)*(180/math.pi)return b/self.autoPilot.MaxSteeringAngle else return 0.0 end end;function g:SetupAutoPilot()self.autoPilot.MaxSpeed=self.vehicleSeat.MaxSpeed;self.autoPilot.MaxSteeringAngle=f end;return g end;function _TouchJump()local b=game:GetService("Players")local c=game:GetService("GuiService")local d="rbxasset://textures/ui/Input/TouchControlsSheetV2.png"local e=_BaseCharacterController()local f=setmetatable({},e)f.__index=f;function f.new()local b=setmetatable(e.new(),f)b.parentUIFrame=nil;b.jumpButton=nil;b.characterAddedConn=nil;b.humanoidStateEnabledChangedConn=nil;b.humanoidJumpPowerConn=nil;b.humanoidParentConn=nil;b.externallyEnabled=false;b.jumpPower=0;b.jumpStateEnabled=true;b.isJumping=false;b.humanoid=nil;return b end;function f:EnableButton(c)if c then if not self.jumpButton then self:Create()end;local b=b.LocalPlayer.Character and b.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")if b and self.externallyEnabled then if self.externallyEnabled then if b.JumpPower>0 then self.jumpButton.Visible=true end end end else self.jumpButton.Visible=false;self.isJumping=false;self.jumpButton.ImageRectOffset=Vector2.new(1,146)end end;function f:UpdateEnabled()if self.jumpPower>0 and self.jumpStateEnabled then self:EnableButton(true)else self:EnableButton(false)end end;function f:HumanoidChanged(c)local b=b.LocalPlayer.Character and b.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")if b then if c=="JumpPower"then self.jumpPower=b.JumpPower;self:UpdateEnabled()elseif c=="Parent"then if not b.Parent then self.humanoidChangeConn:Disconnect()end end end end;function f:HumanoidStateEnabledChanged(b,c)if b==Enum.HumanoidStateType.Jumping then self.jumpStateEnabled=c;self:UpdateEnabled()end end;function f:CharacterAdded(b)if self.humanoidChangeConn then self.humanoidChangeConn:Disconnect()self.humanoidChangeConn=nil end;self.humanoid=b:FindFirstChildOfClass("Humanoid")while not self.humanoid do b.ChildAdded:wait()self.humanoid=b:FindFirstChildOfClass("Humanoid")end;self.humanoidJumpPowerConn=self.humanoid:GetPropertyChangedSignal("JumpPower"):Connect(function()self.jumpPower=self.humanoid.JumpPower;self:UpdateEnabled()end)self.humanoidParentConn=self.humanoid:GetPropertyChangedSignal("Parent"):Connect(function()if not self.humanoid.Parent then self.humanoidJumpPowerConn:Disconnect()self.humanoidJumpPowerConn=nil;self.humanoidParentConn:Disconnect()self.humanoidParentConn=nil end end)self.humanoidStateEnabledChangedConn=self.humanoid.StateEnabledChanged:Connect(function(b,c)self:HumanoidStateEnabledChanged(b,c)end)self.jumpPower=self.humanoid.JumpPower;self.jumpStateEnabled=self.humanoid:GetStateEnabled(Enum.HumanoidStateType.Jumping)self:UpdateEnabled()end;function f:SetupCharacterAddedFunction()self.characterAddedConn=b.LocalPlayer.CharacterAdded:Connect(function(b)self:CharacterAdded(b)end)if b.LocalPlayer.Character then self:CharacterAdded(b.LocalPlayer.Character)end end;function f:Enable(b,c)if c then self.parentUIFrame=c end;self.externallyEnabled=b;self:EnableButton(b)end;function f:Create()if not self.parentUIFrame then return end;if self.jumpButton then self.jumpButton:Destroy()self.jumpButton=nil end;local b=math.min(self.parentUIFrame.AbsoluteSize.x,self.parentUIFrame.AbsoluteSize.y)local b=b<=500;local e=b and 70 or 120;self.jumpButton=Instance.new("ImageButton")self.jumpButton.Name="JumpButton"self.jumpButton.Visible=false;self.jumpButton.BackgroundTransparency=1;self.jumpButton.Image=d;self.jumpButton.ImageRectOffset=Vector2.new(1,146)self.jumpButton.ImageRectSize=Vector2.new(144,144)self.jumpButton.Size=UDim2.new(0,e,0,e)self.jumpButton.Position=b and UDim2.new(1,-(e*1.5-10),1,-e-20)or UDim2.new(1,-(e*1.5-10),1,-e*1.75)local b=nil;self.jumpButton.InputBegan:connect(function(c)if b or c.UserInputType~=Enum.UserInputType.Touch or c.UserInputState~=Enum.UserInputState.Begin then return end;b=c;self.jumpButton.ImageRectOffset=Vector2.new(146,146)self.isJumping=true end)local d=function()b=nil;self.isJumping=false;self.jumpButton.ImageRectOffset=Vector2.new(1,146)end;self.jumpButton.InputEnded:connect(function(c)if c==b then d()end end)c.MenuOpened:connect(function()if b then d()end end)if not self.characterAddedConn then self:SetupCharacterAddedFunction()end;self.jumpButton.Parent=self.parentUIFrame end;return f end;function _ClickToMoveController()local b=game:GetService("UserInputService")local c=game:GetService("PathfindingService")local d=game:GetService("Players")local e=game:GetService('Debris')local f=game:GetService("StarterGui")local g=game:GetService("Workspace")local h=game:GetService("CollectionService")local i=game:GetService("GuiService")local j=true;local k=true;local l=false;local m=true;local n=1.0;local o=8;local p={[Enum.KeyCode.W]=true;[Enum.KeyCode.A]=true;[Enum.KeyCode.S]=true;[Enum.KeyCode.D]=true;[Enum.KeyCode.Up]=true;[Enum.KeyCode.Down]=true}local q,r=pcall(function()return UserSettings():IsUserFeatureEnabled("UserNavigationClickToMoveSkipPassedWaypoints")end)local q=q and r;local r=d.LocalPlayer;local s=_ClickToMoveDisplay()local t=Vector3.new(0,0,0)local u=0.000001;local v={}do local function b(c)if c then local d=c:FindFirstChildOfClass("Humanoid")if d then return c,d else return b(c.Parent)end end end;v.FindCharacterAncestor=b;local function c(d,e,f)f=f or{}local g,h,i,j=g:FindPartOnRayWithIgnoreList(d,f)if g then if e and g.CanCollide==false then local b,b=b(g)if b==nil then table.insert(f,g)return c(d,e,f)end end;return g,h,i,j end;return nil,nil end;v.Raycast=c end;local w={}local function x(b)local c=b and b.Character;if c then local d=w[b]if d and d.Parent==c then return d else w[b]=nil;local c=c:FindFirstChildOfClass("Humanoid")if c then w[b]=c end;return c end end end;local w;local y=nil;local z=nil;local A=nil;local function B()return r and r.Character end;local function C(b)if b==y then return end;if z then z:Disconnect()z=nil end;if A then A:Disconnect()A=nil end;y=b;w={B()}if y~=nil then local b=h:GetTagged(y)for b,b in ipairs(b)do table.insert(w,b)end;z=h:GetInstanceAddedSignal(y):Connect(function(b)table.insert(w,b)end)A=h:GetInstanceRemovedSignal(y):Connect(function(b)for c=1,#w do if w[c]==b then w[c]=w[#w]table.remove(w)break end end end)end end;local function h()if w then return w end;w={}table.insert(w,B())return w end;local function w(b,d,e)local f={}local i;local k;if e~=nil then i=e;k=e else i=l;k=m end;f.Cancelled=false;f.Started=false;f.Finished=Instance.new("BindableEvent")f.PathFailed=Instance.new("BindableEvent")f.PathComputing=false;f.PathComputed=false;f.OriginalTargetPoint=b;f.TargetPoint=b;f.TargetSurfaceNormal=d;f.DiedConn=nil;f.SeatedConn=nil;f.BlockedConn=nil;f.TeleportedConn=nil;f.CurrentPoint=0;f.HumanoidOffsetFromPath=t;f.CurrentWaypointPosition=nil;f.CurrentWaypointPlaneNormal=t;f.CurrentWaypointPlaneDistance=0;f.CurrentWaypointNeedsJump=false;f.CurrentHumanoidPosition=t;f.CurrentHumanoidVelocity=0;f.NextActionMoveDirection=t;f.NextActionJump=false;f.Timeout=0;f.Humanoid=x(r)f.OriginPoint=nil;f.AgentCanFollowPath=false;f.DirectPath=false;f.DirectPathRiseFirst=false;local b=f.Humanoid and f.Humanoid.RootPart;if b then f.OriginPoint=b.CFrame.p;local b=2;local d=5;local e=true;local g=f.Humanoid.SeatPart;if g and g:IsA("VehicleSeat")then local c=g:FindFirstAncestorOfClass("Model")if c then local h=c.PrimaryPart;c.PrimaryPart=g;if k then local c=c:GetExtentsSize()b=n*0.5*math.sqrt(c.X*c.X+c.Z*c.Z)d=n*c.Y;e=false;f.AgentCanFollowPath=true;f.DirectPath=k end;c.PrimaryPart=h end else local c=B():GetExtentsSize()b=n*0.5*math.sqrt(c.X*c.X+c.Z*c.Z)d=n*c.Y;e=(f.Humanoid.JumpPower>0)f.AgentCanFollowPath=true;f.DirectPath=i;f.DirectPathRiseFirst=f.Humanoid.Sit end;f.pathResult=c:CreatePath({AgentRadius=b,AgentHeight=d,AgentCanJump=e})end;function f:Cleanup()if f.stopTraverseFunc then f.stopTraverseFunc()f.stopTraverseFunc=nil end;if f.MoveToConn then f.MoveToConn:Disconnect()f.MoveToConn=nil end;if f.BlockedConn then f.BlockedConn:Disconnect()f.BlockedConn=nil end;if f.DiedConn then f.DiedConn:Disconnect()f.DiedConn=nil end;if f.SeatedConn then f.SeatedConn:Disconnect()f.SeatedConn=nil end;if f.TeleportedConn then f.TeleportedConn:Disconnect()f.TeleportedConn=nil end;f.Started=false end;function f:Cancel()f.Cancelled=true;f:Cleanup()end;function f:IsActive()return f.AgentCanFollowPath and f.Started and not f.Cancelled end;function f:OnPathInterrupted()f.Cancelled=true;f:OnPointReached(false)end;function f:ComputePath()if f.OriginPoint then if f.PathComputed or f.PathComputing then return end;f.PathComputing=true;if f.AgentCanFollowPath then if f.DirectPath then f.pointList={PathWaypoint.new(f.OriginPoint,Enum.PathWaypointAction.Walk),PathWaypoint.new(f.TargetPoint,f.DirectPathRiseFirst and Enum.PathWaypointAction.Jump or Enum.PathWaypointAction.Walk)}f.PathComputed=true else f.pathResult:ComputeAsync(f.OriginPoint,f.TargetPoint)f.pointList=f.pathResult:GetWaypoints()f.BlockedConn=f.pathResult.Blocked:Connect(function(b)f:OnPathBlocked(b)end)f.PathComputed=f.pathResult.Status==Enum.PathStatus.Success end end;f.PathComputing=false end end;function f:IsValidPath()f:ComputePath()return f.PathComputed and f.AgentCanFollowPath end;f.Recomputing=false;function f:OnPathBlocked(b)local b=b>=f.CurrentPoint;if not b or f.Recomputing then return end;f.Recomputing=true;if f.stopTraverseFunc then f.stopTraverseFunc()f.stopTraverseFunc=nil end;f.OriginPoint=f.Humanoid.RootPart.CFrame.p;f.pathResult:ComputeAsync(f.OriginPoint,f.TargetPoint)f.pointList=f.pathResult:GetWaypoints()if#f.pointList>0 then f.HumanoidOffsetFromPath=f.pointList[1].Position-f.OriginPoint end;f.PathComputed=f.pathResult.Status==Enum.PathStatus.Success;if j then f.stopTraverseFunc,f.setPointFunc=s.CreatePathDisplay(f.pointList)end;if f.PathComputed then f.CurrentPoint=1;f:OnPointReached(true)else f.PathFailed:Fire()f:Cleanup()end;f.Recomputing=false end;function f:OnRenderStepped(b)if f.Started and not f.Cancelled then f.Timeout=f.Timeout+b;if f.Timeout>o then f:OnPointReached(false)return end;f.CurrentHumanoidPosition=f.Humanoid.RootPart.Position+f.HumanoidOffsetFromPath;f.CurrentHumanoidVelocity=f.Humanoid.RootPart.Velocity;while f.Started and f:IsCurrentWaypointReached()do f:OnPointReached(true)end;if f.Started then f.NextActionMoveDirection=f.CurrentWaypointPosition-f.CurrentHumanoidPosition;if f.NextActionMoveDirection.Magnitude>u then f.NextActionMoveDirection=f.NextActionMoveDirection.Unit else f.NextActionMoveDirection=t end;if f.CurrentWaypointNeedsJump then f.NextActionJump=true;f.CurrentWaypointNeedsJump=false else f.NextActionJump=false end end end end;function f:IsCurrentWaypointReached()local b=false;if f.CurrentWaypointPlaneNormal~=t then local c=f.CurrentWaypointPlaneNormal:Dot(f.CurrentHumanoidPosition)-f.CurrentWaypointPlaneDistance;local d=-f.CurrentWaypointPlaneNormal:Dot(f.CurrentHumanoidVelocity)local d=math.max(1.0,0.0625*d)b=c<d else b=true end;if b then f.CurrentWaypointPosition=nil;f.CurrentWaypointPlaneNormal=t;f.CurrentWaypointPlaneDistance=0 end;return b end;function f:OnPointReached(b)if b and not f.Cancelled then if f.setPointFunc then f.setPointFunc(f.CurrentPoint)end;local b=f.CurrentPoint+1;if b>#f.pointList then if f.stopTraverseFunc then f.stopTraverseFunc()end;f.Finished:Fire()f:Cleanup()else local c=f.pointList[f.CurrentPoint]local d=f.pointList[b]local e=f.Humanoid:GetState()local e=e==Enum.HumanoidStateType.FallingDown or e==Enum.HumanoidStateType.Freefall or e==Enum.HumanoidStateType.Jumping;if e then local b=d.Action==Enum.PathWaypointAction.Jump;if not b and f.CurrentPoint>1 then local e=f.pointList[f.CurrentPoint-1]local e=c.Position-e.Position;local c=d.Position-c.Position;local d=Vector2.new(e.x,e.z).Unit;local c=Vector2.new(c.x,c.z).Unit;local e=0.996;b=d:Dot(c)<e end;if b then f.Humanoid.FreeFalling:Wait()wait(0.1)end end;if q then f:MoveToNextWayPoint(c,d,b)else if f.setPointFunc then f.setPointFunc(b)end;if d.Action==Enum.PathWaypointAction.Jump then f.Humanoid.Jump=true end;f.Humanoid:MoveTo(d.Position)f.CurrentPoint=b end end else f.PathFailed:Fire()f:Cleanup()end end;function f:MoveToNextWayPoint(b,c,d)f.CurrentWaypointPlaneNormal=b.Position-c.Position;f.CurrentWaypointPlaneNormal=Vector3.new(f.CurrentWaypointPlaneNormal.X,0,f.CurrentWaypointPlaneNormal.Z)if f.CurrentWaypointPlaneNormal.Magnitude>u then f.CurrentWaypointPlaneNormal=f.CurrentWaypointPlaneNormal.Unit;f.CurrentWaypointPlaneDistance=f.CurrentWaypointPlaneNormal:Dot(c.Position)else f.CurrentWaypointPlaneNormal=t;f.CurrentWaypointPlaneDistance=0 end;f.CurrentWaypointNeedsJump=c.Action==Enum.PathWaypointAction.Jump;f.CurrentWaypointPosition=c.Position;f.CurrentPoint=d;f.Timeout=0 end;function f:Start(b)if not f.AgentCanFollowPath then f.PathFailed:Fire()return end;if f.Started then return end;f.Started=true;s.CancelFailureAnimation()if j then if b==nil or b then f.stopTraverseFunc,f.setPointFunc=s.CreatePathDisplay(f.pointList,f.OriginalTargetPoint)end end;if#f.pointList>0 then f.HumanoidOffsetFromPath=Vector3.new(0,f.pointList[1].Position.Y-f.OriginPoint.Y,0)f.CurrentHumanoidPosition=f.Humanoid.RootPart.Position+f.HumanoidOffsetFromPath;f.CurrentHumanoidVelocity=f.Humanoid.RootPart.Velocity;f.SeatedConn=f.Humanoid.Seated:Connect(function(b,b)f:OnPathInterrupted()end)f.DiedConn=f.Humanoid.Died:Connect(function()f:OnPathInterrupted()end)f.TeleportedConn=f.Humanoid.RootPart:GetPropertyChangedSignal("CFrame"):Connect(function()f:OnPathInterrupted()end)f.CurrentPoint=1;f:OnPointReached(true)else f.PathFailed:Fire()if f.stopTraverseFunc then f.stopTraverseFunc()end end end;local b=f.TargetPoint+f.TargetSurfaceNormal*1.5;local b=Ray.new(b,Vector3.new(0,-1,0)*50)local b,c=g:FindPartOnRayWithIgnoreList(b,h())if b then f.TargetPoint=c end;f:ComputePath()return f end;local function c()local b=x(r)return b~=nil and b.Health>0 end;local function m(b)if b~=nil then for b,b in pairs(b:GetChildren())do if b:IsA('Tool')then return b end end end end;local q=nil;local u=nil;local z=nil;local A=nil;local function B()if q then q:Cancel()q=nil end;if z then z:Disconnect()z=nil end;if A then A:Disconnect()A=nil end;if u then u:Destroy()end end;local function D(b,c,d,e,f)if q then B()end;q=b;b:Start(f)z=b.Finished.Event:Connect(function()B()if d then local b=m(e)if b then b:Activate()end end end)A=b.PathFailed.Event:Connect(function()B()if f==nil or f then local b=k and not(q and q:IsActive())if b then s.PlayFailureAnimation()end;s.DisplayFailureWaypoint(c)end end)end;local function z(b)if q and q:IsActive()then q:Cancel()end;if k then s.PlayFailureAnimation()end;s.DisplayFailureWaypoint(b)end;function OnTap(b,e,i)local g=g.CurrentCamera;local j=r.Character;if not c()then return end;if#b==1 or e then if g then local b=g:ScreenPointToRay(b[1].x,b[1].y)local b=Ray.new(b.Origin,b.Direction*1000)local c=x(r)local b,c,g=v.Raycast(b,true,h())local b,h=v.FindCharacterAncestor(b)if i and h and f:GetCore("AvatarContextMenuEnabled")then local b=d:GetPlayerFromCharacter(h.Parent)if b then B()return end end;if e then c=e;b=nil end;if c and j then B()local d=w(c,g)if d:IsValidPath()then D(d,c,b,j)else d:Cleanup()z(c)end end end elseif#b>=2 then if g then local b=m(j)if b then b:Activate()end end end end;local function c(b)if b then b:Disconnect()end end;local d=_Keyboard()local f=setmetatable({},d)f.__index=f;function f.new(b)local b=setmetatable(d.new(b),f)b.fingerTouches={}b.numUnsunkTouches=0;b.mouse1Down=tick()b.mouse1DownPos=Vector2.new()b.mouse2DownTime=tick()b.mouse2DownPos=Vector2.new()b.mouse2UpTime=tick()b.keyboardMoveVector=t;b.tapConn=nil;b.inputBeganConn=nil;b.inputChangedConn=nil;b.inputEndedConn=nil;b.humanoidDiedConn=nil;b.characterChildAddedConn=nil;b.onCharacterAddedConn=nil;b.characterChildRemovedConn=nil;b.renderSteppedConn=nil;b.menuOpenedConnection=nil;b.running=false;b.wasdEnabled=false;return b end;function f:DisconnectEvents()c(self.tapConn)c(self.inputBeganConn)c(self.inputChangedConn)c(self.inputEndedConn)c(self.humanoidDiedConn)c(self.characterChildAddedConn)c(self.onCharacterAddedConn)c(self.renderSteppedConn)c(self.characterChildRemovedConn)c(self.menuOpenedConnection)end;function f:OnTouchBegan(b,c)if self.fingerTouches[b]==nil and not c then self.numUnsunkTouches=self.numUnsunkTouches+1 end;self.fingerTouches[b]=c end;function f:OnTouchChanged(b,c)if self.fingerTouches[b]==nil then self.fingerTouches[b]=c;if not c then self.numUnsunkTouches=self.numUnsunkTouches+1 end end end;function f:OnTouchEnded(b,c)if self.fingerTouches[b]~=nil and self.fingerTouches[b]==false then self.numUnsunkTouches=self.numUnsunkTouches-1 end;self.fingerTouches[b]=nil end;function f:OnCharacterAdded(d)self:DisconnectEvents()self.inputBeganConn=b.InputBegan:Connect(function(b,c)if b.UserInputType==Enum.UserInputType.Touch then self:OnTouchBegan(b,c)end;if self.wasdEnabled and c==false and b.UserInputType==Enum.UserInputType.Keyboard and p[b.KeyCode]then B()s.CancelFailureAnimation()end;if b.UserInputType==Enum.UserInputType.MouseButton1 then self.mouse1DownTime=tick()self.mouse1DownPos=b.Position end;if b.UserInputType==Enum.UserInputType.MouseButton2 then self.mouse2DownTime=tick()self.mouse2DownPos=b.Position end end)self.inputChangedConn=b.InputChanged:Connect(function(b,c)if b.UserInputType==Enum.UserInputType.Touch then self:OnTouchChanged(b,c)end end)self.inputEndedConn=b.InputEnded:Connect(function(b,c)if b.UserInputType==Enum.UserInputType.Touch then self:OnTouchEnded(b,c)end;if b.UserInputType==Enum.UserInputType.MouseButton2 then self.mouse2UpTime=tick()local b=b.Position;local c=q or self.keyboardMoveVector.Magnitude<=0;if self.mouse2UpTime-self.mouse2DownTime<0.25 and(b-self.mouse2DownPos).magnitude<5 and c then local b={b}OnTap(b)end end end)self.tapConn=b.TouchTap:Connect(function(b,c)if not c then OnTap(b,nil,true)end end)self.menuOpenedConnection=i.MenuOpened:Connect(function()B()end)local function f(d)if b.TouchEnabled then if d:IsA('Tool')then d.ManualActivationOnly=true end end;if d:IsA('Humanoid')then c(self.humanoidDiedConn)self.humanoidDiedConn=d.Died:Connect(function()if u then e:AddItem(u.Model,1)end end)end end;self.characterChildAddedConn=d.ChildAdded:Connect(function(b)f(b)end)self.characterChildRemovedConn=d.ChildRemoved:Connect(function(c)if b.TouchEnabled then if c:IsA('Tool')then c.ManualActivationOnly=false end end end)for b,b in pairs(d:GetChildren())do f(b)end end;function f:Start()self:Enable(true)end;function f:Stop()self:Enable(false)end;function f:CleanupPath()B()end;function f:Enable(c,d,e)if c then if not self.running then if r.Character then self:OnCharacterAdded(r.Character)end;self.onCharacterAddedConn=r.CharacterAdded:Connect(function(b)self:OnCharacterAdded(b)end)self.running=true end;self.touchJumpController=e;if self.touchJumpController then self.touchJumpController:Enable(self.jumpEnabled)end else if self.running then self:DisconnectEvents()B()if b.TouchEnabled then local b=r.Character;if b then for b,b in pairs(b:GetChildren())do if b:IsA('Tool')then b.ManualActivationOnly=false end end end end;self.running=false end;if self.touchJumpController and not self.jumpEnabled then self.touchJumpController:Enable(true)end;self.touchJumpController=nil end;if b.KeyboardEnabled and c~=self.enabled then self.forwardValue=0;self.backwardValue=0;self.leftValue=0;self.rightValue=0;self.moveVector=t;if c then self:BindContextActions()self:ConnectFocusEventListeners()else self:UnbindContextActions()self:DisconnectFocusEventListeners()end end;self.wasdEnabled=c and d or false;self.enabled=c end;function f:OnRenderStepped(b)self.isJumping=false;if q then q:OnRenderStepped(b)if q then self.moveVector=q.NextActionMoveDirection;self.moveVectorIsCameraRelative=false;if q.NextActionJump then self.isJumping=true end else self.moveVector=self.keyboardMoveVector;self.moveVectorIsCameraRelative=true end else self.moveVector=self.keyboardMoveVector;self.moveVectorIsCameraRelative=true end;if self.jumpRequested then self.isJumping=true end end;function f:UpdateMovement(b)if b==Enum.UserInputState.Cancel then self.keyboardMoveVector=t elseif self.wasdEnabled then self.keyboardMoveVector=Vector3.new(self.leftValue+self.rightValue,0,self.forwardValue+self.backwardValue)end end;function f:UpdateJump()end;function f:SetShowPath(b)j=b end;function f:GetShowPath()return j end;function f:SetWaypointTexture(b)s.SetWaypointTexture(b)end;function f:GetWaypointTexture()return s.GetWaypointTexture()end;function f:SetWaypointRadius(b)s.SetWaypointRadius(b)end;function f:GetWaypointRadius()return s.GetWaypointRadius()end;function f:SetEndWaypointTexture(b)s.SetEndWaypointTexture(b)end;function f:GetEndWaypointTexture()return s.GetEndWaypointTexture()end;function f:SetWaypointsAlwaysOnTop(b)s.SetWaypointsAlwaysOnTop(b)end;function f:GetWaypointsAlwaysOnTop()return s.GetWaypointsAlwaysOnTop()end;function f:SetFailureAnimationEnabled(b)k=b end;function f:GetFailureAnimationEnabled()return k end;function f:SetIgnoredPartsTag(b)C(b)end;function f:GetIgnoredPartsTag()return y end;function f:SetUseDirectPath(b)l=b end;function f:GetUseDirectPath()return l end;function f:SetAgentSizeIncreaseFactor(b)n=1.0+(b/100.0)end;function f:GetAgentSizeIncreaseFactor()return(n-1.0)*100.0 end;function f:SetUnreachableWaypointTimeout(b)o=b end;function f:GetUnreachableWaypointTimeout()return o end;function f:SetUserJumpEnabled(b)self.jumpEnabled=b;if self.touchJumpController then self.touchJumpController:Enable(b)end end;function f:GetUserJumpEnabled()return self.jumpEnabled end;function f:MoveTo(b,c,d)local e=r.Character;if e==nil then return false end;local d=w(b,Vector3.new(0,1,0),d)if d and d:IsValidPath()then D(d,b,nil,e,c)return true end;return false end;return f end;function _TouchThumbstick()local b=game:GetService("Players")local b=game:GetService("GuiService")local c=game:GetService("UserInputService")local d=Vector3.new(0,0,0)local e="rbxasset://textures/ui/TouchControlsSheet.png"local f=_BaseCharacterController()local g=setmetatable({},f)g.__index=g;function g.new()local b=setmetatable(f.new(),g)b.isFollowStick=false;b.thumbstickFrame=nil;b.moveTouchObject=nil;b.onTouchMovedConn=nil;b.onTouchEndedConn=nil;b.screenPos=nil;b.stickImage=nil;b.thumbstickSize=nil;return b end;function g:Enable(b,c)if b==nil then return false end;b=b and true or false;if self.enabled==b then return true end;self.moveVector=d;self.isJumping=false;if b then if not self.thumbstickFrame then self:Create(c)end;self.thumbstickFrame.Visible=true else self.thumbstickFrame.Visible=false;self:OnInputEnded()end;self.enabled=b end;function g:OnInputEnded()self.thumbstickFrame.Position=self.screenPos;self.stickImage.Position=UDim2.new(0,self.thumbstickFrame.Size.X.Offset/2-self.thumbstickSize/4,0,self.thumbstickFrame.Size.Y.Offset/2-self.thumbstickSize/4)self.moveVector=d;self.isJumping=false;self.thumbstickFrame.Position=self.screenPos;self.moveTouchObject=nil end;function g:Create(d)if self.thumbstickFrame then self.thumbstickFrame:Destroy()self.thumbstickFrame=nil;if self.onTouchMovedConn then self.onTouchMovedConn:Disconnect()self.onTouchMovedConn=nil end;if self.onTouchEndedConn then self.onTouchEndedConn:Disconnect()self.onTouchEndedConn=nil end end;local f=math.min(d.AbsoluteSize.x,d.AbsoluteSize.y)local f=f<=500;self.thumbstickSize=f and 70 or 120;self.screenPos=f and UDim2.new(0,(self.thumbstickSize/2)-10,1,-self.thumbstickSize-20)or UDim2.new(0,self.thumbstickSize/2,1,-self.thumbstickSize*1.75)self.thumbstickFrame=Instance.new("Frame")self.thumbstickFrame.Name="ThumbstickFrame"self.thumbstickFrame.Active=true;self.thumbstickFrame.Visible=false;self.thumbstickFrame.Size=UDim2.new(0,self.thumbstickSize,0,self.thumbstickSize)self.thumbstickFrame.Position=self.screenPos;self.thumbstickFrame.BackgroundTransparency=1;local f=Instance.new("ImageLabel")f.Name="OuterImage"f.Image=e;f.ImageRectOffset=Vector2.new()f.ImageRectSize=Vector2.new(220,220)f.BackgroundTransparency=1;f.Size=UDim2.new(0,self.thumbstickSize,0,self.thumbstickSize)f.Position=UDim2.new(0,0,0,0)f.Parent=self.thumbstickFrame;self.stickImage=Instance.new("ImageLabel")self.stickImage.Name="StickImage"self.stickImage.Image=e;self.stickImage.ImageRectOffset=Vector2.new(220,0)self.stickImage.ImageRectSize=Vector2.new(111,111)self.stickImage.BackgroundTransparency=1;self.stickImage.Size=UDim2.new(0,self.thumbstickSize/2,0,self.thumbstickSize/2)self.stickImage.Position=UDim2.new(0,self.thumbstickSize/2-self.thumbstickSize/4,0,self.thumbstickSize/2-self.thumbstickSize/4)self.stickImage.ZIndex=2;self.stickImage.Parent=self.thumbstickFrame;local e=nil;local f=0.05;local function g(b)local b=b/(self.thumbstickSize/2)local c=b.magnitude;if c<f then b=Vector3.new()else b=b.unit*((c-f)/(1-f))b=Vector3.new(b.x,0,b.y)end;self.moveVector=b end;local function f(b)local c=Vector2.new(b.x-e.x,b.y-e.y)local d=c.magnitude;local e=self.thumbstickFrame.AbsoluteSize.x/2;if self.isFollowStick and d>e then local c=c.unit*e;self.thumbstickFrame.Position=UDim2.new(0,b.x-self.thumbstickFrame.AbsoluteSize.x/2-c.x,0,b.y-self.thumbstickFrame.AbsoluteSize.y/2-c.y)else d=math.min(d,e)c=c.unit*d end;self.stickImage.Position=UDim2.new(0,c.x+self.stickImage.AbsoluteSize.x/2,0,c.y+self.stickImage.AbsoluteSize.y/2)end;self.thumbstickFrame.InputBegan:Connect(function(b)if self.moveTouchObject or b.UserInputType~=Enum.UserInputType.Touch or b.UserInputState~=Enum.UserInputState.Begin then return end;self.moveTouchObject=b;self.thumbstickFrame.Position=UDim2.new(0,b.Position.x-self.thumbstickFrame.Size.X.Offset/2,0,b.Position.y-self.thumbstickFrame.Size.Y.Offset/2)e=Vector2.new(self.thumbstickFrame.AbsolutePosition.x+self.thumbstickFrame.AbsoluteSize.x/2,self.thumbstickFrame.AbsolutePosition.y+self.thumbstickFrame.AbsoluteSize.y/2)local b=Vector2.new(b.Position.x-e.x,b.Position.y-e.y)end)self.onTouchMovedConn=c.TouchMoved:Connect(function(b,c)if b==self.moveTouchObject then e=Vector2.new(self.thumbstickFrame.AbsolutePosition.x+self.thumbstickFrame.AbsoluteSize.x/2,self.thumbstickFrame.AbsolutePosition.y+self.thumbstickFrame.AbsoluteSize.y/2)local c=Vector2.new(b.Position.x-e.x,b.Position.y-e.y)g(c)f(b.Position)end end)self.onTouchEndedConn=c.TouchEnded:Connect(function(b,c)if b==self.moveTouchObject then self:OnInputEnded()end end)b.MenuOpened:Connect(function()if self.moveTouchObject then self:OnInputEnded()end end)self.thumbstickFrame.Parent=d end;return g end;function _DynamicThumbstick()local b=Vector3.new(0,0,0)local c="rbxasset://textures/ui/Input/TouchControlsSheetV2.png"local d="DynamicThumbstickAction"local e=Enum.ContextActionPriority.High.Value;local f={1-0.89,1-0.70,1-0.60,1-0.50,1-0.40,1-0.30,1-0.25}local g=#f;local h=true;local i=0.35;local j=0.3;local k=0.5;local l=TweenInfo.new(0.15,Enum.EasingStyle.Quad,Enum.EasingDirection.InOut)local m=game:GetService("Players")local n=game:GetService("GuiService")local o=game:GetService("UserInputService")local p=game:GetService("ContextActionService")local q=game:GetService("RunService")local r=game:GetService("TweenService")local s=m.LocalPlayer;if not s then m:GetPropertyChangedSignal("LocalPlayer"):Wait()s=m.LocalPlayer end;local m=_BaseCharacterController()local t=setmetatable({},m)t.__index=t;function t.new()local b=setmetatable(m.new(),t)b.moveTouchObject=nil;b.moveTouchLockedIn=false;b.moveTouchFirstChanged=false;b.moveTouchStartPosition=nil;b.startImage=nil;b.endImage=nil;b.middleImages={}b.startImageFadeTween=nil;b.endImageFadeTween=nil;b.middleImageFadeTweens={}b.isFirstTouch=true;b.thumbstickFrame=nil;b.onRenderSteppedConn=nil;b.fadeInAndOutBalance=k;b.fadeInAndOutHalfDuration=j;b.hasFadedBackgroundInPortrait=false;b.hasFadedBackgroundInLandscape=false;b.tweenInAlphaStart=nil;b.tweenOutAlphaStart=nil;return b end;function t:GetIsJumping()local b=self.isJumping;self.isJumping=false;return b end;function t:Enable(b,c)if b==nil then return false end;b=b and true or false;if self.enabled==b then return true end;if b then if not self.thumbstickFrame then self:Create(c)end;self:BindContextActions()else p:UnbindAction(d)self:OnInputEnded()end;self.enabled=b;self.thumbstickFrame.Visible=b end;function t:OnInputEnded()self.moveTouchObject=nil;self.moveVector=b;self:FadeThumbstick(false)end;function t:FadeThumbstick(b)if not b and self.moveTouchObject then return end;if self.isFirstTouch then return end;if self.startImageFadeTween then self.startImageFadeTween:Cancel()end;if self.endImageFadeTween then self.endImageFadeTween:Cancel()end;for b=1,#self.middleImages do if self.middleImageFadeTweens[b]then self.middleImageFadeTweens[b]:Cancel()end end;if b then self.startImageFadeTween=r:Create(self.startImage,l,{ImageTransparency=0})self.startImageFadeTween:Play()self.endImageFadeTween=r:Create(self.endImage,l,{ImageTransparency=0.2})self.endImageFadeTween:Play()for b=1,#self.middleImages do self.middleImageFadeTweens[b]=r:Create(self.middleImages[b],l,{ImageTransparency=f[b]})self.middleImageFadeTweens[b]:Play()end else self.startImageFadeTween=r:Create(self.startImage,l,{ImageTransparency=1})self.startImageFadeTween:Play()self.endImageFadeTween=r:Create(self.endImage,l,{ImageTransparency=1})self.endImageFadeTween:Play()for b=1,#self.middleImages do self.middleImageFadeTweens[b]=r:Create(self.middleImages[b],l,{ImageTransparency=1})self.middleImageFadeTweens[b]:Play()end end end;function t:FadeThumbstickFrame(b,c)self.fadeInAndOutHalfDuration=b*0.5;self.fadeInAndOutBalance=c;self.tweenInAlphaStart=tick()end;function t:InputInFrame(b)local c=self.thumbstickFrame.AbsolutePosition;local d=c+self.thumbstickFrame.AbsoluteSize;local b=b.Position;if b.X>=c.X and b.Y>=c.Y then if b.X<=d.X and b.Y<=d.Y then return true end end;return false end;function t:DoFadeInBackground()local b=s:FindFirstChildOfClass("PlayerGui")local c=false;if b then if b.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeLeft or b.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeRight then c=self.hasFadedBackgroundInLandscape;self.hasFadedBackgroundInLandscape=true elseif b.CurrentScreenOrientation==Enum.ScreenOrientation.Portrait then c=self.hasFadedBackgroundInPortrait;self.hasFadedBackgroundInPortrait=true end end;if not c then self.fadeInAndOutHalfDuration=j;self.fadeInAndOutBalance=k;self.tweenInAlphaStart=tick()end end;function t:DoMove(c)local c=c;local d=c.magnitude;if d<self.radiusOfDeadZone then c=b else c=c.unit*(1-math.max(0,(self.radiusOfMaxSpeed-c.magnitude)/self.radiusOfMaxSpeed))c=Vector3.new(c.x,0,c.y)end;self.moveVector=c end;function t:LayoutMiddleImages(b,c)local d=(self.thumbstickSize/2)+self.middleSize;local b=c-b;local e=b.magnitude-(self.thumbstickRingSize/2)-self.middleSize;local b=b.unit;local f=self.middleSpacing*g;local h=self.middleSpacing;if f<e then h=e/g end;for f=1,g do local g=self.middleImages[f]local i=d+(h*(f-2))local d=d+(h*(f-1))if i<e then local b=c-b*d;local c=math.clamp(1-((d-e)/h),0,1)g.Visible=true;g.Position=UDim2.new(0,b.X,0,b.Y)g.Size=UDim2.new(0,self.middleSize*c,0,self.middleSize*c)else g.Visible=false end end end;function t:MoveStick(b)local c=Vector2.new(self.moveTouchStartPosition.X,self.moveTouchStartPosition.Y)local c=c-self.thumbstickFrame.AbsolutePosition;local b=Vector2.new(b.X,b.Y)-self.thumbstickFrame.AbsolutePosition;self.endImage.Position=UDim2.new(0,b.X,0,b.Y)self:LayoutMiddleImages(c,b)end;function t:BindContextActions()local function b(b)if self.moveTouchObject then return Enum.ContextActionResult.Pass end;if not self:InputInFrame(b)then return Enum.ContextActionResult.Pass end;if self.isFirstTouch then self.isFirstTouch=false;local b=TweenInfo.new(0.5,Enum.EasingStyle.Quad,Enum.EasingDirection.Out,0,false,0)r:Create(self.startImage,b,{Size=UDim2.new(0,0,0,0)}):Play()r:Create(self.endImage,b,{Size=UDim2.new(0,self.thumbstickSize,0,self.thumbstickSize),ImageColor3=Color3.new(0,0,0)}):Play()end;self.moveTouchLockedIn=false;self.moveTouchObject=b;self.moveTouchStartPosition=b.Position;self.moveTouchFirstChanged=true;if h then self:DoFadeInBackground()end;return Enum.ContextActionResult.Pass end;local function c(b)if b==self.moveTouchObject then if self.moveTouchFirstChanged then self.moveTouchFirstChanged=false;local c=Vector2.new(b.Position.X-self.thumbstickFrame.AbsolutePosition.X,b.Position.Y-self.thumbstickFrame.AbsolutePosition.Y)self.startImage.Visible=true;self.startImage.Position=UDim2.new(0,c.X,0,c.Y)self.endImage.Visible=true;self.endImage.Position=self.startImage.Position;self:FadeThumbstick(true)self:MoveStick(b.Position)end;self.moveTouchLockedIn=true;local c=Vector2.new(b.Position.x-self.moveTouchStartPosition.x,b.Position.y-self.moveTouchStartPosition.y)if math.abs(c.x)>0 or math.abs(c.y)>0 then self:DoMove(c)self:MoveStick(b.Position)end;return Enum.ContextActionResult.Sink end;return Enum.ContextActionResult.Pass end;local function f(b)if b==self.moveTouchObject then self:OnInputEnded()if self.moveTouchLockedIn then return Enum.ContextActionResult.Sink end end;return Enum.ContextActionResult.Pass end;local function g(d,d,e)if d==Enum.UserInputState.Begin then return b(e)elseif d==Enum.UserInputState.Change then return c(e)elseif d==Enum.UserInputState.End then return f(e)elseif d==Enum.UserInputState.Cancel then self:OnInputEnded()end end;p:BindActionAtPriority(d,g,false,e,Enum.UserInputType.Touch)end;function t:Create(b)if self.thumbstickFrame then self.thumbstickFrame:Destroy()self.thumbstickFrame=nil;if self.onRenderSteppedConn then self.onRenderSteppedConn:Disconnect()self.onRenderSteppedConn=nil end end;self.thumbstickSize=45;self.thumbstickRingSize=20;self.middleSize=10;self.middleSpacing=self.middleSize+4;self.radiusOfDeadZone=2;self.radiusOfMaxSpeed=20;local d=b.AbsoluteSize;local d=math.min(d.x,d.y)>500;if d then self.thumbstickSize=self.thumbstickSize*2;self.thumbstickRingSize=self.thumbstickRingSize*2;self.middleSize=self.middleSize*2;self.middleSpacing=self.middleSpacing*2;self.radiusOfDeadZone=self.radiusOfDeadZone*2;self.radiusOfMaxSpeed=self.radiusOfMaxSpeed*2 end;local function d(b)if b then self.thumbstickFrame.Size=UDim2.new(1,0,0.4,0)self.thumbstickFrame.Position=UDim2.new(0,0,0.6,0)else self.thumbstickFrame.Size=UDim2.new(0.4,0,2/3,0)self.thumbstickFrame.Position=UDim2.new(0,0,1/3,0)end end;self.thumbstickFrame=Instance.new("Frame")self.thumbstickFrame.BorderSizePixel=0;self.thumbstickFrame.Name="DynamicThumbstickFrame"self.thumbstickFrame.Visible=false;self.thumbstickFrame.BackgroundTransparency=1.0;self.thumbstickFrame.BackgroundColor3=Color3.fromRGB(0,0,0)self.thumbstickFrame.Active=false;d(false)self.startImage=Instance.new("ImageLabel")self.startImage.Name="ThumbstickStart"self.startImage.Visible=true;self.startImage.BackgroundTransparency=1;self.startImage.Image=c;self.startImage.ImageRectOffset=Vector2.new(1,1)self.startImage.ImageRectSize=Vector2.new(144,144)self.startImage.ImageColor3=Color3.new(0,0,0)self.startImage.AnchorPoint=Vector2.new(0.5,0.5)self.startImage.Position=UDim2.new(0,self.thumbstickRingSize*3.3,1,-self.thumbstickRingSize*2.8)self.startImage.Size=UDim2.new(0,self.thumbstickRingSize*3.7,0,self.thumbstickRingSize*3.7)self.startImage.ZIndex=10;self.startImage.Parent=self.thumbstickFrame;self.endImage=Instance.new("ImageLabel")self.endImage.Name="ThumbstickEnd"self.endImage.Visible=true;self.endImage.BackgroundTransparency=1;self.endImage.Image=c;self.endImage.ImageRectOffset=Vector2.new(1,1)self.endImage.ImageRectSize=Vector2.new(144,144)self.endImage.AnchorPoint=Vector2.new(0.5,0.5)self.endImage.Position=self.startImage.Position;self.endImage.Size=UDim2.new(0,self.thumbstickSize*0.8,0,self.thumbstickSize*0.8)self.endImage.ZIndex=10;self.endImage.Parent=self.thumbstickFrame;for b=1,g do self.middleImages[b]=Instance.new("ImageLabel")self.middleImages[b].Name="ThumbstickMiddle"self.middleImages[b].Visible=false;self.middleImages[b].BackgroundTransparency=1;self.middleImages[b].Image=c;self.middleImages[b].ImageRectOffset=Vector2.new(1,1)self.middleImages[b].ImageRectSize=Vector2.new(144,144)self.middleImages[b].ImageTransparency=f[b]self.middleImages[b].AnchorPoint=Vector2.new(0.5,0.5)self.middleImages[b].ZIndex=9;self.middleImages[b].Parent=self.thumbstickFrame end;local c=nil;local function e()if c then c:Disconnect()c=nil end;local b=workspace.CurrentCamera;if b then local function e()local b=b.ViewportSize;local b=b.X<b.Y;d(b)end;c=b:GetPropertyChangedSignal("ViewportSize"):Connect(e)e()end end;workspace:GetPropertyChangedSignal("CurrentCamera"):Connect(e)if workspace.CurrentCamera then e()end;self.moveTouchStartPosition=nil;self.startImageFadeTween=nil;self.endImageFadeTween=nil;self.middleImageFadeTweens={}self.onRenderSteppedConn=q.RenderStepped:Connect(function()if self.tweenInAlphaStart~=nil then local b=tick()-self.tweenInAlphaStart;local c=(self.fadeInAndOutHalfDuration*2*self.fadeInAndOutBalance)self.thumbstickFrame.BackgroundTransparency=1-i*math.min(b/c,1)if b>c then self.tweenOutAlphaStart=tick()self.tweenInAlphaStart=nil end elseif self.tweenOutAlphaStart~=nil then local b=tick()-self.tweenOutAlphaStart;local c=(self.fadeInAndOutHalfDuration*2)-(self.fadeInAndOutHalfDuration*2*self.fadeInAndOutBalance)self.thumbstickFrame.BackgroundTransparency=1-i+i*math.min(b/c,1)if b>c then self.tweenOutAlphaStart=nil end end end)self.onTouchEndedConn=o.TouchEnded:connect(function(b)if b==self.moveTouchObject then self:OnInputEnded()end end)n.MenuOpened:connect(function()if self.moveTouchObject then self:OnInputEnded()end end)local c=s:FindFirstChildOfClass("PlayerGui")while not c do s.ChildAdded:wait()c=s:FindFirstChildOfClass("PlayerGui")end;local d=nil;local e=c.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeLeft or c.CurrentScreenOrientation==Enum.ScreenOrientation.LandscapeRight;local function f()self.fadeInAndOutHalfDuration=2.5;self.fadeInAndOutBalance=0.05;self.tweenInAlphaStart=tick()end;d=c:GetPropertyChangedSignal("CurrentScreenOrientation"):Connect(function()if(e and c.CurrentScreenOrientation==Enum.ScreenOrientation.Portrait)or(not e and c.CurrentScreenOrientation~=Enum.ScreenOrientation.Portrait)then d:disconnect()f()if e then self.hasFadedBackgroundInPortrait=true else self.hasFadedBackgroundInLandscape=true end end end)self.thumbstickFrame.Parent=b;if game:IsLoaded()then f()else coroutine.wrap(function()game.Loaded:Wait()f()end)()end end;return t end;function _Gamepad()local b=game:GetService("UserInputService")local c=game:GetService("ContextActionService")local d=Vector3.new(0,0,0)local e=Enum.UserInputType.None;local f=0.2;local g=_BaseCharacterController()local h=setmetatable({},g)h.__index=h;function h.new(b)local c=setmetatable(g.new(),h)c.CONTROL_ACTION_PRIORITY=b;c.forwardValue=0;c.backwardValue=0;c.leftValue=0;c.rightValue=0;c.activeGamepad=e;c.gamepadConnectedConn=nil;c.gamepadDisconnectedConn=nil;return c end;function h:Enable(c)if not b.GamepadEnabled then return false end;if c==self.enabled then return true end;self.forwardValue=0;self.backwardValue=0;self.leftValue=0;self.rightValue=0;self.moveVector=d;self.isJumping=false;if c then self.activeGamepad=self:GetHighestPriorityGamepad()if self.activeGamepad~=e then self:BindContextActions()self:ConnectGamepadConnectionListeners()else return false end else self:UnbindContextActions()self:DisconnectGamepadConnectionListeners()self.activeGamepad=e end;self.enabled=c;return true end;function h:GetHighestPriorityGamepad()local b=b:GetConnectedGamepads()local c=e;for b,b in pairs(b)do if b.Value<c.Value then c=b end end;return c end;function h:BindContextActions()if self.activeGamepad==e then return false end;local b=function(b,b,c)self.isJumping=(b==Enum.UserInputState.Begin)return Enum.ContextActionResult.Sink end;local d=function(b,b,c)if b==Enum.UserInputState.Cancel then self.moveVector=d;return Enum.ContextActionResult.Sink end;if self.activeGamepad~=c.UserInputType then return Enum.ContextActionResult.Pass end;if c.KeyCode~=Enum.KeyCode.Thumbstick1 then return end;if c.Position.magnitude>f then self.moveVector=Vector3.new(c.Position.X,0,-c.Position.Y)else self.moveVector=d end;return Enum.ContextActionResult.Sink end;c:BindActivate(self.activeGamepad,Enum.KeyCode.ButtonR2)c:BindActionAtPriority("jumpAction",b,false,self.CONTROL_ACTION_PRIORITY,Enum.KeyCode.ButtonA)c:BindActionAtPriority("moveThumbstick",d,false,self.CONTROL_ACTION_PRIORITY,Enum.KeyCode.Thumbstick1)return true end;function h:UnbindContextActions()if self.activeGamepad~=e then c:UnbindActivate(self.activeGamepad,Enum.KeyCode.ButtonR2)end;c:UnbindAction("moveThumbstick")c:UnbindAction("jumpAction")end;function h:OnNewGamepadConnected()local b=self:GetHighestPriorityGamepad()if b==self.activeGamepad then return end;if b==e then warn("Gamepad:OnNewGamepadConnected found no connected gamepads")self:UnbindContextActions()return end;if self.activeGamepad~=e then self:UnbindContextActions()end;self.activeGamepad=b;self:BindContextActions()end;function h:OnCurrentGamepadDisconnected()if self.activeGamepad~=e then c:UnbindActivate(self.activeGamepad,Enum.KeyCode.ButtonR2)end;local b=self:GetHighestPriorityGamepad()if self.activeGamepad~=e and b==self.activeGamepad then warn("Gamepad:OnCurrentGamepadDisconnected found the supposedly disconnected gamepad in connectedGamepads.")self:UnbindContextActions()self.activeGamepad=e;return end;if b==e then self:UnbindContextActions()self.activeGamepad=e else self.activeGamepad=b;c:BindActivate(self.activeGamepad,Enum.KeyCode.ButtonR2)end end;function h:ConnectGamepadConnectionListeners()self.gamepadConnectedConn=b.GamepadConnected:Connect(function(b)self:OnNewGamepadConnected()end)self.gamepadDisconnectedConn=b.GamepadDisconnected:Connect(function(b)if self.activeGamepad==b then self:OnCurrentGamepadDisconnected()end end)end;function h:DisconnectGamepadConnectionListeners()if self.gamepadConnectedConn then self.gamepadConnectedConn:Disconnect()self.gamepadConnectedConn=nil end;if self.gamepadDisconnectedConn then self.gamepadDisconnectedConn:Disconnect()self.gamepadDisconnectedConn=nil end end;return h end;function _Keyboard()local b=game:GetService("UserInputService")local c=game:GetService("ContextActionService")local d=Vector3.new(0,0,0)local e=_BaseCharacterController()local f=setmetatable({},e)f.__index=f;function f.new(b)local c=setmetatable(e.new(),f)c.CONTROL_ACTION_PRIORITY=b;c.textFocusReleasedConn=nil;c.textFocusGainedConn=nil;c.windowFocusReleasedConn=nil;c.forwardValue=0;c.backwardValue=0;c.leftValue=0;c.rightValue=0;c.jumpEnabled=true;return c end;function f:Enable(c)if not b.KeyboardEnabled then return false end;if c==self.enabled then return true end;self.forwardValue=0;self.backwardValue=0;self.leftValue=0;self.rightValue=0;self.moveVector=d;self.jumpRequested=false;self:UpdateJump()if c then self:BindContextActions()self:ConnectFocusEventListeners()else self:UnbindContextActions()self:DisconnectFocusEventListeners()end;self.enabled=c;return true end;function f:UpdateMovement(b)if b==Enum.UserInputState.Cancel then self.moveVector=d else self.moveVector=Vector3.new(self.leftValue+self.rightValue,0,self.forwardValue+self.backwardValue)end end;function f:UpdateJump()self.isJumping=self.jumpRequested end;function f:BindContextActions()local b=function(b,b,c)self.forwardValue=(b==Enum.UserInputState.Begin)and-1 or 0;self:UpdateMovement(b)return Enum.ContextActionResult.Pass end;local d=function(b,b,c)self.backwardValue=(b==Enum.UserInputState.Begin)and 1 or 0;self:UpdateMovement(b)return Enum.ContextActionResult.Pass end;local e=function(b,b,c)self.leftValue=(b==Enum.UserInputState.Begin)and-1 or 0;self:UpdateMovement(b)return Enum.ContextActionResult.Pass end;local f=function(b,b,c)self.rightValue=(b==Enum.UserInputState.Begin)and 1 or 0;self:UpdateMovement(b)return Enum.ContextActionResult.Pass end;local g=function(b,b,c)self.jumpRequested=self.jumpEnabled and(b==Enum.UserInputState.Begin)self:UpdateJump()return Enum.ContextActionResult.Pass end;c:BindActionAtPriority("moveForwardAction",b,false,self.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterForward)c:BindActionAtPriority("moveBackwardAction",d,false,self.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterBackward)c:BindActionAtPriority("moveLeftAction",e,false,self.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterLeft)c:BindActionAtPriority("moveRightAction",f,false,self.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterRight)c:BindActionAtPriority("jumpAction",g,false,self.CONTROL_ACTION_PRIORITY,Enum.PlayerActions.CharacterJump)end;function f:UnbindContextActions()c:UnbindAction("moveForwardAction")c:UnbindAction("moveBackwardAction")c:UnbindAction("moveLeftAction")c:UnbindAction("moveRightAction")c:UnbindAction("jumpAction")end;function f:ConnectFocusEventListeners()local function c()self.moveVector=d;self.forwardValue=0;self.backwardValue=0;self.leftValue=0;self.rightValue=0;self.jumpRequested=false;self:UpdateJump()end;local function d(b)self.jumpRequested=false;self:UpdateJump()end;self.textFocusReleasedConn=b.TextBoxFocusReleased:Connect(c)self.textFocusGainedConn=b.TextBoxFocused:Connect(d)self.windowFocusReleasedConn=b.WindowFocused:Connect(c)end;function f:DisconnectFocusEventListeners()if self.textFocusReleasedCon then self.textFocusReleasedCon:Disconnect()self.textFocusReleasedCon=nil end;if self.textFocusGainedConn then self.textFocusGainedConn:Disconnect()self.textFocusGainedConn=nil end;if self.windowFocusReleasedConn then self.windowFocusReleasedConn:Disconnect()self.windowFocusReleasedConn=nil end end;return f end;function _ControlModule()local b={}b.__index=b;local c=game:GetService("Players")local d=game:GetService("RunService")local e=game:GetService("UserInputService")local f=game:GetService("Workspace")local g=UserSettings():GetService("UserGameSettings")local h=_Keyboard()local i=_Gamepad()local j=_DynamicThumbstick()local k;do local b,c=pcall(function()return UserSettings():IsUserFeatureEnabled("UserMakeThumbstickDynamic")end)k=b and c end;local k=k and j or _TouchThumbstick()local l=_ClickToMoveController()local m=_TouchJump()local n=_VehicleController()local o=Enum.ContextActionPriority.Default.Value;local p={[Enum.TouchMovementMode.DPad]=j,[Enum.DevTouchMovementMode.DPad]=j,[Enum.TouchMovementMode.Thumbpad]=j,[Enum.DevTouchMovementMode.Thumbpad]=j,[Enum.TouchMovementMode.Thumbstick]=k,[Enum.DevTouchMovementMode.Thumbstick]=k,[Enum.TouchMovementMode.DynamicThumbstick]=j,[Enum.DevTouchMovementMode.DynamicThumbstick]=j,[Enum.TouchMovementMode.ClickToMove]=l,[Enum.DevTouchMovementMode.ClickToMove]=l,[Enum.TouchMovementMode.Default]=j,[Enum.ComputerMovementMode.Default]=h,[Enum.ComputerMovementMode.KeyboardMouse]=h,[Enum.DevComputerMovementMode.KeyboardMouse]=h,[Enum.DevComputerMovementMode.Scriptable]=nil,[Enum.ComputerMovementMode.ClickToMove]=l,[Enum.DevComputerMovementMode.ClickToMove]=l}local q={[Enum.UserInputType.Keyboard]=h,[Enum.UserInputType.MouseButton1]=h,[Enum.UserInputType.MouseButton2]=h,[Enum.UserInputType.MouseButton3]=h,[Enum.UserInputType.MouseWheel]=h,[Enum.UserInputType.MouseMovement]=h,[Enum.UserInputType.Gamepad1]=i,[Enum.UserInputType.Gamepad2]=i,[Enum.UserInputType.Gamepad3]=i,[Enum.UserInputType.Gamepad4]=i}local r;function b.new()local b=setmetatable({},b)b.controllers={}b.activeControlModule=nil;b.activeController=nil;b.touchJumpController=nil;b.moveFunction=c.LocalPlayer.Move;b.humanoid=nil;b.lastInputType=Enum.UserInputType.None;b.humanoidSeatedConn=nil;b.vehicleController=nil;b.touchControlFrame=nil;b.vehicleController=n.new(o)c.LocalPlayer.CharacterAdded:Connect(function(c)b:OnCharacterAdded(c)end)c.LocalPlayer.CharacterRemoving:Connect(function(c)b:OnCharacterRemoving(c)end)if c.LocalPlayer.Character then b:OnCharacterAdded(c.LocalPlayer.Character)end;d:BindToRenderStep("ControlScriptRenderstep",Enum.RenderPriority.Input.Value,function(c)b:OnRenderStepped(c)end)e.LastInputTypeChanged:Connect(function(c)b:OnLastInputTypeChanged(c)end)g:GetPropertyChangedSignal("TouchMovementMode"):Connect(function()b:OnTouchMovementModeChange()end)c.LocalPlayer:GetPropertyChangedSignal("DevTouchMovementMode"):Connect(function()b:OnTouchMovementModeChange()end)g:GetPropertyChangedSignal("ComputerMovementMode"):Connect(function()b:OnComputerMovementModeChange()end)c.LocalPlayer:GetPropertyChangedSignal("DevComputerMovementMode"):Connect(function()b:OnComputerMovementModeChange()end)b.playerGui=nil;b.touchGui=nil;b.playerGuiAddedConn=nil;if e.TouchEnabled then b.playerGui=c.LocalPlayer:FindFirstChildOfClass("PlayerGui")if b.playerGui then b:CreateTouchGuiContainer()b:OnLastInputTypeChanged(e:GetLastInputType())else b.playerGuiAddedConn=c.LocalPlayer.ChildAdded:Connect(function(c)if c:IsA("PlayerGui")then b.playerGui=c;b:CreateTouchGuiContainer()b.playerGuiAddedConn:Disconnect()b.playerGuiAddedConn=nil;b:OnLastInputTypeChanged(e:GetLastInputType())end end)end else b:OnLastInputTypeChanged(e:GetLastInputType())end;return b end;function b:GetMoveVector()if self.activeController then return self.activeController:GetMoveVector()end;return Vector3.new(0,0,0)end;function b:GetActiveController()return self.activeController end;function b:EnableActiveControlModule()if self.activeControlModule==l then self.activeController:Enable(true,c.LocalPlayer.DevComputerMovementMode==Enum.DevComputerMovementMode.UserChoice,self.touchJumpController)elseif self.touchControlFrame then self.activeController:Enable(true,self.touchControlFrame)else self.activeController:Enable(true)end end;function b:Enable(b)if not self.activeController then return end;if b==nil then b=true end;if b then self:EnableActiveControlModule()else self:Disable()end end;function b:Disable()if self.activeController then self.activeController:Enable(false)if self.moveFunction then self.moveFunction(c.LocalPlayer,Vector3.new(0,0,0),true)end end end;function b:SelectComputerMovementModule()if not(e.KeyboardEnabled or e.GamepadEnabled)then return nil,false end;local b;local c=c.LocalPlayer.DevComputerMovementMode;if c==Enum.DevComputerMovementMode.UserChoice then b=q[r]if g.ComputerMovementMode==Enum.ComputerMovementMode.ClickToMove and b==h then b=l end else b=p[c]if(not b)and c~=Enum.DevComputerMovementMode.Scriptable then warn("No character control module is associated with DevComputerMovementMode ",c)end end;if b then return b,true elseif c==Enum.DevComputerMovementMode.Scriptable then return nil,true else return nil,false end end;function b:SelectTouchModule()if not e.TouchEnabled then return nil,false end;local b;local c=c.LocalPlayer.DevTouchMovementMode;if c==Enum.DevTouchMovementMode.UserChoice then b=p[g.TouchMovementMode]elseif c==Enum.DevTouchMovementMode.Scriptable then return nil,true else b=p[c]end;return b,true end;local function d(b,c)local d=f.CurrentCamera;if not d then return c end;if b:GetState()==Enum.HumanoidStateType.Swimming then return d.CFrame:VectorToWorldSpace(c)end;local b,e;local d,d,d,d,f,g,h,h,h,i,i,i=d.CFrame:GetComponents()if h<1 and h>-1 then b=i;e=g else b=d;e=-f*math.sign(h)end;local d=math.sqrt(b*b+e*e)return Vector3.new((b*c.x+e*c.z)/d,0,(b*c.z-e*c.x)/d)end;function b:OnRenderStepped(b)if self.activeController and self.activeController.enabled and self.humanoid then self.activeController:OnRenderStepped(b)local e=self.activeController:GetMoveVector()local f=self.activeController:IsMoveVectorCameraRelative()local g=self:GetClickToMoveController()if self.activeController~=g then if e.magnitude>0 then g:CleanupPath()else g:OnRenderStepped(b)e=g:GetMoveVector()f=g:IsMoveVectorCameraRelative()end end;local b=false;if self.vehicleController then e,b=self.vehicleController:Update(e,f,self.activeControlModule==i)end;if f then e=d(self.humanoid,e)end;self.moveFunction(c.LocalPlayer,e,false)self.humanoid.Jump=self.activeController:GetIsJumping()or(self.touchJumpController and self.touchJumpController:GetIsJumping())end end;function b:OnHumanoidSeated(b,c)if b then if c and c:IsA("VehicleSeat")then if not self.vehicleController then self.vehicleController=self.vehicleController.new(o)end;self.vehicleController:Enable(true,c)end else if self.vehicleController then self.vehicleController:Enable(false,c)end end end;function b:OnCharacterAdded(b)self.humanoid=b:FindFirstChildOfClass("Humanoid")while not self.humanoid do b.ChildAdded:wait()self.humanoid=b:FindFirstChildOfClass("Humanoid")end;if self.touchGui then self.touchGui.Enabled=true end;if self.humanoidSeatedConn then self.humanoidSeatedConn:Disconnect()self.humanoidSeatedConn=nil end;self.humanoidSeatedConn=self.humanoid.Seated:Connect(function(b,c)self:OnHumanoidSeated(b,c)end)end;function b:OnCharacterRemoving(b)self.humanoid=nil;if self.touchGui then self.touchGui.Enabled=false end end;function b:SwitchToController(b)if not b then if self.activeController then self.activeController:Enable(false)end;self.activeController=nil;self.activeControlModule=nil else if not self.controllers[b]then self.controllers[b]=b.new(o)end;if self.activeController~=self.controllers[b]then if self.activeController then self.activeController:Enable(false)end;self.activeController=self.controllers[b]self.activeControlModule=b;if self.touchControlFrame and(self.activeControlModule==l or self.activeControlModule==k or self.activeControlModule==j)then if not self.controllers[m]then self.controllers[m]=m.new()end;self.touchJumpController=self.controllers[m]self.touchJumpController:Enable(true,self.touchControlFrame)else if self.touchJumpController then self.touchJumpController:Enable(false)end end;self:EnableActiveControlModule()end end end;function b:OnLastInputTypeChanged(b)if r==b then warn("LastInputType Change listener called with current type.")end;r=b;if r==Enum.UserInputType.Touch then local b,c=self:SelectTouchModule()if c then while not self.touchControlFrame do wait()end;self:SwitchToController(b)end elseif q[r]~=nil then local b=self:SelectComputerMovementModule()if b then self:SwitchToController(b)end end end;function b:OnComputerMovementModeChange()local b,c=self:SelectComputerMovementModule()if c then self:SwitchToController(b)end end;function b:OnTouchMovementModeChange()local b,c=self:SelectTouchModule()if c then while not self.touchControlFrame do wait()end;self:SwitchToController(b)end end;function b:CreateTouchGuiContainer()if self.touchGui then self.touchGui:Destroy()end;self.touchGui=Instance.new("ScreenGui")self.touchGui.Name="TouchGui"self.touchGui.ResetOnSpawn=false;self.touchGui.ZIndexBehavior=Enum.ZIndexBehavior.Sibling;self.touchGui.Enabled=self.humanoid~=nil;self.touchControlFrame=Instance.new("Frame")self.touchControlFrame.Name="TouchControlFrame"self.touchControlFrame.Size=UDim2.new(1,0,1,0)self.touchControlFrame.BackgroundTransparency=1;self.touchControlFrame.Parent=self.touchGui;self.touchGui.Parent=self.playerGui end;function b:GetClickToMoveController()if not self.controllers[l]then self.controllers[l]=l.new(o)end;return self.controllers[l]end;function b:IsJumping()if self.activeController then return self.activeController:GetIsJumping()or(self.touchJumpController and self.touchJumpController:GetIsJumping())end;return false end;return b.new()end;function _PlayerModule()local b={}b.__index=b;function b.new()local b=setmetatable({},b)b.cameras=_CameraModule()b.controls=_ControlModule()return b end;function b:GetCameras()return self.cameras end;function b:GetControls()return self.controls end;function b:GetClickToMoveController()return self.controls:GetClickToMoveController()end;return b.new()end;function _sounds()local b=Instance.new("BindableEvent",script)local c=game:GetService("Players")local d=game:GetService("RunService")local e={Climbing={SoundId="rbxasset://sounds/action_footsteps_plastic.mp3",Looped=true},Died={SoundId="rbxasset://sounds/uuhhh.mp3"},FreeFalling={SoundId="rbxasset://sounds/action_falling.mp3",Looped=true},GettingUp={SoundId="rbxasset://sounds/action_get_up.mp3"},Jumping={SoundId="rbxasset://sounds/action_jump.mp3"},Landing={SoundId="rbxasset://sounds/action_jump_land.mp3"},Running={SoundId="rbxasset://sounds/action_footsteps_plastic.mp3",Looped=true,Pitch=1.85},Splash={SoundId="rbxasset://sounds/impact_water.mp3"},Swimming={SoundId="rbxasset://sounds/action_swim.mp3",Looped=true,Pitch=1.6}}local function f(...)local b=Instance.new("BindableEvent")local c={...}local function d(...)for b=1,#c do c[b]:Disconnect()end;return b:Fire(...)end;for b=1,#c do c[b]=c[b]:Connect(d)end;return b.Event:Wait()end;local function g(b,c,d,e,f)return(b-c)*(f-e)/(d-c)+e end;local function h(b)b.TimePosition=0;b.Playing=true end;local function i(b)b.Playing=false;b.TimePosition=0 end;local function i(b)local c={}for b,d in pairs(b)do c[b]=d end;return c end;local function j(c,f,j)local k={}for b,c in pairs(e)do local d=Instance.new("Sound")d.Name=b;d.Archivable=false;d.EmitterSize=5;d.MaxDistance=150;d.Volume=0.65;for b,c in pairs(c)do d[b]=c end;d.Parent=j;k[b]=d end;local e={}local function l(b)for c in pairs(i(e))do if c~=b then c.Playing=false;e[c]=nil end end end;local g={[Enum.HumanoidStateType.FallingDown]=function()l()end,[Enum.HumanoidStateType.GettingUp]=function()l()h(k.GettingUp)end,[Enum.HumanoidStateType.Jumping]=function()l()h(k.Jumping)end,[Enum.HumanoidStateType.Swimming]=function()local b=math.abs(j.Velocity.Y)if b>0.1 then k.Splash.Volume=math.clamp(g(b,100,350,0.28,1),0,1)h(k.Splash)end;l(k.Swimming)k.Swimming.Playing=true;e[k.Swimming]=true end,[Enum.HumanoidStateType.Freefall]=function()k.FreeFalling.Volume=0;l(k.FreeFalling)e[k.FreeFalling]=true end,[Enum.HumanoidStateType.Landed]=function()l()local b=math.abs(j.Velocity.Y)if b>75 then k.Landing.Volume=math.clamp(g(b,50,100,0,1),0,1)h(k.Landing)end end,[Enum.HumanoidStateType.Running]=function()l(k.Running)k.Running.Playing=true;e[k.Running]=true end,[Enum.HumanoidStateType.Climbing]=function()local b=k.Climbing;if math.abs(j.Velocity.Y)>0.1 then b.Playing=true;l(b)else l()end;e[b]=true end,[Enum.HumanoidStateType.Seated]=function()l()end,[Enum.HumanoidStateType.Dead]=function()l()h(k.Died)end}local h={[k.Climbing]=function(b,b,c)b.Playing=c.Magnitude>0.1 end,[k.FreeFalling]=function(b,c,d)if d.Magnitude>75 then c.Volume=math.clamp(c.Volume+0.9*b,0,1)else c.Volume=0 end end,[k.Running]=function(b,b,c)b.Playing=c.Magnitude>0.5 and f.MoveDirection.Magnitude>0.5 end}local i={[Enum.HumanoidStateType.RunningNoPhysics]=Enum.HumanoidStateType.Running}local k=i[f:GetState()]or f:GetState()local l={}local l=f.StateChanged:Connect(function(b,b)b=i[b]or b;if b~=k then local c=g[b]if c then c()end;k=b end end)local b=b.Event:Connect(function(b)b=i[b]or b;if b~=k then local c=g[b]if c then c()end;k=b end end)local d=d.Stepped:Connect(function(b,b)for c in pairs(e)do local d=h[c]if d then d(b,c,j.Velocity)end end end)local e;local g;local h;local function i()l:Disconnect()b:Disconnect()d:Disconnect()e:Disconnect()g:Disconnect()h:Disconnect()end;e=f.AncestryChanged:Connect(function(b,b)if not b then i()end end)g=j.AncestryChanged:Connect(function(b,b)if not b then i()end end)h=c.CharacterAdded:Connect(i)end;local function d(b)local function c(c)if not c.Parent then f(c.AncestryChanged,b.CharacterAdded)end;if b.Character~=c or not c.Parent then return end;local d=c:FindFirstChildOfClass("Humanoid")while c:IsDescendantOf(game)and not d do f(c.ChildAdded,c.AncestryChanged,b.CharacterAdded)d=c:FindFirstChildOfClass("Humanoid")end;if b.Character~=c or not c:IsDescendantOf(game)then return end;local e=c:FindFirstChild("HumanoidRootPart")while c:IsDescendantOf(game)and not e do f(c.ChildAdded,c.AncestryChanged,d.AncestryChanged,b.CharacterAdded)e=c:FindFirstChild("HumanoidRootPart")end;if e and d:IsDescendantOf(game)and c:IsDescendantOf(game)and b.Character==c then j(b,d,e)end end;if b.Character then c(b.Character)end;b.CharacterAdded:Connect(c)end;c.PlayerAdded:Connect(d)for b,b in ipairs(c:GetPlayers())do d(b)end;return b end;function _StateTracker()local b=0.1;local c={["onRunning"]=true,["onClimbing"]=true}local d={["onFreeFall"]=true,["onJumping"]=true}local d={["onRunning"]=Enum.HumanoidStateType.Running,["onJumping"]=Enum.HumanoidStateType.Jumping,["onFreeFall"]=Enum.HumanoidStateType.Freefall}local e={}e.__index=e;function e.new(b,c)local d=setmetatable({},e)d.Humanoid=b;d.HRP=b.RootPart;d.Speed=0;d.State="onRunning"d.Jumped=false;d.JumpTick=tick()d.SoundState=c;d._ChangedEvent=Instance.new("BindableEvent")d.Changed=d._ChangedEvent.Event;return d end;function e:Destroy()self._ChangedEvent:Destroy()end;function e:RequestedJump()self.Jumped=true;self.JumpTick=tick()end;function e:OnStep(e,f,g)local h=self.HRP.Velocity;local i=h:Dot(e)local j,k=self.State,self.Speed;local l;local m=h.Magnitude;if(not f)then if(i>0)then if(self.Jumped)then l="onJumping"else l="onFreeFall"end else if(self.Jumped)then self.Jumped=false end;l="onFreeFall"end else if(self.Jumped and tick()-self.JumpTick>0.1)then self.Jumped=false end;m=(h-i*e).Magnitude;l="onRunning"end;m=g and m or 0;if(j~=l or(c[l]and math.abs(k-m)>b))then self.State=l;self.Speed=m;self.SoundState:Fire(d[l])self._ChangedEvent:Fire(self.State,self.Speed)end end;return e end;function _InitObjects()local b=workspace:FindFirstChild("objects")or game:GetObjects("rbxassetid://5045408489")[1]local c=b:WaitForChild("Sphere")local d=b:WaitForChild("Floor")local e=b:WaitForChild("VectorForce")local b=b:WaitForChild("BodyGyro")local function f(f)local g=f.HRP;local h=f.Humanoid;local c=c:Clone()c.Parent=f.Character;local d=d:Clone()d.Parent=f.Character;local f=(h.RigType==Enum.HumanoidRigType.R15)local h=f and(h.HipHeight+0.05)or 2;local i=Instance.new("Weld")i.C0=CFrame.new(0,-h,0.1)i.Part0=g;i.Part1=c;i.Parent=c;local i=Instance.new("Weld")i.C0=CFrame.new(0,-(h+1.5),0)i.Part0=g;i.Part1=d;i.Parent=d;local b=b:Clone()b.CFrame=g.CFrame;b.Parent=g;local e=e:Clone()e.Attachment0=f and g:WaitForChild("RootRigAttachment")or g:WaitForChild("RootAttachment")e.Parent=g;return c,b,e,d end;return f end;local b=game.Players.LocalPlayer;local c=b:GetMouse()local c;b.CharacterAdded:Connect(function(b)c=b end)function _R6()function r6()local b=c;local c=b:WaitForChild("Torso")local d=c:WaitForChild("Right Shoulder")local e=c:WaitForChild("Left Shoulder")local f=c:WaitForChild("Right Hip")local g=c:WaitForChild("Left Hip")local c=c:WaitForChild("Neck")local c=b:WaitForChild("Humanoid")local h="Standing"local i=""local j=nil;local k=nil;local l=nil;local m=1.0;local n={}local o={idle={{id="http://www.roblox.com/asset/?id=180435571",weight=9},{id="http://www.roblox.com/asset/?id=180435792",weight=1}},walk={{id="http://www.roblox.com/asset/?id=180426354",weight=10}},run={{id="run.xml",weight=10}},jump={{id="http://www.roblox.com/asset/?id=125750702",weight=10}},fall={{id="http://www.roblox.com/asset/?id=180436148",weight=10}},climb={{id="http://www.roblox.com/asset/?id=180436334",weight=10}},sit={{id="http://www.roblox.com/asset/?id=178130996",weight=10}},toolnone={{id="http://www.roblox.com/asset/?id=182393478",weight=10}},toolslash={{id="http://www.roblox.com/asset/?id=129967390",weight=10}},toollunge={{id="http://www.roblox.com/asset/?id=129967478",weight=10}},wave={{id="http://www.roblox.com/asset/?id=128777973",weight=10}},point={{id="http://www.roblox.com/asset/?id=128853357",weight=10}},dance1={{id="http://www.roblox.com/asset/?id=182435998",weight=10},{id="http://www.roblox.com/asset/?id=182491037",weight=10},{id="http://www.roblox.com/asset/?id=182491065",weight=10}},dance2={{id="http://www.roblox.com/asset/?id=182436842",weight=10},{id="http://www.roblox.com/asset/?id=182491248",weight=10},{id="http://www.roblox.com/asset/?id=182491277",weight=10}},dance3={{id="http://www.roblox.com/asset/?id=182436935",weight=10},{id="http://www.roblox.com/asset/?id=182491368",weight=10},{id="http://www.roblox.com/asset/?id=182491423",weight=10}},laugh={{id="http://www.roblox.com/asset/?id=129423131",weight=10}},cheer={{id="http://www.roblox.com/asset/?id=129423030",weight=10}}}local p={"dance1","dance2","dance3"}local q={wave=false,point=false,dance1=true,dance2=true,dance3=true,laugh=false,cheer=false}function configureAnimationSet(b,c)if(n[b]~=nil)then for b,b in pairs(n[b].connections)do b:disconnect()end end;n[b]={}n[b].count=0;n[b].totalWeight=0;n[b].connections={}local d=script:FindFirstChild(b)if(d~=nil)then table.insert(n[b].connections,d.ChildAdded:connect(function(d)configureAnimationSet(b,c)end))table.insert(n[b].connections,d.ChildRemoved:connect(function(d)configureAnimationSet(b,c)end))local e=1;for d,d in pairs(d:GetChildren())do if(d:IsA("Animation"))then table.insert(n[b].connections,d.Changed:connect(function(d)configureAnimationSet(b,c)end))n[b][e]={}n[b][e].anim=d;local c=d:FindFirstChild("Weight")if(c==nil)then n[b][e].weight=1 else n[b][e].weight=c.Value end;n[b].count=n[b].count+1;n[b].totalWeight=n[b].totalWeight+n[b][e].weight;e=e+1 end end end;if(n[b].count<=0)then for c,d in pairs(c)do n[b][c]={}n[b][c].anim=Instance.new("Animation")n[b][c].anim.Name=b;n[b][c].anim.AnimationId=d.id;n[b][c].weight=d.weight;n[b].count=n[b].count+1;n[b].totalWeight=n[b].totalWeight+d.weight end end end;function scriptChildModified(b)local c=o[b.Name]if(c~=nil)then configureAnimationSet(b.Name,c)end end;script.ChildAdded:connect(scriptChildModified)script.ChildRemoved:connect(scriptChildModified)for b,c in pairs(o)do configureAnimationSet(b,c)end;local o="None"local r=0;local s=0;local t=0.3;local u=0.1;local v=0.3;local w=0.75;function stopAllAnimations()local b=i;if(q[b]~=nil and q[b]==false)then b="idle"end;i=""j=nil;if(l~=nil)then l:disconnect()end;if(k~=nil)then k:Stop()k:Destroy()k=nil end;return b end;function setAnimationSpeed(b)if b~=m then m=b;k:AdjustSpeed(m)end end;function keyFrameReachedFunc(b)if(b=="End")then local b=i;if(q[b]~=nil and q[b]==false)then b="idle"end;local d=m;playAnimation(b,0.0,c)setAnimationSpeed(d)end end;function playAnimation(b,c,d)local e=math.random(1,n[b].totalWeight)local f=e;local f=1;while(e>n[b][f].weight)do e=e-n[b][f].weight;f=f+1 end;local e=n[b][f].anim;if(e~=j)then if(k~=nil)then k:Stop(c)k:Destroy()end;m=1.0;k=d:LoadAnimation(e)k.Priority=Enum.AnimationPriority.Core;k:Play(c)i=b;j=e;if(l~=nil)then l:disconnect()end;l=k.KeyframeReached:connect(keyFrameReachedFunc)end end;local k=""local l=nil;local m=nil;local w=nil;function toolKeyFrameReachedFunc(b)if(b=="End")then playToolAnimation(k,0.0,c)end end;function playToolAnimation(b,c,d,e)local f=math.random(1,n[b].totalWeight)local g=f;local g=1;while(f>n[b][g].weight)do f=f-n[b][g].weight;g=g+1 end;local f=n[b][g].anim;if(m~=f)then if(l~=nil)then l:Stop()l:Destroy()c=0 end;l=d:LoadAnimation(f)if e then l.Priority=e end;l:Play(c)k=b;m=f;w=l.KeyframeReached:connect(toolKeyFrameReachedFunc)end end;function stopToolAnimations()local b=k;if(w~=nil)then w:disconnect()end;k=""m=nil;if(l~=nil)then l:Stop()l:Destroy()l=nil end;return b end;function onRunning(b)if b>0.01 then playAnimation("walk",0.1,c)if j and j.AnimationId=="http://www.roblox.com/asset/?id=180426354"then setAnimationSpeed(b/14.5)end;h="Running"else if q[i]==nil then playAnimation("idle",0.1,c)h="Standing"end end end;function onDied()h="Dead"end;function onJumping()playAnimation("jump",0.1,c)s=t;h="Jumping"end;function onClimbing(b)playAnimation("climb",0.1,c)setAnimationSpeed(b/12.0)h="Climbing"end;function onGettingUp()h="GettingUp"end;function onFreeFall()if(s<=0)then playAnimation("fall",v,c)end;h="FreeFall"end;function onFallingDown()h="FallingDown"end;function onSeated()h="Seated"end;function onPlatformStanding()h="PlatformStanding"end;function onSwimming(b)if b>0 then h="Running"else h="Standing"end end;function getTool()for b,b in ipairs(b:GetChildren())do if b.className=="Tool"then return b end end;return nil end;function getToolAnim(b)for b,b in ipairs(b:GetChildren())do if b.Name=="toolanim"and b.className=="StringValue"then return b end end;return nil end;function animateTool()if(o=="None")then playToolAnimation("toolnone",u,c,Enum.AnimationPriority.Idle)return end;if(o=="Slash")then playToolAnimation("toolslash",0,c,Enum.AnimationPriority.Action)return end;if(o=="Lunge")then playToolAnimation("toollunge",0,c,Enum.AnimationPriority.Action)return end end;function moveSit()d.MaxVelocity=0.15;e.MaxVelocity=0.15;d:SetDesiredAngle(3.14/2)e:SetDesiredAngle(-3.14/2)f:SetDesiredAngle(3.14/2)g:SetDesiredAngle(-3.14/2)end;local i=0;function move(b)local j=1;local k=1;local l=b-i;i=b;local i=0;local n=false;if(s>0)then s=s-l end;if(h=="FreeFall"and s<=0)then playAnimation("fall",v,c)elseif(h=="Seated")then playAnimation("sit",0.5,c)return elseif(h=="Running")then playAnimation("walk",0.1,c)elseif(h=="Dead"or h=="GettingUp"or h=="FallingDown"or h=="Seated"or h=="PlatformStanding")then stopAllAnimations()j=0.1;k=1;n=true end;if(n)then local b=j*math.sin(b*k)d:SetDesiredAngle(b+i)e:SetDesiredAngle(b-i)f:SetDesiredAngle(-b)g:SetDesiredAngle(-b)end;local c=getTool()if c and c:FindFirstChild("Handle")then local c=getToolAnim(c)if c then o=c.Value;c.Parent=nil;r=b+.3 end;if b>r then r=0;o="None"end;animateTool()else stopToolAnimations()o="None"m=nil;r=0 end end;local d={}local e=c;local function f()for b=1,#d do d[b]:Disconnect()end;d={}end;local function g()f()h=e.Sit and"Seated"or"Standing"d={e.Died:connect(onDied),e.Running:connect(onRunning),e.Jumping:connect(onJumping),e.Climbing:connect(onClimbing),e.GettingUp:connect(onGettingUp),e.FreeFalling:connect(onFreeFall),e.FallingDown:connect(onFallingDown),e.Seated:connect(onSeated),e.PlatformStanding:connect(onPlatformStanding),e.Swimming:connect(onSwimming)}end;g()game:GetService("Players").LocalPlayer.Chatted:connect(function(b)local d=""if b=="/e dance"then d=p[math.random(1,#p)]elseif(string.sub(b,1,3)=="/e ")then d=string.sub(b,4)elseif(string.sub(b,1,7)=="/emote ")then d=string.sub(b,8)end;if(h=="Standing"and q[d]~=nil)then playAnimation(d,0.1,c)end end)playAnimation("idle",0.1,c)h="Standing"spawn(function()while b.Parent~=nil do local b,b=wait(0.1)move(b)end end)return{onRunning=onRunning,onDied=onDied,onJumping=onJumping,onClimbing=onClimbing,onGettingUp=onGettingUp,onFreeFall=onFreeFall,onFallingDown=onFallingDown,onSeated=onSeated,onPlatformStanding=onPlatformStanding,onHook=g,onUnhook=f}end;return r6()end;function _R15()local function b()local b=c;local c=b:WaitForChild("Humanoid")local d="Standing"local e,f=pcall(function()return UserSettings():IsUserFeatureEnabled("UserNoUpdateOnLoop")end)local e=e and f;local f,g=pcall(function()return UserSettings():IsUserFeatureEnabled("UserAnimationSpeedDampening")end)local f=f and g;local g,h=pcall(function()return UserSettings():IsUserFeatureEnabled("UserAnimateScriptEmoteHook")end)local g=g and h;local h=script:FindFirstChild("ScaleDampeningPercent")local i=2;local j=0.1;local k=""local l=nil;local m=nil;local n=nil;local o=1.0;local p=nil;local q=nil;local r={}local s={idle={{id="http://www.roblox.com/asset/?id=507766666",weight=1},{id="http://www.roblox.com/asset/?id=507766951",weight=1},{id="http://www.roblox.com/asset/?id=507766388",weight=9}},walk={{id="http://www.roblox.com/asset/?id=507777826",weight=10}},run={{id="http://www.roblox.com/asset/?id=507767714",weight=10}},swim={{id="http://www.roblox.com/asset/?id=507784897",weight=10}},swimidle={{id="http://www.roblox.com/asset/?id=507785072",weight=10}},jump={{id="http://www.roblox.com/asset/?id=507765000",weight=10}},fall={{id="http://www.roblox.com/asset/?id=507767968",weight=10}},climb={{id="http://www.roblox.com/asset/?id=507765644",weight=10}},sit={{id="http://www.roblox.com/asset/?id=2506281703",weight=10}},toolnone={{id="http://www.roblox.com/asset/?id=507768375",weight=10}},toolslash={{id="http://www.roblox.com/asset/?id=522635514",weight=10}},toollunge={{id="http://www.roblox.com/asset/?id=522638767",weight=10}},wave={{id="http://www.roblox.com/asset/?id=507770239",weight=10}},point={{id="http://www.roblox.com/asset/?id=507770453",weight=10}},dance={{id="http://www.roblox.com/asset/?id=507771019",weight=10},{id="http://www.roblox.com/asset/?id=507771955",weight=10},{id="http://www.roblox.com/asset/?id=507772104",weight=10}},dance2={{id="http://www.roblox.com/asset/?id=507776043",weight=10},{id="http://www.roblox.com/asset/?id=507776720",weight=10},{id="http://www.roblox.com/asset/?id=507776879",weight=10}},dance3={{id="http://www.roblox.com/asset/?id=507777268",weight=10},{id="http://www.roblox.com/asset/?id=507777451",weight=10},{id="http://www.roblox.com/asset/?id=507777623",weight=10}},laugh={{id="http://www.roblox.com/asset/?id=507770818",weight=10}},cheer={{id="http://www.roblox.com/asset/?id=507770677",weight=10}}}local t={wave=false,point=false,dance=true,dance2=true,dance3=true,laugh=false,cheer=false}local u=false;local v={}local w,x=pcall(function()u=UserSettings():IsUserFeatureEnabled("UserPreloadAnimations")end)if not w then u=false end;math.randomseed(tick())function findExistingAnimationInSet(b,c)if b==nil or c==nil then return 0 end;for d=1,b.count,1 do if b[d].anim.AnimationId==c.AnimationId then return d end end;return 0 end;function configureAnimationSet(b,d)if(r[b]~=nil)then for b,b in pairs(r[b].connections)do b:disconnect()end end;r[b]={}r[b].count=0;r[b].totalWeight=0;r[b].connections={}local e=true;local f,g=pcall(function()e=game:GetService("StarterPlayer").AllowCustomAnimations end)if not f then e=true end;local f=script:FindFirstChild(b)if(e and f~=nil)then table.insert(r[b].connections,f.ChildAdded:connect(function(c)configureAnimationSet(b,d)end))table.insert(r[b].connections,f.ChildRemoved:connect(function(c)configureAnimationSet(b,d)end))local c=0;for e,e in pairs(f:GetChildren())do if(e:IsA("Animation"))then local f=1;local g=e:FindFirstChild("Weight")if(g~=nil)then f=g.Value end;r[b].count=r[b].count+1;c=r[b].count;r[b][c]={}r[b][c].anim=e;r[b][c].weight=f;r[b].totalWeight=r[b].totalWeight+r[b][c].weight;table.insert(r[b].connections,e.Changed:connect(function(c)configureAnimationSet(b,d)end))table.insert(r[b].connections,e.ChildAdded:connect(function(c)configureAnimationSet(b,d)end))table.insert(r[b].connections,e.ChildRemoved:connect(function(c)configureAnimationSet(b,d)end))end end end;if(r[b].count<=0)then for c,d in pairs(d)do r[b][c]={}r[b][c].anim=Instance.new("Animation")r[b][c].anim.Name=b;r[b][c].anim.AnimationId=d.id;r[b][c].weight=d.weight;r[b].count=r[b].count+1;r[b].totalWeight=r[b].totalWeight+d.weight end end;if u then for b,b in pairs(r)do for d=1,b.count,1 do if v[b[d].anim.AnimationId]==nil then c:LoadAnimation(b[d].anim)v[b[d].anim.AnimationId]=true end end end end end;function configureAnimationSetOld(b,d)if(r[b]~=nil)then for b,b in pairs(r[b].connections)do b:disconnect()end end;r[b]={}r[b].count=0;r[b].totalWeight=0;r[b].connections={}local e=true;local f,g=pcall(function()e=game:GetService("StarterPlayer").AllowCustomAnimations end)if not f then e=true end;local f=script:FindFirstChild(b)if(e and f~=nil)then table.insert(r[b].connections,f.ChildAdded:connect(function(c)configureAnimationSet(b,d)end))table.insert(r[b].connections,f.ChildRemoved:connect(function(c)configureAnimationSet(b,d)end))local c=1;for e,e in pairs(f:GetChildren())do if(e:IsA("Animation"))then table.insert(r[b].connections,e.Changed:connect(function(c)configureAnimationSet(b,d)end))r[b][c]={}r[b][c].anim=e;local d=e:FindFirstChild("Weight")if(d==nil)then r[b][c].weight=1 else r[b][c].weight=d.Value end;r[b].count=r[b].count+1;r[b].totalWeight=r[b].totalWeight+r[b][c].weight;c=c+1 end end end;if(r[b].count<=0)then for c,d in pairs(d)do r[b][c]={}r[b][c].anim=Instance.new("Animation")r[b][c].anim.Name=b;r[b][c].anim.AnimationId=d.id;r[b][c].weight=d.weight;r[b].count=r[b].count+1;r[b].totalWeight=r[b].totalWeight+d.weight end end;if u then for b,b in pairs(r)do for d=1,b.count,1 do c:LoadAnimation(b[d].anim)end end end end;function scriptChildModified(b)local c=s[b.Name]if(c~=nil)then configureAnimationSet(b.Name,c)end end;script.ChildAdded:connect(scriptChildModified)script.ChildRemoved:connect(scriptChildModified)for b,c in pairs(s)do configureAnimationSet(b,c)end;local s="None"local u=0;local v=0;local w=0.31;local x=0.1;local y=0.2;local z=false;function stopAllAnimations()local b=k;if(t[b]~=nil and t[b]==false)then b="idle"end;if g and z then b="idle"z=false end;k=""l=nil;if(n~=nil)then n:disconnect()end;if(m~=nil)then m:Stop()m:Destroy()m=nil end;if(q~=nil)then q:disconnect()end;if(p~=nil)then p:Stop()p:Destroy()p=nil end;return b end;function getHeightScale()if c then if not c.AutomaticScalingEnabled then return 1 end;local b=c.HipHeight/i;if f then if h==nil then h=script:FindFirstChild("ScaleDampeningPercent")end;if h~=nil then b=1+(c.HipHeight-i)*h.Value/i end end;return b end;return 1 end;local f=0.0001;function setRunSpeed(b)local b=b*1.25;local c=getHeightScale()local b=b/c;if b~=o then if b<0.33 then m:AdjustWeight(1.0)p:AdjustWeight(f)elseif b<0.66 then local b=((b-0.33)/0.33)m:AdjustWeight(1.0-b+f)p:AdjustWeight(b+f)else m:AdjustWeight(f)p:AdjustWeight(1.0)end;o=b;p:AdjustSpeed(b)m:AdjustSpeed(b)end end;function setAnimationSpeed(b)if k=="walk"then setRunSpeed(b)else if b~=o then o=b;m:AdjustSpeed(o)end end end;function keyFrameReachedFunc(b)if(b=="End")then if k=="walk"then if e==true then if p.Looped~=true then p.TimePosition=0.0 end;if m.Looped~=true then m.TimePosition=0.0 end else p.TimePosition=0.0;m.TimePosition=0.0 end else local b=k;if(t[b]~=nil and t[b]==false)then b="idle"end;if g and z then if m.Looped then return end;b="idle"z=false end;local d=o;playAnimation(b,0.15,c)setAnimationSpeed(d)end end end;function rollAnimation(b)local c=math.random(1,r[b].totalWeight)local d=c;local d=1;while(c>r[b][d].weight)do c=c-r[b][d].weight;d=d+1 end;return d end;local function f(b,c,d,f)if(b~=l)then if(m~=nil)then m:Stop(d)m:Destroy()end;if(p~=nil)then p:Stop(d)p:Destroy()if e==true then p=nil end end;o=1.0;m=f:LoadAnimation(b)m.Priority=Enum.AnimationPriority.Core;m:Play(d)k=c;l=b;if(n~=nil)then n:disconnect()end;n=m.KeyframeReached:connect(keyFrameReachedFunc)if c=="walk"then local b="run"local c=rollAnimation(b)p=f:LoadAnimation(r[b][c].anim)p.Priority=Enum.AnimationPriority.Core;p:Play(d)if(q~=nil)then q:disconnect()end;q=p.KeyframeReached:connect(keyFrameReachedFunc)end end end;function playAnimation(b,c,d)local e=rollAnimation(b)local e=r[b][e].anim;f(e,b,c,d)z=false end;function playEmote(b,c,d)f(b,b.Name,c,d)z=true end;local e=""local f=nil;local g=nil;local h=nil;function toolKeyFrameReachedFunc(b)if(b=="End")then playToolAnimation(e,0.0,c)end end;function playToolAnimation(b,c,d,i)local j=rollAnimation(b)local j=r[b][j].anim;if(g~=j)then if(f~=nil)then f:Stop()f:Destroy()c=0 end;f=d:LoadAnimation(j)if i then f.Priority=i end;f:Play(c)e=b;g=j;h=f.KeyframeReached:connect(toolKeyFrameReachedFunc)end end;function stopToolAnimations()local b=e;if(h~=nil)then h:disconnect()end;e=""g=nil;if(f~=nil)then f:Stop()f:Destroy()f=nil end;return b end;function onRunning(b)if b>0.75 then local e=16.0;playAnimation("walk",0.2,c)setAnimationSpeed(b/e)d="Running"else if t[k]==nil and not z then playAnimation("idle",0.2,c)d="Standing"end end end;function onDied()d="Dead"end;function onJumping()playAnimation("jump",0.1,c)v=w;d="Jumping"end;function onClimbing(b)local e=5.0;playAnimation("climb",0.1,c)setAnimationSpeed(b/e)d="Climbing"end;function onGettingUp()d="GettingUp"end;function onFreeFall()if(v<=0)then playAnimation("fall",y,c)end;d="FreeFall"end;function onFallingDown()d="FallingDown"end;function onSeated()d="Seated"end;function onPlatformStanding()d="PlatformStanding"end;function onSwimming(b)if b>1.00 then local e=10.0;playAnimation("swim",0.4,c)setAnimationSpeed(b/e)d="Swimming"else playAnimation("swimidle",0.4,c)d="Standing"end end;function animateTool()if(s=="None")then playToolAnimation("toolnone",x,c,Enum.AnimationPriority.Idle)return end;if(s=="Slash")then playToolAnimation("toolslash",0,c,Enum.AnimationPriority.Action)return end;if(s=="Lunge")then playToolAnimation("toollunge",0,c,Enum.AnimationPriority.Action)return end end;function getToolAnim(b)for b,b in ipairs(b:GetChildren())do if b.Name=="toolanim"and b.className=="StringValue"then return b end end;return nil end;local e=0;function stepAnimate(f)local h=1;local i=1;local j=f-e;e=f;local e=0;local e=false;if(v>0)then v=v-j end;if(d=="FreeFall"and v<=0)then playAnimation("fall",y,c)elseif(d=="Seated")then playAnimation("sit",0.5,c)return elseif(d=="Running")then playAnimation("walk",0.2,c)elseif(d=="Dead"or d=="GettingUp"or d=="FallingDown"or d=="Seated"or d=="PlatformStanding")then stopAllAnimations()h=0.1;i=1;e=true end;local b=b:FindFirstChildOfClass("Tool")if b and b:FindFirstChild("Handle")then local b=getToolAnim(b)if b then s=b.Value;b.Parent=nil;u=f+.3 end;if f>u then u=0;s="None"end;animateTool()else stopToolAnimations()s="None"g=nil;u=0 end end;local e={}local f=c;local function g()for b=1,#e do e[b]:Disconnect()end;e={}end;local function h()g()d=f.Sit and"Seated"or"Standing"e={f.Died:connect(onDied),f.Running:connect(onRunning),f.Jumping:connect(onJumping),f.Climbing:connect(onClimbing),f.GettingUp:connect(onGettingUp),f.FreeFalling:connect(onFreeFall),f.FallingDown:connect(onFallingDown),f.Seated:connect(onSeated),f.PlatformStanding:connect(onPlatformStanding),f.Swimming:connect(onSwimming)}end;h()game:GetService("Players").LocalPlayer.Chatted:connect(function(b)local e=""if(string.sub(b,1,3)=="/e ")then e=string.sub(b,4)elseif(string.sub(b,1,7)=="/emote ")then e=string.sub(b,8)end;if(d=="Standing"and t[e]~=nil)then playAnimation(e,j,c)end end)playAnimation("idle",0.1,c)d="Standing"spawn(function()while b.Parent~=nil do local b,b=wait(0.1)stepAnimate(b)end end)return{onRunning=onRunning,onDied=onDied,onJumping=onJumping,onClimbing=onClimbing,onGettingUp=onGettingUp,onFreeFall=onFreeFall,onFallingDown=onFallingDown,onSeated=onSeated,onPlatformStanding=onPlatformStanding,onHook=h,onUnhook=g}end;return b()end;while true do wait(.1)if b.Character~=nil then c=b.Character;break end end;function _Controller()local b=c:WaitForChild("Humanoid")local c={}if(b.RigType==Enum.HumanoidRigType.R6)then c=_R6()else c=_R15()end;print("Animation succes")return c end;function _AnimationHandler()local b={}b.__index=b;function b.new(c,d)local b=setmetatable({},b)b._AnimFuncs=_Controller()b.Humanoid=c;return b end;function b:EnableDefault(b)if(b)then self._AnimFuncs.onHook()else self._AnimFuncs.onUnhook()end end;function b:Run(b,...)self._AnimFuncs[b](...)end;return b end;function _GravityController()local b=Vector3.new(0,0,0)local c=Vector3.new(1,0,0)local c=Vector3.new(0,1,0)local d=Vector3.new(0,0,1)local d=Vector3.new(1,0,1)local d=CFrame.new()local e=1.2;local f=0.15;local g=200/3;local h=game:GetService("UserInputService")local h=game:GetService("RunService")local i=_InitObjects()local j=_AnimationHandler()local k=_StateTracker()local l={}l.__index=l;local function m(b,c,d)local b,c=b:Dot(c),b:Cross(c)if(b<-0.99999)then return CFrame.fromAxisAngle(d,math.pi)end;return CFrame.new(0,0,0,c.x,c.y,c.z,1+b)end;local function n(b,c,d)local d=c:Cross(d)local c=d:Cross(c)return CFrame.fromMatrix(b,d.Unit,c.Unit)end;local function o(b)local c=0;for b,b in next,b do if(b:IsA("BasePart"))then c=c+b:GetMass()end end;return c end;local p=_PlayerModule()local q=_sounds()function l.new(b)local e=setmetatable({},l)local f=p;e.Controls=f:GetControls()e.Camera=f:GetCameras()e.Player=b;e.Character=b.Character;e.Humanoid=b.Character:WaitForChild("Humanoid")e.HRP=b.Character:WaitForChild("HumanoidRootPart")e.AnimationHandler=j.new(e.Humanoid,e.Character:WaitForChild("Animate"))e.AnimationHandler:EnableDefault(false)local b=game:GetService("Players").LocalPlayer.PlayerScripts:FindFirstChild("SetState")or Instance.new("BindableEvent",game:GetService("Players").LocalPlayer.PlayerScripts)local f=q;b.Name="SetState"e.StateTracker=k.new(e.Humanoid,f)e.StateTracker.Changed:Connect(function(b,c)e.AnimationHandler:Run(b,c)end)local b,f,g,i=i(e)i.Touched:Connect(function()end)b.Touched:Connect(function()end)e.Collider=b;e.VForce=g;e.Gyro=f;e.Floor=i;e.LastPart=workspace.Terrain;e.LastPartCFrame=d;e.GravityUp=c;e.Ignores={e.Character}function e.Camera.GetUpVector(b,b)return e.GravityUp end;e.Humanoid.PlatformStand=true;e.CharacterMass=o(e.Character:GetDescendants())e.Character.AncestryChanged:Connect(function()e.CharacterMass=o(e.Character:GetDescendants())end)e.JumpCon=h.RenderStepped:Connect(function(b)if(e.Controls:IsJumping())then e:OnJumpRequest()end end)e.DeathCon=e.Humanoid.Died:Connect(function()e:Destroy()end)e.SeatCon=e.Humanoid.Seated:Connect(function(b)if(b)then e:Destroy()end end)e.HeartCon=h.Heartbeat:Connect(function(b)e:OnHeartbeatStep(b)end)h:BindToRenderStep("GravityStep",Enum.RenderPriority.Input.Value+1,function(b)e:OnGravityStep(b)end)return e end;function l:Destroy()self.JumpCon:Disconnect()self.DeathCon:Disconnect()self.SeatCon:Disconnect()self.HeartCon:Disconnect()h:UnbindFromRenderStep("GravityStep")self.Collider:Destroy()self.VForce:Destroy()self.Gyro:Destroy()self.StateTracker:Destroy()self.Humanoid.PlatformStand=false;self.AnimationHandler:EnableDefault(true)self.GravityUp=c end;function l:GetGravityUp(b)return b end;function l:IsGrounded(b)if(not b)then local b=self.Floor:GetTouchingParts()for b,b in next,b do if(not b:IsDescendantOf(self.Character))then return true end end else if(self.StateTracker.Jumped)then return false end;local b={}local c=self.Collider:GetTouchingParts()for c,c in next,c do if(not c:IsDescendantOf(self.Character))then table.insert(b,c)end end;if(#b>0)then local c=math.cos(self.Humanoid.MaxSlopeAngle)local d=Ray.new(self.Collider.Position,-10*self.GravityUp)local b,d,d=workspace:FindPartOnRayWithWhitelist(d,b,true)if(b and c<=self.GravityUp:Dot(d))then return true end end end;return false end;function l:OnJumpRequest()if(not self.StateTracker.Jumped and self:IsGrounded(true))then local b=self.HRP.Velocity;self.HRP.Velocity=b+self.GravityUp*self.Humanoid.JumpPower*e;self.StateTracker:RequestedJump()end end;function l:GetMoveVector()return self.Controls:GetMoveVector()end;function l:OnHeartbeatStep(b)local b=Ray.new(self.Collider.Position,-1.1*self.GravityUp)local b,c,c=workspace:FindPartOnRayWithIgnoreList(b,self.Ignores)local c=self.LastPart;if(b and c and c==b)then local c=self.LastPartCFrame:ToObjectSpace(self.HRP.CFrame)self.HRP.CFrame=b.CFrame:ToWorldSpace(c)end;self.LastPart=b;self.LastPartCFrame=b and b.CFrame end;function l:OnGravityStep(e)local h=self.GravityUp;local i=self:GetGravityUp(h)local j=m(h,i,workspace.CurrentCamera.CFrame.RightVector)j=d:Lerp(j,f)self.GravityUp=j*h;local f=workspace.CurrentCamera.CFrame;local h=f.LookVector:Dot(i)local f=math.abs(h)>0.5 and-math.sign(h)*f.UpVector or f.LookVector;local f=f:Cross(-i).Unit;local h=-f:Cross(i).Unit;local j=self:GetMoveVector()local j=h*j.z-f*j.x;j=j:Dot(j)>1 and j.Unit or j;local k=j:Dot(j)>0;local l=self.HRP.CFrame.LookVector;local f=l:Dot(h)*h+l:Dot(f)*f;local h=f:Cross(i).Unit;local h=CFrame.fromMatrix(b,h,i,-f)local l=d;if(k)then l=d:Lerp(m(f,j,i),0.7)end;local d=workspace.Gravity;local c=d*self.CharacterMass*(c-i)local d=self.HRP.Velocity;local f=self.Humanoid.WalkSpeed*j;local i=d:Dot(i)*i;local d=d-i;if(d:Dot(d)<1)then d=b end;local d=f-d;local e=math.min(10000,g*self.CharacterMass*d.Magnitude/(e*60))local d=e>0 and d.Unit*e or b;local e=l*h;if(self.Camera:IsCamRelative())then local c=workspace.CurrentCamera.CFrame.LookVector;local c=c-e.UpVector:Dot(c)*e.UpVector;e=n(b,c,e.UpVector)end;self.StateTracker:OnStep(self.GravityUp,self:IsGrounded(),k)self.VForce.Force=d+c;self.Gyro.CFrame=e end;return l end;function _Draw3D()local b={}b.StyleGuide={Point={Thickness=0.5;Color=Color3.new(0,1,0)},Line={Thickness=0.1;Color=Color3.new(1,1,0)},Ray={Thickness=0.1;Color=Color3.new(1,0,1)},Triangle={Thickness=0.05};CFrame={Thickness=0.1;RightColor3=Color3.new(1,0,0);UpColor3=Color3.new(0,1,0);BackColor3=Color3.new(0,0,1);PartProperties={Material=Enum.Material.SmoothPlastic}}}local c=Instance.new("WedgePart")c.Material=Enum.Material.SmoothPlastic;c.Anchored=true;c.CanCollide=false;local d=Instance.new("Part")d.Size=Vector3.new(0.1,0.1,0.1)d.Anchored=true;d.CanCollide=false;d.TopSurface=Enum.SurfaceType.Smooth;d.BottomSurface=Enum.SurfaceType.Smooth;d.Material=Enum.Material.SmoothPlastic;local function e(b,c)local d=d:Clone()for b,c in next,b do d[b]=c end;if(c)then for b,c in next,c do if(b~="Thickness")then d[b]=c end end end;return d end;function b.Draw(b,c)c.Parent=b;return e(c,nil)end;function b.Point(c,d)local f=b.StyleGuide.Point.Thickness;return e({Size=Vector3.new(f,f,f);CFrame=(typeof(d)=="CFrame"and d or CFrame.new(d));Parent=c},b.StyleGuide.Point)end;function b.Line(c,d,f)local g=b.StyleGuide.Line.Thickness;return e({CFrame=CFrame.new((d+f)/2,f);Size=Vector3.new(g,g,(f-d).Magnitude);Parent=c},b.StyleGuide.Line)end;function b.Ray(c,d,f)local g=b.StyleGuide.Ray.Thickness;return e({CFrame=CFrame.new(d+f/2,d+f);Size=Vector3.new(g,g,f.Magnitude);Parent=c},b.StyleGuide.Ray)end;function b.Triangle(d,e,f,g)local h,i,j=f-e,g-e,g-f;local k,l,m=h:Dot(h),i:Dot(i),j:Dot(j)if(k>l and k>m)then g,e=e,g elseif(l>m and l>k)then e,f=f,e end;h,i,j=f-e,g-e,g-f;local k=i:Cross(h).Unit;local l=j:Cross(k).Unit;local j=j.Unit;local m=math.abs(h:Dot(l))local h=math.abs(h:Dot(j))local i=math.abs(i:Dot(j))local n=b.StyleGuide.Triangle.Thickness;local o=c:Clone()o.Size=Vector3.new(n,m,h)o.CFrame=CFrame.fromMatrix((e+f)/2,k,l,j)o.Parent=d;local c=c:Clone()c.Size=Vector3.new(n,m,i)c.CFrame=CFrame.fromMatrix((e+g)/2,-k,l,-j)c.Parent=d;for b,d in next,b.StyleGuide.Triangle do if(b~="Thickness")then o[b]=d;c[b]=d end end;return o,c end;function b.CFrame(c,d)local f=d.Position;local g=d.RightVector;local h=d.UpVector;local d=-d.LookVector;local i=b.StyleGuide.CFrame.Thickness;local j=e({CFrame=CFrame.new(f+g/2,f+g);Size=Vector3.new(i,i,g.Magnitude);Color=b.StyleGuide.CFrame.RightColor3;Parent=c},b.StyleGuide.CFrame.PartProperties)local g=e({CFrame=CFrame.new(f+h/2,f+h);Size=Vector3.new(i,i,g.Magnitude);Color=b.StyleGuide.CFrame.UpColor3;Parent=c},b.StyleGuide.CFrame.PartProperties)local b=e({CFrame=CFrame.new(f+d/2,f+d);Size=Vector3.new(i,i,h.Magnitude);Color=b.StyleGuide.CFrame.BackColor3;Parent=c},b.StyleGuide.CFrame.PartProperties)return j,g,b end;return b end;function _Draw2D()local b={}b.StyleGuide={Point={BorderSizePixel=0;Size=UDim2.new(0,4,0,4);BorderColor3=Color3.new(0,0,0);BackgroundColor3=Color3.new(0,1,0)},Line={Thickness=1;BorderSizePixel=0;BorderColor3=Color3.new(0,0,0);BackgroundColor3=Color3.new(0,1,0)},Ray={Thickness=1;BorderSizePixel=0;BorderColor3=Color3.new(0,0,0);BackgroundColor3=Color3.new(0,1,0)},Triangle={ImageTransparency=0;ImageColor3=Color3.new(0,1,0)}}local c=Vector2.new(0.5,0.5)local d="rbxassetid://2798177521"local e="rbxassetid://2798177955"local f=Instance.new("ImageLabel")f.BackgroundTransparency=1;f.AnchorPoint=c;f.BorderSizePixel=0;local g=Instance.new("Frame")g.BorderSizePixel=0;g.Size=UDim2.new(0,0,0,0)g.BackgroundColor3=Color3.new(1,1,1)function draw(b,c)local d=g:Clone()for b,c in next,b do d[b]=c end;if(c)then for b,c in next,c do if(b~="Thickness")then d[b]=c end end end;return d end;function b.Draw(b,c)c.Parent=b;return draw(c,nil)end;function b.Point(d,e)return draw({AnchorPoint=c;Position=UDim2.new(0,e.x,0,e.y);Parent=d},b.StyleGuide.Point)end;function b.Line(d,e,f)local g=(f-e)local e=(e+f)/2;return draw({AnchorPoint=c;Position=UDim2.new(0,e.x,0,e.y);Size=UDim2.new(0,b.StyleGuide.Line.Thickness,0,g.magnitude);Rotation=math.deg(math.atan2(g.y,g.x))-90;BackgroundColor3=Color3.new(1,1,0);Parent=d},b.StyleGuide.Line)end;function b.Ray(d,e,f)local e,f=e,e+f;local g=(f-e)local e=(e+f)/2;return draw({AnchorPoint=c;Position=UDim2.new(0,e.x,0,e.y);Size=UDim2.new(0,b.StyleGuide.Ray.Thickness,0,g.magnitude);Rotation=math.deg(math.atan2(g.y,g.x))-90;Parent=d},b.StyleGuide.Ray)end;function b.Triangle(g,h,i,j)local k,l,m=i-h,j-h,j-i;local n,o,p=k:Dot(k),l:Dot(l),m:Dot(m)if(n>o and n>p)then j,h=h,j elseif(o>p and o>n)then h,i=i,h end;k,l,m=i-h,j-h,j-i;local m=m.unit;local n=m:Cross(k)local o=(n>=0)local p=math.deg(math.atan2(m.y,m.x))+(o and 0 or 180)local i=(h+i)/2;local h=(h+j)/2;local j=f:Clone()j.Image=o and d or e;j.AnchorPoint=c;j.Size=UDim2.new(0,math.abs(m:Dot(k)),0,n)j.Position=UDim2.new(0,i.x,0,i.y)j.Rotation=p;j.Parent=g;local f=f:Clone()f.Image=o and e or d;f.AnchorPoint=c;f.Size=UDim2.new(0,math.abs(m:Dot(l)),0,n)f.Position=UDim2.new(0,h.x,0,h.y)f.Rotation=p;f.Parent=g;for b,c in next,b.StyleGuide.Triangle do j[b]=c;f[b]=c end;return j,f end;return b end;function _DrawClass()local b=_Draw2D()local c=_Draw3D()local d={}local e=setmetatable({},{__mode="k"})d.__index=d;function d.new(f)local d=setmetatable({},d)d.Parent=f;e[d]={}d.Draw3D={}for b,c in next,c do d.Draw3D[b]=function(...)local b={c(d.Parent,...)}for c=1,#b do table.insert(e[d],b[c])end;return unpack(b)end end;d.Draw2D={}for b,c in next,b do d.Draw2D[b]=function(...)local b={c(d.Parent,...)}for c=1,#b do table.insert(e[d],b[c])end;return unpack(b)end end;return d end;function d:Clear()local b=e[self]while(#b>0)do local b=table.remove(b)if(b)then b:Destroy()end end;e[self]={}end;return d end;local b=game:GetService("Players")local c=_GravityController()local d=c.new(b.LocalPlayer)local e=_DrawClass()local e=math.pi*2;local f=Vector3.new(0,0,0)local g=3;local h=24;local i=3;local j=2;local k=1.66666;local l=1;local m=9;local n=2;local o=2;local p=3.5;local q=1;local r=8;function GetGravityUp(c,d)local s={}for b,c in next,b:GetPlayers()do s[b]=c.Character end;local b=c.HRP.CFrame;local c=(c.Humanoid.RigType==Enum.HumanoidRigType.R15)local c=c and b.p or b.p+0.35*d;local b=math.abs(b.LookVector:Dot(d))<0.999 and b.LookVector:Cross(d)or b.RightVector:Cross(d)local t=25;local u=Ray.new(c,-t*d)local u,v,v=workspace:FindPartOnRayWithIgnoreList(u,s)local w=0;local x=0;local x=0;local y=0;local z=0;local A=f;if(u)then A=v;x=0 end;local u=f;for f=1,h do local e=e*((f-1)/h)local h=0.25+0.75*math.abs(math.cos(e))local f=(f%2==0)local i=f and j or i;local j=f and l or k;local k=t;local b=CFrame.fromAxisAngle(d,e)*b;local d=(g*-d+(j-i)*b)local b=Ray.new(c+i*b,k*d.unit)local b,c,c=workspace:FindPartOnRayWithIgnoreList(b,s)if(b)then u=u+h*c;w=w+1;if f then y=y+1 else z=z+1 end end end;local e=0;local h=f;for f=1,m do local f=2*math.pi*((f-1)/m)local i=0.25+0.75*math.abs(math.cos(f))local b=CFrame.fromAxisAngle(d,f)*b;local b=(p*b+g*-d).unit;local c=c-q*-d+o*b;local b=Ray.new(c,n*b)local b,c,c=workspace:FindPartOnRayWithIgnoreList(b,s)if(b)then h=h+r*i*c;e=e+1 end end;if(x+w+e>0)then local b=A+u+h;if(b~=f)then return b.unit end end;return d end;d.GetGravityUp=GetGravityUp;game:GetService("ContextActionService"):BindAction("Toggle",function(e,e,f)if not(e==Enum.UserInputState.Begin)then return end;if(d)then d:Destroy()d=nil else d=c.new(b.LocalPlayer)d.GetGravityUp=GetGravityUp end end,false,Enum.KeyCode.Z)print("end")
